import.meta;var Oo=Object.defineProperty,lr=(r,e)=>(e=Symbol[r])?e:Symbol.for("Symbol."+r),cn=r=>{throw TypeError(r)},Lo=(r,e,t)=>e in r?Oo(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,d=(r,e,t)=>Lo(r,typeof e!="symbol"?e+"":e,t),dn=(r,e,t)=>e.has(r)||cn("Cannot "+t),P=(r,e,t)=>(dn(r,e,"read from private field"),t?t.call(r):e.get(r)),V=(r,e,t)=>e.has(r)?cn("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),F=(r,e,t,n)=>(dn(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t),re=function(r,e){this[0]=r,this[1]=e},Ue=(r,e,t)=>{var n=(i,s,l,c)=>{try{var u=t[i](s),m=(s=u.value)instanceof re,h=u.done;Promise.resolve(m?s[0]:s).then(g=>m?n(i==="return"?i:"next",s[1]?{done:g.done,value:g.value}:g,l,c):l({value:g,done:h})).catch(g=>n("throw",g,l,c))}catch(g){c(g)}},a=i=>o[i]=s=>new Promise((l,c)=>n(i,s,l,c)),o={};return t=t.apply(r,e),o[lr("asyncIterator")]=()=>o,a("next"),a("throw"),a("return"),o},ne=(r,e,t)=>(e=r[lr("asyncIterator")])?e.call(r):(r=r[lr("iterator")](),e={},t=(n,a)=>(a=r[n])&&(e[n]=o=>new Promise((i,s,l)=>(o=a.call(r,o),l=o.done,Promise.resolve(o.value).then(c=>i({value:c,done:l}),s)))),t("next"),t("return"),e);function xo(){Array.prototype.flatMap||(Array.prototype.flatMap=function(r,e){const t=[];for(let n=0;n<this.length;n++){const a=r.call(e,this[n],n,this);if(Array.isArray(a))for(const o of a)t.push(o);else t.push(a)}return t})}xo();const Mo=":host{display:flex;align-items:center;justify-content:center}";class Uo extends HTMLElement{constructor(){super(...arguments),d(this,"size","18px"),d(this,"color","gray")}connectedCallback(){var e,t;this.attachShadow({mode:"open"}),this.size=(e=this.getAttribute("size"))!=null?e:this.size,this.color=(t=this.getAttribute("color"))!=null?t:this.color,this.render();const n=document.createElement("style");n.textContent=Mo,this.shadowRoot.appendChild(n)}render(){const e=this.shadowRoot,t='\n      width="'.concat(this.size,'"\n      height="').concat(this.size,'"\n      xmlns="http://www.w3.org/2000/svg"\n      aria-hidden="true"\n    ');e.innerHTML="\n      <svg ".concat(t,' viewBox="0 0 20 20" fill="').concat(this.color,'">\n        <path d="M17.1 4.3l-1.4-1.4-5.7 5.7-5.7-5.7-1.4 1.4 5.7 5.7-5.7 5.7 1.4 1.4 5.7-5.7 5.7 5.7 1.4-1.4-5.7-5.7z"/>\n      </svg>\n    ')}}const Bo="#overlay{position:fixed;width:100%;height:100%;background:#0006;top:0;left:0;z-index:2147483647;animation:modalPop .3s ease-out}#modal{position:fixed;top:20%;left:50%;width:100%;max-width:383px;transform:translate(-50%,-100%);background:#fff;color:#000;border-radius:5px;animation:modalSlideInFromTop .3s forwards}@keyframes modalPop{0%{opacity:0}to{opacity:1}}@keyframes modalSlideInFromTop{0%{transform:translate(-50%,-100%)}to{transform:translate(-50%)}}@keyframes modalSlideInFromBottom{0%{transform:translate(-50%,100%)}to{transform:translate(-50%)}}@media only screen and (max-width: 640px){#modal{top:auto;bottom:0;animation:modalSlideInFromBottom .3s forwards}}#modal footer{padding:0 21px 21px}#modal header{display:flex;justify-content:space-between;padding:21px 21px 16px}#title{font-size:21px;font-weight:600;line-height:25.2px;margin:0;word-wrap:break-word;overflow-wrap:break-word}.capitalize:first-letter{display:inline-block;text-transform:capitalize}#content{text-align:left;padding:0 21px 16px;overflow:auto;max-height:50vh}#modal #content p{margin:0;font-size:14px;line-height:21px}#close-icon,#close-button{cursor:pointer}#close-icon{min-width:24px;background:transparent;padding:0;border:none}#close-button{width:100%;padding:16px 21px;color:#fff;background-color:#1773b0;border:none;border-radius:5px;font-size:14px;line-height:21px;font-family:inherit}#close-button:hover,#close-button:active{background:#136f99}#close-button:active,#close-button:focus{box-shadow:0 0 0 4px #1990c640}";function Fo(r){return la(r).map(e=>e instanceof Error?e:new ca("[".concat(typeof e,"] ").concat($o(e).slice(0,10240))))}function la(r,e=0){return e>=20?[r,"Truncated cause stack"]:r instanceof Error&&r.cause?[r,...la(r.cause,e+1)]:[r]}function $o(r){var e;if(typeof r=="function")return"".concat(r.name||"anonymous");if(typeof r!="string")try{return(e=JSON.stringify(r))!=null?e:typeof r}catch(t){}return"".concat(r)}var ca=class extends Error{constructor(){super(...arguments),d(this,"name","BugsnagInvalidError")}},da=/^\s*at .*(\S+:\d+|\(native\))/m,zo=/^(eval@)?(\[native code])?$/;function Ho(r){return r.stack?r.stack.match(da)?Go(r):Vo(r):[]}function ua(r){if(r.indexOf(":")===-1)return[r];let e=/(.+?)(?::(\d+))?(?::(\d+))?$/.exec(r.replace(/[()]/g,""));return[e[1],e[2]?Number(e[2]):void 0,e[3]?Number(e[3]):void 0]}function Go(r){return r.stack.split("\n").filter(e=>!!e.match(da)).map(e=>{let t=e.replace(/^\s+/,"").replace(/^.*?\s+/,""),n=t.match(/ (\(.+\)$)/);t=n?t.replace(n[0],""):t;let a=ua(n?n[1]:t),o=n&&t||void 0,i=["eval","<anonymous>"].indexOf(a[0])>-1?void 0:a[0];return{method:o,file:i,lineNumber:a[1],columnNumber:a[2]}})}function Vo(r){return r.stack.split("\n").filter(e=>!e.match(zo)).map(e=>{if(e.indexOf("@")===-1&&e.indexOf(":")===-1)return{method:e};let t=/((.*".+"[^@]*)?[^@]*)(?:@)/,n=e.match(t),a=n&&n[1]?n[1]:void 0,o=ua(e.replace(t,""));return{method:a,file:o[0],lineNumber:o[1],columnNumber:o[2]}})}var cr="5",jo=class{constructor(r){d(this,"breadcrumbs",[]),d(this,"apiKey"),d(this,"plugins"),d(this,"appId"),d(this,"appType"),d(this,"appVersion"),d(this,"releaseStage"),d(this,"locale"),d(this,"userAgent"),d(this,"metadata"),d(this,"persistedMetadata"),d(this,"onError"),d(this,"onPostErrorListeners",[]),d(this,"endpoints"),d(this,"session");var e,t,n;this.apiKey=r.apiKey,this.appType=r.appType,this.appId=r.appId,this.appVersion=r.appVersion,this.releaseStage=r.releaseStage,this.locale=r.locale,this.userAgent=r.userAgent,this.metadata=r.metadata,this.onError=r.onError,this.persistedMetadata={},this.endpoints=(e=r.endpoints)!=null?e:{notify:"https://error-analytics-production.shopifysvc.com",sessions:"https://error-analytics-sessions-production.shopifysvc.com/observeonly"},this.plugins=(t=r.plugins)!=null?t:[],this.plugins.forEach(a=>a.load(this)),this.leaveBreadcrumb("Bugsnag started",void 0,"state"),((n=r.withSessionTracking)==null||n)&&(this.session={id:this.getRandomUUID(),startedAt:new Date().toISOString(),events:{handled:0,unhandled:0}},this.startSession())}addMetadata(r){for(let e of Object.keys(r))this.persistedMetadata[e]=r[e]}getSessionId(){var r;return(r=this.session)==null?void 0:r.id}leaveBreadcrumb(r,e,t="manual"){this.breadcrumbs.push({name:r,metaData:e,type:t,timestamp:new Date().toISOString()})}notify(r,{errorClass:e,severity:t,severityType:n,handled:a=!0,metadata:o,context:i,groupingHash:s}={}){var l,c;let u=Fo(r),m={...this.metadata,...this.persistedMetadata,...o},h=this.buildBugsnagEvent(u,{errorClass:e,severityType:n,handled:a,severity:t,metadata:m,context:i,groupingHash:s});if(((c=(l=this.onError)==null?void 0:l.call(this,h,r))==null||c)&&this.releaseStage!=="development"){this.updateAndAppendSessionInformation(h);let g=this.sendToBugsnag(h);return this.onPostErrorListeners.forEach(f=>f(h,r)),g}return Promise.resolve()}addOnPostError(r){this.onPostErrorListeners.push(r)}updateAndAppendSessionInformation(r){this.session&&(r.unhandled?this.session.events.unhandled++:this.session.events.handled++,r.session=this.session)}buildBugsnagEvent(r,{errorClass:e,severity:t="error",severityType:n="handledException",handled:a,metadata:o={},context:i,groupingHash:s}){let l=new Date().toISOString(),{breadcrumbs:c,appId:u,appType:m,appVersion:h,releaseStage:g,locale:f,userAgent:v}=this,_=r.map((A,k)=>({errorClass:k===0&&e!=null?e:A.name,stacktrace:ha(u,A),message:A.message,type:"browserjs"}));return{payloadVersion:cr,exceptions:_,severity:t,severityReason:{type:n},unhandled:!a,app:{id:u,type:m,version:h,releaseStage:g},device:{time:l,locale:f,userAgent:v},breadcrumbs:c,context:i,metaData:o,groupingHash:s}}async startSession(){var r,e;if(this.releaseStage==="development"){console.log("Skipping error logging session tracking in development mode");return}let{apiKey:t}=this,n={notifier:{name:"Bugsnag JavaScript",version:"7.22.2",url:"https://github.com/bugsnag/bugsnag-js"},app:{version:this.appVersion,releaseStage:this.releaseStage,type:this.appType},device:{id:this.appId,locale:this.locale,userAgent:this.userAgent},sessions:[this.session]};try{await fetch(this.endpoints.sessions,{method:"POST",headers:{"Content-Type":"application/json","Bugsnag-Api-Key":t,"Bugsnag-Payload-Version":cr,"Bugsnag-Sent-At":(e=(r=this.session)==null?void 0:r.startedAt)!=null?e:new Date().toISOString()},body:JSON.stringify(n,un())})}catch(a){console.warn("[bugsnag-light] failed to start session"),console.warn(a)}}async sendToBugsnag(r){let{apiKey:e}=this,t={apiKey:e,notifier:{name:"Bugsnag JavaScript",version:"7.22.2",url:"https://github.com/bugsnag/bugsnag-js"},events:[r]};try{await fetch(this.endpoints.notify,{method:"POST",headers:{"Content-Type":"application/json","Bugsnag-Api-Key":e,"Bugsnag-Payload-Version":cr,"Bugsnag-Sent-At":r.device.time},body:JSON.stringify(t,un())})}catch(n){console.warn("[bugsnag-light] failed to send an event"),console.warn(n)}}getRandomUUID(){try{return crypto.randomUUID()}catch(r){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}}};function ha(r,e){let t=Ho(e).map(n=>{var a,o,i,s;let l=(a=n.file)==null?void 0:a.includes(r);return{method:(o=n.method)!=null?o:"",file:(i=n.file)!=null?i:"",lineNumber:(s=n.lineNumber)!=null?s:0,columnNumber:n.columnNumber,inProject:l}});if(e instanceof ca){let n=t.findIndex(a=>a.method.endsWith("notify"));n>-1&&(t=t.slice(n+1))}return t}function un(){let r=new WeakSet;return function(e,t){if(typeof t=="object"&&t!==null){if(r.has(t))return"[Circular]";r.add(t)}return t}}var qo=class Zh extends Error{constructor(e){super(e),d(this,"reason"),this.name="BreadcrumbsPluginFetchError",Object.setPrototypeOf(this,Zh.prototype)}};function Wo(r,{metadata:e}={}){let t=window.onerror;window.onerror=(n,a,o,i,s)=>{s&&r.notify(s,{severityType:"unhandledException",handled:!1,metadata:e}),typeof t=="function"&&t.apply(window.onerror,[n,a,o,i,s])}}function Yo(r,{metadata:e}={}){window.addEventListener("unhandledrejection",t=>{t.reason&&t.reason instanceof Error&&t.reason.stack&&!(t.reason instanceof qo)&&r.notify(t.reason,{severityType:"unhandledPromiseRejection",handled:!1,metadata:e})})}function yt(r){try{const e=new RegExp("(^| )".concat(r,"=([^;]+)")).exec(document.cookie);if(e){const t=e[2];try{return decodeURIComponent(t)}catch(n){return t}}return null}catch(e){return null}}const Er={BRANDED_BUTTON:"shopify-payment-button__button shopify-payment-button__button--branded",UNBRANDED_BUTTON:"shopify-payment-button__button shopify-payment-button__button--unbranded",MORE_PAYMENT_OPTION_BUTTON:"shopify-payment-button__more-options"},Ko={DARK:"apple-pay--dark",LIGHT:"apple-pay--light"},Qo=44,Jo="_shopify_y",ma=6,Xo="discount_code",Br="https://static-na.payments-amazon.com",Fr="".concat(Br,"/checkout.js"),ga="https://www.paypal.com",ya="https://pay.google.com",x={CURRENCY_CHANGE:"wallet_currency_change",CAPTCHA_REQUIRED:"wallet_captcha_required",NOT_ENOUGH_STOCK:"wallet_not_enough_stock",DYNAMIC_TAX:"wallet_dynamic_tax",PRICE_INCREASED:"wallet_price_increased",PAYMENT_METHOD_NOT_APPLICABLE:"wallet_payment_method_not_applicable",INVALID_PAYMENT_DEFERRED_PAYMENT_REQUIRED:"wallet_invalid_payment_deferred_payment_required",LOCALIZATION_EXTENSION_FIELD_ERROR:"wallet_localization_extension_field_error",ACCOUNT_INFO_MISMATCH:"wallet_account_info_mismatch",WALLET_PROCESSING_FAILED:"wallet_processing_failed",UNSUPPORTED_APPLE_PAY_PAYMENT_METHOD:"wallet_unsupported_apple_pay_payment_method",UNSUPPORTED_GOOGLE_PAY_PAYMENT_METHOD:"wallet_unsupported_google_pay_payment_method",PAYMENTS_COUNTRY_INVALID:"wallet_payments_country_invalid"},fa="VALIDATION_CUSTOM",ba="portable-wallets",Oe={BUTTON:"accelerated-checkout-button",CONTAINER:"accelerated-checkout-button-container"},wa="unknown",_a={name:"buy_it_now",supports_subs:!0,supports_def_opts:!0,wallet_params:{}};function Aa(r){try{return!r.toString().includes("[native code]")}catch(e){return!0}}const dr=new Map,Zo={checkDuplicate({errorClass:r,message:e}){if(dr.has(r)){const t=dr.get(r);if(t.has(e))return!0;t.add(e)}else dr.set(r,new Set([e]));return!1},reset(){}};var _t;class ee extends Error{constructor(e,{groupingHash:t,...n}={}){super(e,n),V(this,_t),d(this,"autogenerateHash",!1),d(this,"useHashPrefix",!1),F(this,_t,t)}get groupingHash(){var e;const t=(e=P(this,_t))!=null?e:this.autogenerateHash?ei(this.message):"";return(this.useHashPrefix?"".concat(this.name,"-").concat(t):t)||void 0}}_t=new WeakMap;function ei(r){return r.toLowerCase().slice(0,100).replace(/[^a-z0-9\s]/g,"").trim().split(/\s+/).slice(0,5).join("-")}const St="DeveloperError";class te extends Error{constructor({code:e,message:t},n){const a="An unexpected error happened likely because of customizations made to HTML/JavaScript on this site ".concat(t);super("[".concat(e,"]: ").concat(a),n),d(this,"name",St),d(this,"code"),this.code=e}}const Ea="SilencedError";class Z extends Error{constructor(){super(...arguments),d(this,"name",Ea)}}class ti extends Error{constructor(){super(...arguments),d(this,"name","MissingConfigError")}}class ue extends ee{constructor(){super(...arguments),d(this,"name","NoResponseError"),d(this,"useHashPrefix",!0),d(this,"autogenerateHash",!0)}}class Pt extends ee{constructor(e,{errorDetails:t}){const n=Pt.generateGraphQLGroupingHash(e,t);super(e,{groupingHash:n}),d(this,"errorDetails"),d(this,"useHashPrefix",!0),this.name="GraphQLResponseError",this.errorDetails=t}static generateGraphQLGroupingHash(e,t){const{operationName:n}=t,a=this.getErrorMessageCategoryFromMessage(e);return n?"".concat(n,"-").concat(a):a}static getErrorMessageCategoryFromMessage(e){const t=[[/Variable \$\w+ of type \w+!? was provided invalid value/i,"graphql-input-validation"],[/Cannot read propert(?:y|ies)(?: .+)? of (?:null|undefined)/i,"null-property-access"],[/(?:null|undefined) is not an object/i,"null-not-object"]];for(const[o,i]of t){const s=e.match(o);if(s){const l=s[1];return l?"".concat(i,"-").concat(l):i}}let n=e;const a=[/^GraphQL response error for \w+:\s*(with status \d+\s*=>\s*|=>\s*)?/i,/^GraphQL\s+Client:\s*/i,/^GraphQL\s+response\s+error\s+for\s+\w+:\s*with\s+status\s+\d+\s*=>\s*/i,/An error occurred while fetching from the API. Review 'graphQLErrors' for details./i];for(const o of a)n=n.replace(o,"");return n=n.slice(0,100),n.toLowerCase().replace(/[^a-z0-9\s]/g,"").trim().split(/\s+/).slice(0,5).join("-")||"unknown-error"}}const Ca="IgnoredGraphQLResponseError";class Ve extends Pt{constructor(e,{reason:t,errorDetails:n}){super(e,{errorDetails:n}),d(this,"reason"),this.name=Ca,this.reason=t}}class Sa extends ee{constructor(e){const t="[".concat(e,"] completion returned null result");super(t,{groupingHash:"".concat(e,"-expected-completion-null-result")})}}class hn extends ee{constructor(){super(...arguments),d(this,"name","DigitalPhysicalMismatchIssueError"),d(this,"useHashPrefix",!0)}}function O(r,e){if(!{}.hasOwnProperty.call(r,e))throw new TypeError("attempted to use private field on non-instance");return r}var ri=0;function _e(r){return"__private_"+ri+++"_"+r}function tr(r){return Object.entries(r).map(([e,t])=>({key:e,value:{stringValue:String(t)}}))}function ni(r){return Object.entries(r).map(([e,t])=>({key:e,value:Pa(t)}))}function Pa(r){if(Array.isArray(r))return{arrayValue:{values:r.map(e=>Pa(e))}};switch(typeof r){case"boolean":return{boolValue:!!r};case"number":return{doubleValue:Number(r)};case"string":default:return{stringValue:String(r)}}}const $r=1,ai=oi(5,2,12);function oi(r,e,t){const n=[0];for(let a=0;a<t;a++){const o=Math.floor(r*e**a);n.push(o)}return n}var Se=_e("exporter"),J=_e("attributes"),W=_e("metrics"),Pe=_e("logs");class ii{constructor({exporter:e,attributes:t}){Object.defineProperty(this,Se,{writable:!0,value:void 0}),Object.defineProperty(this,J,{writable:!0,value:void 0}),Object.defineProperty(this,W,{writable:!0,value:[]}),Object.defineProperty(this,Pe,{writable:!0,value:[]}),O(this,Se)[Se]=e,O(this,J)[J]=t!=null?t:{}}addAttributes(e){O(this,J)[J]={...O(this,J)[J],...e}}histogram({name:e,value:t,unit:n,bounds:a,attributes:o,scale:i}){const s=Date.now()*1e6;a?O(this,W)[W].push({name:e,type:"histogram",value:t,unit:n,timeUnixNano:s,attributes:o,bounds:a}):O(this,W)[W].push({name:e,type:"exponential_histogram",value:t,unit:n,timeUnixNano:s,attributes:o,scale:i})}counter({name:e,value:t,unit:n,attributes:a}){const o=Date.now()*1e6;O(this,W)[W].push({name:e,type:"counter",value:t,unit:n,timeUnixNano:o,attributes:a})}gauge({name:e,value:t,unit:n,attributes:a}){const o=Date.now()*1e6;O(this,W)[W].push({name:e,type:"gauge",value:t,unit:n,timeUnixNano:o,attributes:a})}log({body:e,attributes:t}){const n=Date.now()*1e6;O(this,Pe)[Pe].push({timeUnixNano:n,body:e,attributes:t})}async exportMetrics(){const e={};O(this,W)[W].forEach(n=>{switch(n.attributes={...O(this,J)[J],...n.attributes},n.type){case"histogram":si(e,n);break;case"exponential_histogram":li(e,n);break;case"counter":ci(e,n);break;case"gauge":di(e,n);break}});const t=Object.values(e);t.length!==0&&(O(this,W)[W]=[],await O(this,Se)[Se].exportMetrics(t))}async exportLogs(){const e=O(this,Pe)[Pe].map(t=>{const n={timeUnixNano:t.timeUnixNano,observedTimeUnixNano:t.timeUnixNano,attributes:ni({...O(this,J)[J],...t.attributes})};return t.body&&(n.body={stringValue:t.body}),n});e.length!==0&&(O(this,Pe)[Pe]=[],await O(this,Se)[Se].exportLogs(e))}}function si(r,e){var t;const{name:n,value:a,unit:o,timeUnixNano:i,attributes:s}=e,l=(t=e.bounds)!==null&&t!==void 0?t:ai,c=new Array(l.length+1).fill(0);r[n]||(r[n]={name:n,unit:o||"1",histogram:{aggregationTemporality:$r,dataPoints:[]}});for(let u=0;u<c.length;u++){const m=l[u];if(m===void 0)c[u]=1;else if(a<=m){c[u]=1;break}}r[n].histogram.dataPoints.push({startTimeUnixNano:i,timeUnixNano:i,count:1,sum:a,min:a,max:a,bucketCounts:c,explicitBounds:l,attributes:tr(s!=null?s:{})})}function li(r,e){const{name:t,value:n,unit:a,timeUnixNano:o,attributes:i,scale:s}=e;r[t]||(r[t]={name:t,unit:a||"1",exponentialHistogram:{aggregationTemporality:$r,dataPoints:[]}});const l=n<=0?0:n,c=s||3,u=2**c/Math.log(2),m=Math.ceil(Math.log(n)*u)-1,h=n<=0?1:0,g={offset:0,bucketCounts:[]},f={offset:n>0?m:0,bucketCounts:n>0?[1]:[]};r[t].exponentialHistogram.dataPoints.push({attributes:tr(i!=null?i:{}),startTimeUnixNano:o,timeUnixNano:o,count:1,sum:l,scale:c,zeroCount:h,positive:f,negative:g,min:l,max:l,zeroThreshold:0})}function ci(r,e){const{name:t,value:n,unit:a,timeUnixNano:o,attributes:i}=e;r[t]||(r[t]={name:t,unit:a||"1",sum:{aggregationTemporality:$r,isMonotonic:!0,dataPoints:[]}}),r[t].sum.dataPoints.push({startTimeUnixNano:o,timeUnixNano:o,asDouble:n,attributes:tr(i!=null?i:{})})}function di(r,e){const{name:t,value:n,unit:a,timeUnixNano:o,attributes:i}=e;r[t]||(r[t]={name:t,unit:a||"1",gauge:{dataPoints:[]}}),r[t].gauge.dataPoints.push({startTimeUnixNano:o,timeUnixNano:o,asDouble:n,attributes:tr(i!=null?i:{})})}var nt=_e("url"),Ie=_e("serviceName"),at=_e("logger"),ot=_e("fetchFn");class ui{constructor(e,t,n){Object.defineProperty(this,nt,{writable:!0,value:void 0}),Object.defineProperty(this,Ie,{writable:!0,value:void 0}),Object.defineProperty(this,at,{writable:!0,value:void 0}),Object.defineProperty(this,ot,{writable:!0,value:void 0}),O(this,nt)[nt]=e.replace(/\/v1\/(logs|metrics|traces)\/?$/,""),O(this,Ie)[Ie]=t,O(this,at)[at]=n==null?void 0:n.logger,O(this,ot)[ot]=n==null?void 0:n.fetchFn}async exportMetrics(e){const t={resourceMetrics:[{resource:{attributes:[{key:"service.name",value:{stringValue:O(this,Ie)[Ie]}}]},scopeMetrics:[{scope:{name:"open-telemetry-mini-client",version:"1.1.0",attributes:[]},metrics:e}]}]};await this.exportTo(t,"/v1/metrics")}async exportLogs(e){const t={resourceLogs:[{resource:{attributes:[{key:"service.name",value:{stringValue:O(this,Ie)[Ie]}}]},scopeLogs:[{scope:{name:"open-telemetry-mini-client",version:"1.1.0",attributes:[]},logRecords:e}]}]};await this.exportTo(t,"/v1/logs")}async exportTo(e,t){var n;const a=await this.exporterFetch()("".concat(O(this,nt)[nt]).concat(t),{method:"POST",keepalive:!0,headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if((n=O(this,at)[at])===null||n===void 0||n.log({status:a.status}),!a.ok){if(a.status===400){const o=await a.text();throw new ut("Invalid OpenTelemetry Data: ".concat(o))}if(a.status===429||a.status===503){const o=await a.text(),i=a.headers.get("Retry-After"),s=i?{seconds:Number(i)}:void 0;throw new ut("Server did not accept data",{errorData:o,retryAfter:s,body:e})}throw new ut("Server responded with ".concat(a.status))}}exporterFetch(){return O(this,ot)[ot]||fetch}}class ut extends Error{constructor(e,t){super(e),this.metadata=void 0,this.name="OpenTelemetryClientError",this.metadata=t}}const hi="https://otlp-http-production.shopifysvc.com",pi="portable_wallets";var qe;class mi{constructor(e){V(this,qe),F(this,qe,e)}async exportMetrics(e){var t;try{await P(this,qe).exportMetrics(e)}catch(n){if(n instanceof ut){const a=(t=n.metadata)==null?void 0:t.retryAfter;if(a){await new Promise(o=>{setTimeout(()=>{this.exportMetrics(e),o()},a.seconds*1e3)});return}}console.error("Suppressed error while exporting metrics:",n,n instanceof Error?n.cause:void 0)}}async exportLogs(e){var t;try{await P(this,qe).exportLogs(e)}catch(n){if(n instanceof ut){const a=(t=n.metadata)==null?void 0:t.retryAfter;if(a){await new Promise(o=>{setTimeout(()=>{this.exportLogs(e),o()},a.seconds*1e3)});return}}console.error("Suppressed error while exporting logs:",n,n instanceof Error?n.cause:void 0)}}}qe=new WeakMap;const gi=new ui(hi,pi),yi=new mi(gi),I=new ii({exporter:yi}),fi="TelemetryExportError",Ia="LimitedCartQueryError";class bi extends Error{constructor(){super(...arguments),d(this,"name",Ia)}}const va=["OpenTelemetryClientError",Ea,fi,Ca,St],wi=["Load failed","Failed to fetch","when attempting to fetch resource","GraphQL mutation failed with status 404","Component closed",'"isTrusted":true',...va],pn=new Map([["TypeError","Illegal constructor"],[Ia,"Limited cart query returned no response"],["AbortError","Fetch is aborted"],["SyntaxError","The string did not match the expected pattern."]]),_i=["chrome-lighthouse","meta-externalads","crawler","spider","scraper","facebookexternalhit","googleother","bot"];function Ai(r){const e=r.exceptions[0];return Ei()?"silenced-user-agent":Ci(r)?"empty-stack-trace":Si(e)?"spin":Pi()?"monkey-patch":Ti(r)?"external-error":Ri(r)?"developer-error":Ni(e.message)?"discarded-message":Di(r)?"discarded-error-class":ki(e)?"discarded-class-message":Oi(r)?"unactionable-invalid-error":Ii(r)||null}function Ei(){const r=navigator.userAgent.toLowerCase();return _i.some(e=>r.includes(e))}function Ci(r){return r.exceptions[0].stacktrace.length===0}function Si(r){return r.stacktrace.some(e=>{var t;return(t=e.file)==null?void 0:t.includes("spin.dev")})}function Pi(){return[HTMLElement,Event,document.createElement].some(Aa)}function Ii(r){const e=r.exceptions.map(t=>t.stacktrace.filter(n=>!vi(n)));return e.some(t=>{var n;return!((n=t[0])!=null&&n.inProject)})?"external-trigger":e.some(t=>t.filter(n=>n.inProject).every(n=>[ga,Br,ya].some(a=>n.file.startsWith(a))))?"wallet-sdk-stack-trace":null}function vi(r){return r.file.includes("native code")||r.file.includes("/cdn/wpm/")}function Ti(r){return!r.exceptions[0].stacktrace.some(e=>e.inProject)}function Ni(r){return wi.some(e=>r==null?void 0:r.includes(e))}function Ri(r){const e=r.exceptions.some(t=>t.errorClass===St);return e&&console.error(r.exceptions[0]),e}function Di(r){return r.exceptions.some(e=>va.includes(e.errorClass))}function ki(r){const e=r.errorClass,t=r.message;return pn.has(e)&&(t==null?void 0:t.includes(pn.get(e)))}function Oi(r){return r.exceptions[0].errorClass==="BugsnagInvalidError"&&r.unhandled}var N=(r=>(r.ButtonRender="portable_wallets_button_render",r.Decelerated="portable_wallets_decelerated",r.DeliveryWrongNumberOfLines="portable_wallets_delivery_wrong_number_of_lines",r.InitCompleted="portable_wallets_init_completed",r.InstrumentLoadEligibility="portable_wallets_instrument_load_eligibility",r.InstrumentLoadTime="portable_wallets_instrument_load_time",r.InstrumentLoadTimeFromPageLoad="portable_wallets_instrument_load_time_from_page_load",r.MonorailProduceError="portable_wallets_monorail_produce_error",r.SheetClicked="portable_wallets_sheet_clicked",r.SheetCancelled="portable_wallets_sheet_cancelled",r.SheetFailed="portable_wallets_sheet_failed",r.UpdateFailed="portable_wallets_update_failed",r.PayPalTokenCreationError="portable_wallets_paypal_token_creation_error",r.AuthorizationAttempt="portable_wallets_authorization_attempt",r.AuthorizationComplete="portable_wallets_authorization_complete",r.CartTokenMissing="portable_wallets_cart_token_missing",r.RemovePersonalDataResult="portable_wallets_cart_remove_personal_data_result",r.GooglePayNotEligibleWebview="portable_wallets_google_pay_not_eligible_webview",r.WalletConfigDeveloperError="portable_wallets_wallet_config_developer_error",r.LegacyCartCookie="portable_wallets_legacy_cart_cookie",r.StyleBackwardsCompatibility="portable_wallets_style_backwards_compatibility",r.StyleBackwardsCompatibilityExecutionTime="portable_wallets_style_backwards_compatibility_execution_time",r.StyleBackwardsCompatibilityRules="portable_wallets_style_backwards_compatibility_rules",r.AmazonPayLoadRetries="portable_wallets_amazon_pay_sdk_load_retries",r.DynamicTaxFailed="portable_wallets_dynamic_tax_failed",r.SheetLoaded="portable_wallets_sheet_loaded",r.ErrorTriggered="portable_wallets_error_triggered",r.GooglePayNullCartOnAuthorize="portable_wallets_google_pay_null_cart_on_authorize",r.GooglePayIso3166AdministrativeAreaFallback="portable_wallets_google_pay_iso3166_administrative_area_fallback",r.UnrecoverableCartError="portable_wallets_unrecoverable_cart_error",r.ShopPayPersonalizedIframeLoadTime="portable_wallets_shop_pay_personalized_iframe_load_time",r.ShopPayPersonalizedIframeLoadTimeFromPageLoad="portable_wallets_shop_pay_personalized_iframe_load_time_from_page_load",r.PaymentCompletedAfterAbort="portable_wallets_payment_completed_after_abort",r.WalletSessionAbortError="portable_wallets_wallet_session_abort_error",r.CartPaymentUpdateRetryResult="portable_wallets_cart_payment_update_retry_result",r.ProductFormError="portable_wallets_product_form_error",r))(N||{}),Ne=(r=>(r.InstrumentSdkLoaded="portable_wallets_instrument_sdk_loaded",r.InstrumentSdkFailed="portable_wallets_instrument_sdk_failed",r.InstrumentSdkEligible="portable_wallets_instrument_sdk_eligible",r.InstrumentSdkNotEligible="portable_wallets_instrument_sdk_not_eligible",r))(Ne||{}),y=(r=>(r.BuyItNow="BuyItNow",r.MoreOptions="MoreOptions",r.ApplePay="ApplePay",r.PayPal="PayPal",r.Venmo="Venmo",r.GooglePay="GooglePay",r.ShopPay="ShopPay",r.MetaPay="FacebookPay",r.BuyWithPrime="BuyWithPrime",r.AmazonPay="AmazonPay",r.Unknown="Unknown",r))(y||{}),L=(r=>(r.InvalidQuantity="InvalidQuantity",r.VariantRequiresSellingPlan="VariantRequiresSellingPlan",r.SellingPlanNotApplicable="SellingPlanNotApplicable",r.MerchandiseIdInvalid="MerchandiseIdInvalid",r.IgnoredResponseError="IgnoredGraphQLResponseError",r.NoResponse="NoResponse",r.InvalidInput="InvalidInput",r.MerchandiseNotApplicable="MerchandiseNotApplicable",r.ProductFormError="ProductFormError",r))(L||{}),R=(r=>(r.CartPage="cart_page",r.CartAjax="cart_ajax",r.ProductPage="product",r.Checkout="checkout",r.Unknown="unknown",r))(R||{}),lt=(r=>(r.CartChange="/cart/change",r.CartUpdate="/cart/update",r.CartAdd="/cart/add",r.CartClear="/cart/clear",r))(lt||{}),De=(r=>(r.OneTimePurchase="ONE_TIME_PURCHASE",r.Subscription="SUBSCRIPTION",r))(De||{});let rr=Li();function Li(){return{shop_id:wa,debug:!1,pageType:R.Unknown,cartPrepare:!1}}function Ta(r){Object.assign(rr,r)}function zr(){const{debug:r,...e}=rr;return e}function xi(){return rr.debug}function Hr(){return rr.pageType}function Mi(r,e){const t=r.exceptions[0];if(!t||!t.message||Zo.checkDuplicate(t))return!1;const n=Fi(e);Ui(r,n);let a=null;try{a=Ai(r)}catch(i){const s=i;console.error(s);const l={errorClass:"UnfilterableError",message:"Could not properly filter error with message: ".concat(s.message),stacktrace:ha(ba,s)};r.exceptions.unshift(l)}Hi(a);const o=a==null;return(o||xi())&&Gi({errorClass:t.errorClass,message:t.message,stacktrace:JSON.stringify(t.stacktrace),filterResult:a,metadata:JSON.stringify(r.metaData)}),o}function Ui(r,e){var t,n,a,o,i;const s=(a=(n=(t=window.ShopifyAnalytics)==null?void 0:t.lib)==null?void 0:n.trekkie)==null?void 0:a.defaultAttributes;r.context=window.location.pathname,r.request||(r.request={}),r.request.url=window.location.href,r.device.orientation=(i=(o=window.screen)==null?void 0:o.orientation)==null?void 0:i.type,$i(r),zi(r),r.groupingHash=Bi(e);const{shop_id:l,...c}=zr();r.metaData={...r.metaData,shop:{shopId:l,...c,...r.metaData.shop},custom:{...r.metaData.custom,customFetch:Aa(fetch)},error_source:{shop_id:l},monorail:s},e[0]instanceof Pt&&(r.metaData.graphql={...e[0].errorDetails},e[0]instanceof Ve&&(r.metaData.graphql.reason=e[0].reason))}function Bi(r){for(const e of r)if("groupingHash"in e&&e.groupingHash)return e.groupingHash.toString()}function Fi(r){const e=[];let t=r;for(;t instanceof Error&&e.length<20;){e.push(t);const n="cause"in t?t.cause:null;if(!n)break;t=n}return e}function $i(r){for(const e of r.exceptions)for(const t of e.stacktrace)[ga,Br,ya].some(n=>t.file.startsWith(n))&&(t.inProject=!0)}function zi(r){var e;for(const t of r.exceptions)for(const n of t.stacktrace)(e=n.file)!=null&&e.includes("portable-wallets")&&(n.file=n.file.split("#")[0].split("?")[0])}function Hi(r){I.counter({name:N.ErrorTriggered,value:1,attributes:{filterResult:r||"valid-error"}})}function Gi(r){const e=zr();I.log({body:"Bugsnag Error",attributes:{...e,shop_id:e.shop_id,shopId:e.shop_id,...r}})}var sa;const Vi={apiKey:"e6b446c1ebe782e2b2fc7eb8ef0dc791",appId:ba,appVersion:"0.1.32",releaseStage:"production",locale:"en",userAgent:navigator.userAgent,metadata:{user:{id:(sa=yt(Jo))!=null?sa:"unknown"},app:{release:"d12d8621aaba3a3a030422cd8ffe92bb39522d40"}},onError:Mi},b=new jo(Vi);b.addOnPostError(r=>{b.leaveBreadcrumb("Bugsnag Error Notified",{errorClass:r.exceptions[0].errorClass,message:r.exceptions[0].message},"error")});const ji={en:{express_checkout:"Express checkout",instruments_copy:{checkout:{buy_now:"Buy it now"}},error_dialogs:{checkout:{title:"Transaction failed",generic_error:"Checkout is currently unavailable due to technical problems. Please try again in a few minutes.",button_text:"Close"},product:{out_of_stock:"This item is no longer available."},wallet:{title:"%{wallet} unavailable",generic_error:"There was an issue with %{wallet}. Try again or use a different payment method.",eligibility_error:"Items that were eligible for %{wallet} are no longer in your cart."}},more_payment_options:"More payment options",action:{view:"View %{content}"},subscriptions:{cancellation_policy:"Cancellation policy",policy_not_found:"The subscription policy could not be found. Refresh the page or contact us for more information."},managed_markets:{terms_and_conditions:"Merchant of Record Terms and Conditions",privacy_policy:"Merchant of Record Privacy Policy",policy_not_found:"The policy could not be found. Refresh the page or contact us for more information"},shipping_methods:{connect_shipping_methods:"%{methodOne} and %{methodTwo}",choose_delivery_strategy:"Choose a delivery method"},delivery_promises:{connect_delivery_promises:"%{promiseOne} and %{promiseTwo}"},order_summary:{total:"Total",subtotal:"Subtotal",duties:"Duties",taxes:"Estimated taxes",shipping:"Shipping",shipping_one_time_purchase:"Shipping (One-time purchase)",shipping_subscription:"Shipping (Subscription)",discount:"Discount",subscriptions:{recurring_total_tooltip_line:"Does not include shipping, tax, duties, or any applicable discounts",recurring_totals:"%{fixedPrice} every %{interval}",recurring_totals_with_policies:{one:"First payment %{fixedPrice}, then %{recurringPrice} every %{interval}",other:"First %{count} payments %{fixedPrice} each, then %{recurringPrice} every %{interval}"},recurring_total_intervals:{day:{one:"day",other:"%{count} days"},month:{one:"month",other:"%{count} months"},week:{one:"week",other:"%{count} weeks"},year:{one:"year",other:"%{count} years"}}}},brand:{amazon_pay:"Amazon Pay",apple_pay:"Apple Pay",buy_with_prime:"Buy with Prime",paypal:"PayPal",google_pay:"Google Pay",shop_pay:"Shop Pay"},buy_with_button_content:"Buy with %{wallet}",pay_with_button_content:"Pay with %{wallet}",shop_promise_delivery:{same_day:"Same-day delivery",next_day:"Next-day delivery",two_day:"2-day delivery"},errors:{address_unserviceable:"%{shopName} does not currently deliver to this address. Use a different address to complete your purchase.",missing:{email:"Enter an email address",first_name:"Enter a first name",last_name:"Enter a last name",address1:"Enter an address",address2:"Enter an apartment, suite, etc.",city:"Enter a city",zone:"Select a state / province",country:"Select a country",phone:"Enter a phone number",postal_code:"Enter a ZIP / postal code",shipping_option:"Select a shipping method",emirate:"Enter an emirate"},invalid:{email:"Enter a valid email",first_name:"Enter a valid first name",last_name:"Enter a valid last name",address1:"Enter a valid address",address2:"Enter a valid apartment, suite, etc.",city:"Enter a valid city",zone:"Select a valid state / province",country:"Select a country / region",phone:"Enter a valid phone number",postal_code:"Enter a valid zip / postal code",billing_address:"Invalid billing address",shipping_address:"Invalid shipping address",payment_method:"Invalid payment method",discount:"Invalid discount",emirate:"Enter a valid emirate"},emojis:{first_name:"First name cannot contain emojis",last_name:"Last name cannot contain emojis",city:"City cannot contain emojis",address1:"Address line cannot contain emojis",address2:"Second address line cannot contain emojis",postal_code:"Postal code/zip cannot contain emojis",phone:"Phone number cannot contain emojis"},too_long:{address1:"Address line is too long",address2:"Second address line is too long",first_name:"First name is too long",last_name:"Last name is too long",city:"City is too long"},url:{first_name:"First name cannot contain a URL",last_name:"Last name cannot contain a URL"},html_tags:{first_name:"First name cannot contain HTML tags",last_name:"Last name cannot contain HTML tags",city:"City cannot contain HTML tags",address1:"Address line cannot contain HTML tags",address2:"Second address line cannot contain HTML tags"},currency:{mismatch:"Your cart and currency has been updated based on your shipping country."}}}};let ur;class mn extends Error{constructor(e,t){const n="i18n: Missing or invalid translation '".concat(e,"' in '").concat(t,"'");super(n)}}class qi extends Error{constructor(e,t,n){const a="i18n: Missing translation template key '".concat(e,"' for '").concat(t,"' in '").concat(n,"'");super(a)}}class Wi extends Error{constructor(e,t,n){const a="i18n: Invalid pluralization for '".concat(e,"':'").concat(t,"' in '").concat(n,"'");super(a)}}function nr(){return ur==null&&(ur=Yi(ji)),ur}function Yi(r){const e=(o,i)=>typeof o!="string"&&i.count!=="undefined",t=(o,i)=>{let s=i===1?"one":"other";return i===0&&typeof o!="string"&&o.zero!=="undefined"&&(s="zero"),s},n=(o,i={})=>{const s=o.match(/%\{.+?\}/g);return s?s.reduce((l,c)=>{const u=c.replace(/%\{(.*)\}/,"$1");return i[u]?l.replace(c,i[u]):(b.notify(new qi(u,o,a)),l)},o):o},a=Ki();return{locale:a,translate(o,i={}){var s;const l=o.split(".");let c=r[a];try{for(const u of l)switch(typeof c){case"object":c=c[u];break;case"string":case"undefined":throw new mn(o,a)}if(e(c,i)){if(typeof c=="string")throw new Wi(o,c,a);c=c[t(c,i.count)]}if(typeof c!="string")throw new mn(o,a);return n(c,i)}catch(u){return b.notify(u),(s=i.defaultValue)!=null?s:o}}}}function Ki(){return"en"}function gn(r){const e=document.querySelectorAll("shopify-accelerated-checkout .shopify-payment-button__skeleton, shopify-accelerated-checkout-cart .wallet-cart-button__skeleton"),t=document.getElementById("shopify-buyer-consent");for(let n=0;n<e.length;n++)e[n].remove();t&&t.remove()}function Na(r){!(r instanceof ErrorEvent)||!(typeof r.message=="string"&&r.message.includes("import.meta"))||!(typeof r.filename=="string"&&r.filename.includes("portable-wallets"))||(window.removeEventListener("error",Na),window.Shopify.PaymentButton.failedToLoad=r,document.readyState==="loading"?document.addEventListener("DOMContentLoaded",window.Shopify.PaymentButton.init):window.Shopify.PaymentButton.init())}window.addEventListener("error",Na);const ct=[];function ce(r,e,t){if(window.customElements==null)return b.leaveBreadcrumb("customElements is null on window"),gn(),!1;try{const n=e;return window.customElements.get(r)||(window.customElements.define(r,n),t!=null&&t.isChildCustomElement&&ct.push(r)),!0}catch(n){return b.notify(n),gn(),!1}}function xt(){const r=new URLSearchParams(window.location.search);return function(e){return!!r.get(e)}}function Qi(){var r,e,t,n;const a=(r=window.Shopify)==null?void 0:r.CartType;if(a===R.CartAjax)return R.CartAjax;if(a===R.CartPage)return R.CartPage;const o=(n=(t=(e=window.ShopifyAnalytics)==null?void 0:e.meta)==null?void 0:t.page)==null?void 0:n.pageType;if(o)switch(o.toLowerCase()){case"product":return R.ProductPage;case"cart":return R.CartPage}const i=document.querySelector("#shop-js-analytics");if(i)try{const s=JSON.parse(i.textContent||"{}");if(s.pageType)switch(s.pageType.toLowerCase()){case"product":return R.ProductPage;case"cart":return R.CartPage}}catch(s){console.error("Error parsing JSON script tag:",s)}return R.Unknown}function ye(r){return Number(r).toFixed(2)}function Gr(r){return Mt(r==null?void 0:r.id)}function Mt(r){if(r!=null&&r.includes("gid://shopify/Cart/"))return r.replace("gid://shopify/Cart/","").split("?")[0]}function he(){let r;return[new Promise(e=>r=e),r]}function Ra(){return!!document.querySelector('[data-source-attribution="shopify.shop-promise-pdp"]')}function oe(){return new Date().getTime()}function Vr(r){return r.find(e=>e.code===fa&&!!e.message)}function yn(){const r=window.navigator.userAgent,e=r.includes("iPhone OS 26_0"),t=r.includes("Version/26.0"),n=r.includes("iPhone OS");return e||t&&n}function Ji(r){return r.title==="Default Title"?r.product.title:"".concat(r.product.title," - ").concat(r.title)}function Da(r,e){return r.map(t=>{let n=Ji(t.merchandise);t.isNestedLine&&(n="\u2937 ".concat(n));const a=ye(t.totalAmount.amount);return e(n,a)})}function Xi(){var r;return(r=window.scheduler)!=null&&r.yield?window.scheduler.yield():new Promise(e=>{var t;(t=window.scheduler)!=null&&t.postTask?window.scheduler.postTask(e):setTimeout(e,0)})}class Zi extends HTMLElement{constructor(){super(...arguments),d(this,"originalStyle",{position:"",overflow:"",top:""}),d(this,"scrollPosition",0),d(this,"formerFocus",null)}connectedCallback(){this.attachShadow({mode:"open"}),this.formerFocus=document.activeElement;const e=nr();this.render(e);const t=this.shadowRoot,n=t.getElementById("modal");t.querySelectorAll("button").forEach(i=>i.addEventListener("click",this.closeModal.bind(this)));const a=t.getElementById("overlay");a==null||a.addEventListener("click",i=>this.handleOutsideClick(i,n)),document.addEventListener("keydown",this.handleEscapeKey.bind(this));const o=document.createElement("style");o.textContent=Bo,t.appendChild(o),this.applyScrollLock(),this.trapFocus(n,t),ce("svg-icon",Uo)}trapFocus(e,t){if(!e)return;const n=e.querySelectorAll("a[href], button"),a=Array.from(n),o=a[0],i=a[a.length-1];e.addEventListener("keydown",s=>{s.key==="Tab"&&!s.shiftKey&&t.activeElement===i&&(s.preventDefault(),o.focus()),s.key==="Tab"&&s.shiftKey&&t.activeElement===o&&(s.preventDefault(),i.focus())}),o.focus()}handleOutsideClick(e,t){t&&(t.contains(e.target)||this.closeModal())}handleEscapeKey(e){e.key==="Escape"&&this.closeModal()}closeModal(){var e;this.removeScrollLock(),this.remove(),this.formerFocus&&"focus"in(this==null?void 0:this.formerFocus)&&typeof this.formerFocus.focus=="function"&&((e=this.formerFocus)==null||e.focus())}applyScrollLock(){this.originalStyle={position:document.body.style.position,overflow:document.body.style.overflow,top:document.body.style.top},document.body.style.overflow="hidden",yn()&&(this.scrollPosition=window.scrollY,document.body.style.position="fixed",document.body.style.top="-".concat(this.scrollPosition,"px"))}removeScrollLock(){var e,t,n,a,o,i;document.body.style.overflow=(t=(e=this.originalStyle)==null?void 0:e.overflow)!=null?t:"",yn()&&(document.body.style.position=(a=(n=this.originalStyle)==null?void 0:n.position)!=null?a:"",document.body.style.top=(i=(o=this.originalStyle)==null?void 0:o.top)!=null?i:"",window.scrollTo({top:this.scrollPosition,behavior:"instant"}))}render(e){const t=this.getAttribute("title"),n=this.getAttribute("has-close-button"),a=e.translate("error_dialogs.checkout.button_text"),o='\n      <footer>\n        <button type="button" id="close-button" tabindex="0">'.concat(a,"</button>\n      </footer>\n    ");this.shadowRoot.innerHTML='\n      <div id="overlay">\n        <div id="modal" role="dialog" aria-modal="true" aria-labelledby="title">\n          <header>\n            <h2 id="title">\n              <span class="capitalize">'.concat(t,'</span>\n            </h2>\n            <button type="button" id="close-icon" aria-label=').concat(a,' tabindex="0">\n              <svg-icon color="gray"></svg-icon>\n            </button>\n          </header>\n          <div id="content">\n            <p><slot></slot></p>\n          </div>\n          ').concat(n?o:"","\n        </div>\n      </div>\n    ")}}const es="@keyframes topLevelModalLoadingSkeleton{50%{opacity:1}75%{opacity:.5}to{opacity:1}}top-level-modal .text-skeleton{display:inline-block;width:100%;height:14px;margin-bottom:7px;animation:topLevelModalLoadingSkeleton 4s ease infinite;animation-delay:-.168s;text-decoration:none!important;background-color:#dedede}top-level-modal .text-skeleton:last-of-type{width:50%}";function ar({type:r="button",label:e=void 0}={}){const t=document.createElement("button");return t.type=r,e&&t.setAttribute("aria-label",e),t}function It(r,e){for(const[t,n]of Object.entries(e))r.setAttribute(t,n)}function ht(r,e){for(const[t,n]of Object.entries(e))r.style.setProperty(t,n)}function ka(){return"\n    <style>".concat(es,'</style>\n    <span class="text-skeleton">&nbsp;</span>\n    <span class="text-skeleton">&nbsp;</span>\n    <span class="text-skeleton">&nbsp;</span>\n    <span class="text-skeleton">&nbsp;</span>\n    <span class="text-skeleton">&nbsp;</span>\n  ')}function ts(){const r=document.querySelector("top-level-modal");r&&"closeModal"in r&&typeof r.closeModal=="function"&&r.closeModal()}function Oa(r){ts();const e=document.createElement("top-level-modal");return It(e,{"data-testid":"top-level-modal",title:r}),e}function rs(r,e){r.innerHTML='<div style="text-align: center;">'.concat(e,"</div>")}function vt(r,e){const t=document.createElement("top-level-modal");t.textContent=e,It(t,{"data-testid":"top-level-modal","has-close-button":"true",title:r}),document.body.appendChild(t)}function jr(r,e,t){const n=Oa(r);e instanceof Promise?(n.innerHTML=ka(),e.then(a=>{a&&a!==""?n.innerHTML=a:n.innerHTML=t!=null?t:""}).catch(()=>{n.innerHTML=t!=null?t:""})):n.innerHTML=e,document.body.appendChild(n)}function ie(r,e){vt(e.translate("error_dialogs.wallet.title",{wallet:r}),e.translate("error_dialogs.wallet.generic_error",{wallet:r}))}function Je(r){vt(r.translate("error_dialogs.checkout.title"),r.translate("error_dialogs.checkout.generic_error"))}function Le(r,e){vt(r.translate("error_dialogs.checkout.title"),e)}function xe(r,e){switch(e){case L.InvalidQuantity:case L.VariantRequiresSellingPlan:case L.SellingPlanNotApplicable:case L.MerchandiseIdInvalid:case L.IgnoredResponseError:case L.NoResponse:case L.ProductFormError:Je(r);break}}function be(r){vt(r.translate("error_dialogs.checkout.title"),r.translate("error_dialogs.product.out_of_stock"))}ce("top-level-modal",Zi);class Tt extends HTMLElement{get buyerCountry(){return this.getAttribute("buyer-country")}get buyerCurrency(){const e=this.getAttribute("buyer-currency");if(e==null)throw new Error("WalletElement buyer-currency is null");return e}get accessToken(){return this.getAttribute("access-token")}get disabled(){return this.hasAttribute("disabled")}set disabled(e){e?this.setAttribute("disabled",""):this.removeAttribute("disabled")}get hasSellingPlan(){const e=this.getAttribute("has-selling-plan");return e==="true"||e===""}set hasSellingPlan(e){e?this.setAttribute("has-selling-plan",""):this.removeAttribute("has-selling-plan")}get isShippingRequired(){const e=this.getAttribute("requires-shipping");return e==="true"||e===""}set isShippingRequired(e){e?this.setAttribute("requires-shipping",""):this.removeAttribute("requires-shipping")}get pciEnabled(){return this.hasAttribute("pci-enabled")}}const ns="#more-payment-options-link{cursor:pointer}";function as(r,e,t){return(e=is(e))in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function fn(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(r,a).enumerable})),t.push.apply(t,n)}return t}function bn(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?fn(Object(t),!0).forEach(function(n){as(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):fn(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function os(r,e){if(typeof r!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function is(r){var e=os(r,"string");return typeof e=="symbol"?e:e+""}const ss="https://monorail-edge.shopifysvc.com",ls="/v1/produce";function cs(){if(typeof crypto<"u"&&crypto&&typeof crypto.randomUUID=="function")return crypto.randomUUID();const r=new Array(36);for(let e=0;e<36;e++)r[e]=Math.floor(Math.random()*16);return r[14]=4,r[19]=r[19]&=-5,r[19]=r[19]|=8,r[8]=r[13]=r[18]=r[23]="-",r.map(e=>e.toString(16)).join("")}function ds(r,e=!0){return r&&Object.keys(r).length&&e?Object.keys(r).map(t=>({[us(t)]:r[t]})).reduce((t,n)=>bn(bn({},t),n)):r}function us(r){return r.split(/(?=[A-Z])/).join("_").toLowerCase()}function hs(r){const e={"Content-Type":"application/json; charset=utf-8","X-Monorail-Edge-Event-Created-At-Ms":(r&&r.eventCreatedAtMs||Date.now()).toString(),"X-Monorail-Edge-Event-Sent-At-Ms":Date.now().toString(),"X-Monorail-Edge-Client-Message-Id":(r&&r.clientMessageId||cs()).toString()};return r&&r.userAgent&&(e["User-Agent"]=r.userAgent),r&&r.remoteIp&&(e["X-Forwarded-For"]=r.remoteIp),r&&r.deviceInstallId&&(e["X-Monorail-Edge-Device-Install-Id"]=r.deviceInstallId),r&&r.client&&(e["X-Monorail-Edge-Client"]=r.client),r&&r.clientOs&&(e["X-Monorail-Edge-Client-OS"]=r.clientOs),e}async function ps({endpoint:r,event:e,keepalive:t}){var n,a,o,i,s;const l=e.metadata?{clientMessageId:(n=e.metadata)===null||n===void 0?void 0:n.clientMessageId,eventCreatedAtMs:(a=e.metadata)===null||a===void 0?void 0:a.eventCreatedAtMs,consent:(o=e.metadata)===null||o===void 0?void 0:o.consent,consent_provider:(i=e.metadata)===null||i===void 0?void 0:i.consent_provider,consent_version:(s=e.metadata)===null||s===void 0?void 0:s.consent_version}:void 0;return fetch(r!=null?r:ss+ls,{method:"post",headers:hs(e.metadata),body:JSON.stringify({schema_id:e.schemaId,payload:e.payload,metadata:l&&ds(l,!0)}),keepalive:t})}const ms="2.1",gs="3",hr={NO_VALUE:"",ACCEPTED:"1",DECLINED:"0"},K={PREFERENCES:"p",ANALYTICS:"a",MARKETING:"m",SALE_OF_DATA:"t"},de={MARKETING:"m",ANALYTICS:"a",PREFERENCES:"p",SALE_OF_DATA:"s"};function Cr(r){try{return decodeURIComponent(r)}catch(e){return""}}const ys=()=>typeof __CtaTestEnv__>"u"?!1:__CtaTestEnv__==="true",fs="_tracking_consent";function bs(){try{return document.cookie}catch(r){return!1}}function La(r,e=!1){const t=bs()?document.cookie.split("; "):[];for(let n=0;n<t.length;n++){const[a,o]=t[n].split("=");if(r===Cr(a))return Cr(o)}if(e&&r==="_tracking_consent"&&!window.localStorage.getItem("tracking_consent_fetched"))return ys()?void 0:(console.debug("_tracking_consent missing"),ws(),window.localStorage.setItem("tracking_consent_fetched","true"),La(r,!1))}function ws(r="/"){const e=new XMLHttpRequest;e.open("HEAD",r,!1),e.withCredentials=!0,e.send()}function _s(){return La(fs)}const As="_cmp";function Es(){try{var r;const[e]=(r=performance)===null||r===void 0?void 0:r.getEntriesByType("navigation"),t=e==null?void 0:e.serverTiming.find(a=>a.name===As);let n=t==null?void 0:t.description;if(!n)return;try{n=decodeURIComponent(n)}catch(a){}return n}catch(e){return}}const Cs="_cs";function Ss(){return new URLSearchParams(window.location.search).get(Cs)||void 0}function Ps(){var r,e;const t=(r=window.Shopify)===null||r===void 0||(e=r.customerPrivacy)===null||e===void 0?void 0:e.cachedConsent;return t?Cr(t):void 0}function Is(){const r=Ps()||Ss()||_s()||Es();if(r!==void 0)return vs(r)}function vs(r){if(r.slice(0,1)=="%")try{r=decodeURIComponent(r)}catch(t){}const e=r.slice(0,1);if(e=="{")return Ts(r);if(e=="3")return Ns(r)}function Ts(r){var e;let t;try{t=JSON.parse(r)}catch(n){return}if(t.v===ms&&(e=t.con)!==null&&e!==void 0&&e.CMP)return t}function Ns(r){const e=r.slice(1).split("_"),[t,n,a,o,i]=e;let s;try{s=e[5]?JSON.parse(e.slice(5).join("_")):void 0}catch(m){}let l;if(i){const m=i.replace(/\*/g,"/").replace(/-/g,"+"),h=Array.from(atob(m)).map(g=>g.charCodeAt(0).toString(16).padStart(2,"0")).join("");l=[8,13,18,23].reduce((g,f)=>g.slice(0,f)+"-"+g.slice(f),h)}function c(m){const h=t.split(".")[0];return h.includes(m.toLowerCase())?hr.DECLINED:h.includes(m.toUpperCase())?hr.ACCEPTED:hr.NO_VALUE}function u(m){return t.includes(m.replace("t","s").toUpperCase())}return{v:gs,con:{CMP:{[de.ANALYTICS]:c(de.ANALYTICS),[de.PREFERENCES]:c(de.PREFERENCES),[de.MARKETING]:c(de.MARKETING),[de.SALE_OF_DATA]:c(de.SALE_OF_DATA)}},region:n||"",cus:s,purposes:{[K.ANALYTICS]:u(K.ANALYTICS),[K.PREFERENCES]:u(K.PREFERENCES),[K.MARKETING]:u(K.MARKETING),[K.SALE_OF_DATA]:u(K.SALE_OF_DATA)},sale_of_data_region:o=="t",display_banner:a=="t",consent_id:l}}function or(r){const e=Is();if(!e||!e.purposes)return!0;const t=e.purposes[r];return typeof t=="boolean"?t:!0}function Rs(){return or(K.PREFERENCES)}function Ds(){return or(K.ANALYTICS)}function ks(){return or(K.MARKETING)}function Os(){return or(K.SALE_OF_DATA)}function Ls(){return Ds()}function xs(){return Rs()}function Ms(){return ks()}function Us(){return Os()}function Bs(){return Ms()}function Fs(){return Ls()}function $s(){return xs()}function zs(){return Us()}function Hs(){const r=[];return Fs()&&r.push("analytics"),Bs()&&r.push("marketing"),zs()&&r.push("sale_of_data"),$s()&&r.push("preferences"),r}function Gs(r,e){switch(e){case"v1":{const t=Hs();return{...r,metadata:{...r==null?void 0:r.metadata,consent:t,consent_provider:"consent-tracking-api",consent_version:e}}}default:throw new qr(e)}}class qr extends Error{constructor(e){super("Version ".concat(e," is not supported by the consent-tracking-api provider")),this.name="MonorailConsentTrackingApiProviderVersionError",Object.setPrototypeOf(this,qr.prototype)}}const Vs=["Chrome-Lighthouse","Googlebot"];function js(){const r=navigator.userAgent;return Vs.some(e=>r.includes(e))}async function qs(r){if(js())return;const e=Gs(r,"v1");let t;try{t=await ps({event:e})}catch(n){}if(!(t!=null&&t.ok))try{I.counter({name:N.MonorailProduceError,value:1,attributes:{schemaId:e.schemaId}})}catch(n){}}const pr="shopify_wallet_checkout_track/6.3";async function H(r){var e,t,n,a,o,i,s;const l=await Ws();if(!l)return;const c={schemaId:pr,payload:{app_name:"storefront",page_type:Qi(),checkout_one:!0,event:r.event,event_subtype:r.eventSubtype,checkout_token:r.checkoutToken,instrument_id:r.instrumentId,ttl:r.ttl,error_reason:r.errorReason,uniq_token:(e=l==null?void 0:l.uniqToken)!=null?e:"",visit_token:(t=l==null?void 0:l.visitToken)!=null?t:"",micro_session_id:(n=l==null?void 0:l.microSessionId)!=null?n:"",micro_session_count:(a=l==null?void 0:l.microSessionCount)!=null?a:0,shop_id:(o=l==null?void 0:l.shopId)!=null?o:0,theme_id:l==null?void 0:l.themeId,theme_city_hash:(i=l==null?void 0:l.themeCityHash)!=null?i:"",content_language:(s=l==null?void 0:l.contentLanguage)!=null?s:"",referer:l==null?void 0:l.referer}};b.leaveBreadcrumb("monorail event produced to ".concat(pr),{schemaId:pr,payload:r});try{await qs(c)}catch(u){b.notify(new Ys("Failed to send monorail event: ".concat(u),{cause:u}),{metadata:{request:{monorail:{payload:JSON.stringify(c)}}}})}}async function Ws(){var r,e,t,n,a;return(e=(r=window==null?void 0:window.ShopifyAnalytics)==null?void 0:r.lib)!=null&&e.trekkie||await new Promise(o=>{const i=setInterval(()=>{var l,c;(c=(l=window==null?void 0:window.ShopifyAnalytics)==null?void 0:l.lib)!=null&&c.trekkie&&(clearInterval(i),o())},100),s=setTimeout(()=>{clearInterval(i),clearTimeout(s),o()},7e3)}),(a=(n=(t=window.ShopifyAnalytics)==null?void 0:t.lib)==null?void 0:n.trekkie)==null?void 0:a.defaultAttributes}class Ys extends Error{constructor(){super(...arguments),d(this,"name","MonorailError")}}var B=(r=>(r.CartInitCalled="portable_wallets_cart_init_called",r.ClickSheetCancelled="portable_wallets_instrument_click_sheet_cancelled",r.ClickSheetFailed="portable_wallets_instrument_click_sheet_failure",r.ClickSheetSuccess="portable_wallets_instrument_click_sheet_success",r.SheetFailed="portable_wallets_instrument_sheet_failed",r.AuthorizationAttempt="portable_wallets_authorization_attempt",r.AuthorizationComplete="portable_wallets_authorization_complete",r.InitCalled="portable_wallets_init_called",r.InitFailed="portable_wallets_init_failed",r.InitSuccess="portable_wallets_init_success",r.UpdateFailed="portable_wallets_instrument_update_failed",r.InstrumentLoaded="portable_wallets_instrument_loaded",r.InstrumentLoadFailed="portable_wallets_instrument_load_failed",r.FirstVisible="portable_wallets_first_visible",r.FirstVisibleNotAvailable="portable_wallets_first_visible_not_available",r.SheetLoaded="portable_wallets_sheet_loaded",r.ShopPayButtonInView="portable_wallets_shop_pay_button_in_view",r.ShopPayButtonTextExperiment="portable_wallets_shop_pay_button_text_experiment",r.RecoveryFlowInitiated="portable_wallets_recovery_flow_initiated",r))(B||{});const wn={[R.Checkout]:"bwp_checkout_widget_click",[R.CartAjax]:"bwp_cart_widget_click",[R.CartPage]:"bwp_cart_widget_click",[R.ProductPage]:"bwp_widget_click",[R.Unknown]:"bwp_widget_click"};function Ks({apiClientId:r,skus:e,pageType:t}){var n;if(!((n=window.Shopify)!=null&&n.analytics))return;const a=t&&wn[t]||"bwp_widget_click";a===wn[R.Checkout]&&window.Shopify.analytics.publish("shopify:app:pixels:load:".concat(r),{},{sendTo:"PIXEL-LOADER"}),e&&window.Shopify.analytics.publish(a,{skus:e},{sendTo:r})}const Re="d6d12da0",Qs="ce346acf",xa="a1c7ccbe",Wr="32a68cd0",Js="5865c7bd",_n=new Set;let An=!1;const j={register:r=>{An||(An=!0,r.forEach(e=>_n.add(e)))},enabled:r=>_n.has(r),reset:()=>{}};function D(r){return{pageType:Hr(),cartPrepare:j.enabled(Re),...r}}function Xs(){const r=Hr()===R.CartPage?B.CartInitCalled:B.InitCalled;H({event:r})}function Zs(r){var e,t;const n=r?"Failed":"Success",a=r&&wl(r)?"[".concat(r.name,"]: ").concat(r.code):void 0,o=B["Init".concat(n)];H({event:o,eventSubtype:a}),I.counter({name:N.InitCompleted,value:1,attributes:D({result:n.toLowerCase(),eventType:a,recoveredFailure:!!((t=(e=window.Shopify)==null?void 0:e.PaymentButton)!=null&&t.failedToLoad)})})}function el({instrumentOrComponentName:r,result:e,measurement:t}){H({event:e==="success"?B.InstrumentLoaded:B.InstrumentLoadFailed,instrumentId:r,ttl:t}),t!=null&&(I.histogram({name:N.InstrumentLoadTime,value:t,attributes:D({instrument:r,result:e}),unit:"ms"}),I.histogram({name:N.InstrumentLoadTimeFromPageLoad,value:window.performance.now(),attributes:D({instrument:r,result:e}),unit:"ms"}))}function tl({instrument:r,measurement:e,result:t}){const n=t==="success"?Ne.InstrumentSdkLoaded:Ne.InstrumentSdkFailed;H({event:n,instrumentId:r,ttl:e,errorReason:t==="success"?void 0:t}),e!=null&&I.histogram({name:Ne.InstrumentSdkLoaded,value:e,attributes:D({instrument:r,result:t}),unit:"ms"})}function rl({instrument:r,result:e,reason:t}){const n=e==="success"?Ne.InstrumentSdkEligible:Ne.InstrumentSdkNotEligible;H({event:n,instrumentId:r}),I.counter({name:Ne.InstrumentSdkEligible,value:1,attributes:D({instrument:r,reason:t,result:e})})}function nl({instrument:r,result:e,reason:t}){I.counter({name:N.InstrumentLoadEligibility,value:1,attributes:D({instrument:r,result:e,reason:t})})}function al(r){I.counter({name:N.ButtonRender,value:1,attributes:D({result:"success",instrument:r})})}function ol(r){I.counter({name:N.ButtonRender,value:1,attributes:D({result:"failed",instrument:r})})}function il({instrument:r,result:e,webPixelMetaData:t,reason:n}){H({event:e==="success"?B.ClickSheetSuccess:B.ClickSheetFailed,instrumentId:r}),I.counter({name:N.SheetClicked,value:1,attributes:D({instrument:r,result:e,...n&&{reason:n}})}),r===y.BuyWithPrime&&t&&Ks(t)}function sl({instrument:r,request:e,error:t}){H({event:"".concat(B.UpdateFailed,"-").concat(e),instrumentId:r}),t&&p.log({body:"Update failed with error",attributes:{instrument:r,request:e,error:String(t)}}),I.counter({name:N.UpdateFailed,value:1,attributes:D({instrument:r,request:e})})}function ll({errorCode:r}){I.counter({name:N.PayPalTokenCreationError,value:1,attributes:D({errorCode:r})})}function cl(r){H({event:B.ClickSheetCancelled,instrumentId:r}),I.counter({name:N.SheetCancelled,value:1,attributes:D({instrument:r})})}function dl(r,e){H({event:B.SheetFailed,instrumentId:r,errorReason:e==null?void 0:e.message}),I.counter({name:N.SheetFailed,value:1,attributes:D({instrument:r})})}function ul(r){H({event:B.AuthorizationAttempt,instrumentId:r}),I.counter({name:N.AuthorizationAttempt,value:1,attributes:D({instrument:r})})}function hl({instrument:r,measurement:e,result:t}){H({event:B.AuthorizationComplete,eventSubtype:t,ttl:e,instrumentId:r}),e!=null&&I.histogram({name:N.AuthorizationComplete,value:e,attributes:D({instrument:r,result:t}),unit:"ms"})}function pl({instrument:r,reason:e,stage:t}){I.counter({name:N.Decelerated,value:1,attributes:D({instrument:r,reason:e,...t&&{stage:t}})}),p.log({body:"Checkout decelerate",attributes:{instrument:r,reason:e,...t&&{stage:t}}}),p.flushTelemetry()}function ml({reason:r}){I.counter({name:N.CartTokenMissing,value:1,attributes:{reason:r}})}function gl({success:r}){I.counter({name:N.RemovePersonalDataResult,value:1,attributes:D({success:r})})}function yl(){I.counter({name:N.WalletConfigDeveloperError,value:1})}function fl(){I.counter({name:N.LegacyCartCookie,value:1})}function bl(){window.setInterval(()=>{Ma()},1e3)}function wl(r){return(r==null?void 0:r.name)===St}function Ma(){I.exportMetrics(),I.exportLogs()}function _l(r){const{body:e,attributes:t}=r,n=zr();I.log({body:e,attributes:{...n,shopId:n.shop_id,...t}})}function Al({usedBackwardsCompatibility:r}){I.counter({name:N.StyleBackwardsCompatibility,value:1,attributes:{usedBackwardsCompatibility:r}})}function El({measurement:r,pageType:e,stylesWritten:t}){I.histogram({name:N.StyleBackwardsCompatibilityExecutionTime,value:r,attributes:D({pageType:e,stylesWritten:t}),unit:"ms"})}function Cl({rule:r,count:e,pageType:t}){I.counter({name:N.StyleBackwardsCompatibilityRules,value:e,attributes:D({rule:r,pageType:t})})}function Sl({retries:r}){I.counter({name:N.AmazonPayLoadRetries,value:1,attributes:{retries:r}})}function Pl({instrument:r}){I.counter({name:N.DynamicTaxFailed,value:1,attributes:D({instrument:r})}),p.log({body:"Dynamic tax failed",attributes:{instrument:r}})}function Il({instrument:r,measurement:e}){I.histogram({name:N.SheetLoaded,value:e,attributes:D({instrument:r}),unit:"ms"})}function vl({instrument:r,errorName:e}){I.counter({name:N.UnrecoverableCartError,value:1,attributes:D({instrument:r,errorName:e})}),p.log({body:"Unrecoverable error detected",attributes:{instrument:r,errorName:e}})}function Tl({instrument:r,error:e}){I.counter({name:N.PaymentCompletedAfterAbort,value:1,attributes:D({instrument:r,error:e})})}function Nl(){I.counter({name:N.GooglePayNullCartOnAuthorize,value:1,attributes:D({instrument:y.GooglePay})})}function Rl(){I.counter({name:N.GooglePayIso3166AdministrativeAreaFallback,value:1,attributes:D({instrument:y.GooglePay})})}function Dl({instrument:r,errorName:e,methodName:t}){I.counter({name:N.WalletSessionAbortError,value:1,attributes:D({instrument:r,errorName:e,methodName:t})}),p.log({body:"Wallet session abort error: ".concat(e),attributes:{instrument:r,methodName:t}})}function kl({instrument:r,retryCount:e,retryDuration:t,success:n,totalAmountChange:a,...o}){I.histogram({name:N.CartPaymentUpdateRetryResult,value:t,attributes:D({instrument:r,retryCount:e,success:n,totalAmountChange:a}),unit:"ms"}),p.log({body:"Cart payment update retry completed",attributes:{instrument:r,retryCount:e,retryDuration:t,success:n,totalAmountChange:a,...o}})}function Ol({reason:r}){I.counter({name:N.ProductFormError,value:1,attributes:D({reason:r})})}function Ll({instrument:r}){p.log({body:"Cart payment update timed out",attributes:{instrument:r}})}function xl({instrument:r}){p.log({body:"DELIVERY_WRONG_NUMBER_OF_LINES error detected and filtered out",attributes:{instrument:r}}),I.counter({name:N.DeliveryWrongNumberOfLines,value:1,attributes:D({instrument:r})})}const p={initStarted:T(Xs),initCompleted:T(Zs),instrumentLoaded:T(el),instrumentLoadEligibility:T(nl),instrumentSDKLoaded:T(tl),instrumentSDKEligible:T(rl),renderSucceeded:T(al),renderFailed:T(ol),sheetClicked:T(il),sheetCancelled:T(cl),sheetFailed:T(dl),updateFailed:T(sl),authorizationAttempt:T(ul),authorizationComplete:T(hl),startExporter:T(bl),decelerated:T(pl),cartTokenMissing:T(ml),removePersonalDataResult:T(gl),walletConfigDeveloperError:T(yl),legacyCartCookie:T(fl),flushTelemetry:T(Ma),styleBackwardsCompatibility:T(Al),styleBackwardsCompatibilityExecutionTime:T(El),styleBackwardsCompatibilityRules:T(Cl),amazonPaySDKLoadRetries:T(Sl),dynamicTaxFailed:T(Pl),sheetLoaded:T(Il),unrecoverableCartError:T(vl),paymentCompletedAfterAbort:T(Tl),googlePayNullCartOnAuthorize:T(Nl),googlePayIso3166AdministrativeAreaFallback:T(Rl),log:T(_l,{logErrors:!1}),paypalTokenCreationError:T(ll),walletSessionAbortError:T(Dl),cartPaymentUpdateRetryResult:T(kl),productFormError:T(Ol),updateCartPaymentTimeout:T(Ll),deliveryWrongNumberOfLines:T(xl)};function T(r,{logErrors:e=!0}={}){return(...t)=>{try{r(...t)}catch(n){e&&p.log({body:"Error calling telemetry function",attributes:{error:"".concat(n)}})}}}function Ml(r){const e=t=>{t.persisted&&(r(),window.removeEventListener("pageshow",e))};window.addEventListener("pageshow",e)}function Ua({type:r,form:e}){if(!e)return[];const t=document.querySelectorAll('[name^="'.concat(r,'"][form^="').concat(CSS.escape(e.getAttribute("id")||""),'"]')),n=e.querySelectorAll('[name^="'.concat(r,'"]')),a=Array.from(t).concat(Array.from(n)),o={};return a.forEach(i=>{const s=Ul(i),l=Bl(i);s&&typeof l<"u"&&l.trim()!==""&&(o[s]=l)}),Object.entries(o!=null?o:{}).map(([i,s])=>({key:i,value:s}))}function Nt({page:r,element:e}){const t=r==="product"?'[data-shopify="payment-button"]':'[data-shopify="dynamic-checkout-cart"]',n=En(e,t)||document.querySelector(t);return En(n,"form")}const it=Element.prototype;function En(r,e){if(it.matches=it.matches||it.webkitMatchesSelector||it.msMatchesSelector||it.mozMatchesSelector,!r||r.matches(e))return r;let t=r;for(;t&&t!==document.body;)if(t=t.parentElement,t&&t.matches(e))return t;return null}function Ul(r){const e=r.getAttribute("name");if(e===null)return null;const t=e.indexOf("["),n=e.lastIndexOf("]");return t===-1||n===-1?null:e.substring(t+1,n)}function Bl(r){if(!(["radio","checkbox"].includes(r.type)&&!r.checked))try{return r.value===""||typeof r.value>"u"?void 0:r.value}catch(e){return}}function Ba(r){var e,t;const n=Nt({page:"product",element:r});return(t=(e=Fa(n))==null?void 0:e[0])!=null?t:null}function Fl(r){const e=Nt({page:"product",element:r});return Fa(e)}function Fa(r){const e=$a(r),t=j.enabled(Wr);return e?t?[e,...zl(r)]:[e]:null}function $a(r){var e;const t=r==null?void 0:r.elements;if(!t)return b.leaveBreadcrumb("[ProductForm] No form elements found"),p.productFormError({reason:"missing_form_elements"}),p.log({body:"Product form error: missing form elements",attributes:{}}),null;const n=Ut(t,"id");if(!n||isNaN(Number(n))||Number(n)<=0)return b.leaveBreadcrumb("[ProductForm] Invalid variant ID found",{variantId:n}),p.productFormError({reason:"invalid_variant_id"}),p.log({body:"Product form error: invalid variant ID",attributes:{variantId:n!=null?n:"null"}}),null;const a=Number((e=Ut(t,"quantity"))!=null?e:"1"),o="gid://shopify/ProductVariant/".concat(n),i=Hl(t),s=Ua({type:"properties",form:r});return{variantId:n,quantity:a,merchandiseId:o,sellingPlanId:i,lineItemProperties:s}}function $l(r){const e=r==null?void 0:r.elements;return e?!!Ut(e,"selling_plan"):!1}function zl(r){let e;try{e=new FormData(r!=null?r:void 0)}catch(n){return[]}const t=[];for(const[n,a]of e.entries())if(n.startsWith("items[")){const o=n.split(/[[\]]{1,2}/),i=Number(o[1])-1;switch(t[i]||(t[i]={}),o[2]){case"id":t[i].variantId=a.toString(),t[i].merchandiseId="gid://shopify/ProductVariant/".concat(a.toString());break;case"quantity":t[i].quantity=Number(a!=null?a:1);break;case"selling_plan":t[i].sellingPlanId="gid://shopify/SellingPlan/".concat(a.toString());break;case"properties":t[i].lineItemProperties=JSON.parse(a);break;case"parent_id":t[i].parent={merchandiseId:"gid://shopify/ProductVariant/".concat(a.toString())};break}}return t}function Ut(r,e){var t,n;let a=r.namedItem(e);if(a instanceof HTMLSelectElement)try{return(t=a.value)!=null?t:null}catch(o){return null}if(a&&"length"in a&&(a=a.item(0)),a instanceof HTMLInputElement||a instanceof HTMLSelectElement)try{return(n=a.value)!=null?n:null}catch(o){return null}return null}function Hl(r){const e=Ut(r,"selling_plan");if(!(!e||e==="undefined"))return"gid://shopify/SellingPlan/".concat(e)}class Gl{constructor(e,t,n){this.element=e,this.apiClient=t,this.instrumentName=n}async getInitialCart(e,t,n){const a=Fl(this.element);if(!a)throw new za("[".concat(this.instrumentName,"] unable to find product form"),{groupingHash:"unable-to-find-product-form"});const o=yt(Xo),i={...a[0],lines:[...a],discountCodes:o?[o]:[],instrumentName:e},{data:s,errors:l,abortReason:c,decelerationReason:u}=await this.apiClient.createCart(i,t,n);return{cart:s,errors:l,abortReason:c,decelerationReason:u}}}class za extends ee{constructor(){super(...arguments),d(this,"name","ProductFormError"),d(this,"useHashPrefix",!0)}}const Vl={firstName:"firstName",lastName:"lastName",address1:"address1",address2:"address2",city:"city",province:"province",postalCode:"zip",phoneNumber:"phone",companyName:"company",country:"country"},Sr=["firstName","lastName","address1","address2","city","province","postalCode","phoneNumber","companyName","country"];function Lt(r,e){return"".concat(r,".").concat(Vl[e])}function Be(r,e){const t={};for(const n of Sr)t[n]=[{code:e,field:Lt(r,n)}];return t}function Ha(r){return{required:Be(r,"ADDRESS_FIELD_IS_REQUIRED"),invalid:{...Be(r,"ADDRESS_FIELD_DOES_NOT_MATCH_EXPECTED_PATTERN"),postalCode:[{code:"ADDRESS_FIELD_DOES_NOT_MATCH_EXPECTED_PATTERN",field:Lt(r,"postalCode")},{code:"INVALID_ZIP_CODE_FOR_COUNTRY",field:Lt(r,"postalCode")},{code:"INVALID_ZIP_CODE_FOR_PROVINCE",field:Lt(r,"postalCode")}]},emojis:Be(r,"ADDRESS_FIELD_CONTAINS_EMOJIS"),tooLong:Be(r,"ADDRESS_FIELD_IS_TOO_LONG"),htmlTags:Be(r,"ADDRESS_FIELD_CONTAINS_HTML_TAGS"),containsUrl:Be(r,"ADDRESS_FIELD_CONTAINS_URL")}}const jl={firstName:"DELIVERY_FIRST_NAME_REQUIRED",lastName:"DELIVERY_LAST_NAME_REQUIRED",address1:"DELIVERY_ADDRESS1_REQUIRED",address2:"DELIVERY_ADDRESS2_REQUIRED",city:"DELIVERY_CITY_REQUIRED",province:"DELIVERY_ZONE_REQUIRED_FOR_COUNTRY",postalCode:"DELIVERY_POSTAL_CODE_REQUIRED",phoneNumber:"DELIVERY_PHONE_NUMBER_REQUIRED",companyName:"DELIVERY_COMPANY_REQUIRED",country:"DELIVERY_COUNTRY_REQUIRED"},ql={firstName:"DELIVERY_FIRST_NAME_INVALID",lastName:"DELIVERY_LAST_NAME_INVALID",address1:"DELIVERY_ADDRESS1_INVALID",address2:"DELIVERY_ADDRESS2_INVALID",city:"DELIVERY_CITY_INVALID",province:"DELIVERY_ZONE_NOT_FOUND",postalCode:"DELIVERY_POSTAL_CODE_INVALID",phoneNumber:"DELIVERY_PHONE_NUMBER_INVALID",companyName:"DELIVERY_COMPANY_INVALID",country:"DELIVERY_COUNTRY_INVALID"};function Wl(){const r=Ha("deliveryAddress");for(const e of Sr)r.required[e]=[{code:jl[e]},...r.required[e]];for(const e of Sr){const t=ql[e];t&&(r.invalid[e]=[{code:t},...r.invalid[e]])}return r.invalid.country=[...r.invalid.country,{code:"Variable $buyerIdentity of type CartBuyerIdentityInput! was provided invalid value for countryCode"},{code:"INVALID",field:"deliveryAddress.country"}],r.invalid.postalCode=[...r.invalid.postalCode,{code:"DELIVERY_INVALID_POSTAL_CODE_FOR_COUNTRY"},{code:"DELIVERY_INVALID_POSTAL_CODE_FOR_ZONE"}],r.invalid.phoneNumber=[...r.invalid.phoneNumber,{code:"INVALID",field:"buyerIdentity.phone"}],r}const w=Wl();function Yl(){const r=Ha("billingAddress");return{...r,invalid:{...r.invalid,generic:[{code:"INVALID_PAYMENT",field:"billingAddress"},{code:"ADDRESS_FIELD_IS_REQUIRED",field:"billingAddress"},{code:"UNSPECIFIED_ADDRESS_ERROR",field:"billingAddress"}]}}}const C=Yl(),ft={invalid:[{code:"INVALID",field:"buyerIdentity.email"}],required:[{code:"BUYER_IDENTITY_EMAIL_REQUIRED"}]},Ga=[{code:"INVALID_DELIVERY_OPTION"},{code:"INVALID_DELIVERY_GROUP"},{code:"DELIVERY_DETAIL_CHANGED"},{code:"DELIVERY_NO_DELIVERY_AVAILABLE"},{code:"NO_DELIVERY_GROUP_SELECTED"}],Yr=[{code:"INVALID_PAYMENT",field:"amount"},{code:"INVALID_PAYMENT",field:"payment.amount"},{code:"INVALID_PAYMENT",field:"payment"}],Kr=[{code:"TAXES_DELIVERY_GROUP_ID_NOT_FOUND"},{code:"INVALID_TAX_LINES"},{code:"TAXES_LINE_ID_NOT_FOUND"},{code:"TAXES_MUST_BE_DEFINED"},{code:"PAYMENTS_UNACCEPTABLE_PAYMENT_AMOUNT"}],Qr=[{code:"MERCHANDISE_OUT_OF_STOCK"},{code:"MERCHANDISE_PRODUCT_NOT_PUBLISHED"}],Va=[{code:"MERCHANDISE_NOT_APPLICABLE"},{code:"MERCHANDISE_NOT_ENOUGH_STOCK_AVAILABLE"},{code:"DELIVERY_NO_DELIVERY_AVAILABLE_FOR_MERCHANDISE_LINE"},{code:"INVALID",field:"quantity"}],Kl=[{code:"PAYMENTS_METHOD_REQUIRED"},{code:"PAYMENTS_METHOD_UNAVAILABLE"}],Pr={code:"VALIDATION_CUSTOM"},Ql=[Pr,...Kl,...Qr],Jl=[...w.required.firstName,...w.required.lastName,...w.required.address1,...w.required.address2,...w.required.phoneNumber,...w.required.companyName,...ft.required],Bt={code:"CAPTCHA_COMPLETION_REQUIRED"},Ft={code:"LOCALIZATION_EXTENSION_FIELD_ERROR"},Cn={code:"BUYER_IDENTITY_CONTACT_INFO_DOES_NOT_MATCH_CUSTOMER_PROFILE"},$t={code:"Variable $language of type LanguageCode was provided invalid value"},zt={code:"Variable $country of type CountryCode was provided invalid value"},Ht={code:"Variable $cartId of type ID! was provided invalid value"},Xl={code:"PAYMENTS_METHOD_REQUIRED"},Zl={code:"DISCOUNT_NOT_APPLICABLE"},Sn={code:"PAYMENTS_COUNTRY_INVALID"},Pn={code:"INVALID_PAYMENT_EMPTY_CART"},Gt={code:"PAYMENT_METHOD_NOT_SUPPORTED"},Vt={code:"REDIRECT_TO_CHECKOUT_REQUIRED"},ec={code:"INVALID",field:"quantity"},tc={code:"VARIANT_REQUIRES_SELLING_PLAN"},rc={code:"SELLING_PLAN_NOT_APPLICABLE"},nc={code:"INVALID",field:"merchandiseId"},ac={code:"NO_RESPONSE"},oc={code:"INVALID",field:"input"},ic={code:"MERCHANDISE_NOT_APPLICABLE"},sc={code:"NO_DELIVERY_GROUP_SELECTED"},In={code:"ERROR"},vn=[{code:"DELIVERY_WRONG_NUMBER_OF_LINES"},{code:"DELIVERY_ADDRESS_REQUIRED"},{code:"DELIVERY_NO_DELIVERY_AVAILABLE_FOR_MERCHANDISE_LINE"}],lc={building:[...Jl,...vn],authorized:vn};function bt(r,e){const t=e.field?r.field===e.field:!0,n=r.code===e.code;return t&&n}function cc(r,e){return r.length>0&&e.length>0&&r.some(t=>e.some(n=>bt(t,n)))}function ge({code:r,field:e}){return"".concat(r).concat(e?":".concat(e):"")}class dc extends ee{constructor(e){e instanceof Error?(super("[".concat(e.name,"] ").concat(e.message),{cause:e.cause,groupingHash:e instanceof ee?e.groupingHash:void 0}),this.stack=e.stack):super("[HandleCreateCartError] ".concat(String(e))),this.name="HandleCreateCartError"}}async function Ae({element:r,instrumentName:e,dataSource:t}){const{supportsSubscriptions:n,supportsDeferredPurchaseOptions:a}=r;try{const o=await t.getInitialCart(e,n!=null?n:!0,a!=null?a:!0),{cart:i,errors:s,abortReason:l,decelerationReason:c}=o;Ml(()=>{r&&(r.disabled=!1)});const u=Vr(s),m=hc(s),h=m||u;if(m&&p.unrecoverableCartError({instrument:e,errorName:m}),!i&&!h)throw new Error("[".concat(e,"] Failed to create cart: ").concat(JSON.stringify(s)));if(i){if(!i.id)throw new Error("[".concat(e,"] received invalid cart"));if(!i.checkoutUrl)throw new Error("[".concat(e,"] Created cart with no checkout URL"))}if(s.length>0&&!h)throw new Error("Errors present after cart creation: ".concat(JSON.stringify(s)));return{cart:i,customValidationError:u,decelerationReason:c,abortReason:l,...m?{unrecoverableError:m}:{}}}catch(o){if(o instanceof Ve)return{cart:null,customValidationError:void 0,unrecoverableError:L.IgnoredResponseError,abortReason:void 0,decelerationReason:void 0};if(o instanceof za)return{cart:null,customValidationError:void 0,unrecoverableError:L.ProductFormError,abortReason:void 0,decelerationReason:void 0};throw new dc(o)}finally{r&&(r.disabled=!1)}}const uc=[{matcher:ec,unrecoverableError:L.InvalidQuantity},{matcher:tc,unrecoverableError:L.VariantRequiresSellingPlan},{matcher:rc,unrecoverableError:L.SellingPlanNotApplicable},{matcher:nc,unrecoverableError:L.MerchandiseIdInvalid},{matcher:ac,unrecoverableError:L.NoResponse},{matcher:oc,unrecoverableError:L.InvalidInput},{matcher:ic,unrecoverableError:L.MerchandiseNotApplicable}];function hc(r){var e;if(r.length!==1)return null;const[t]=r;return t.code===fa&&t.message?null:((e=uc.find(({matcher:n})=>bt(t,n)))==null?void 0:e.unrecoverableError)||null}const pc={force_shop_pay_product:"direct_checkout_product",force_shop_pay_cart:"direct_checkout_cart"};function we(r,e="no_redirect_for_checkout"){p.flushTelemetry();const t=new URL(r);switch(e){case"skip_shop_pay":t.searchParams.set("skip_shop_pay","true");break;case"no_redirect_for_checkout":t.searchParams.set("storefront_wallet","true");break;case"force_shop_pay_cart":case"force_shop_pay_product":case"force_shop_pay":{t.searchParams.set("payment","shop_pay");const n=pc[e];n&&t.searchParams.set("redirect_source",n);break}}window.location.assign(t.toString())}const mc={currency_changed:x.CURRENCY_CHANGE,captcha_required:x.CAPTCHA_REQUIRED,not_enough_stock:x.NOT_ENOUGH_STOCK,dynamic_tax:x.DYNAMIC_TAX,payment_method_not_applicable:x.PAYMENT_METHOD_NOT_APPLICABLE,invalid_payment_deferred_payment_required:x.INVALID_PAYMENT_DEFERRED_PAYMENT_REQUIRED,localization_extension_field_error:x.LOCALIZATION_EXTENSION_FIELD_ERROR,account_info_mismatch:x.ACCOUNT_INFO_MISMATCH,invalid_language:x.WALLET_PROCESSING_FAILED,invalid_country:x.WALLET_PROCESSING_FAILED,missing_cart_id:x.WALLET_PROCESSING_FAILED,redirect_to_checkout_required:x.WALLET_PROCESSING_FAILED,invalid_payment_amount:x.WALLET_PROCESSING_FAILED,price_increased:x.PRICE_INCREASED,unsupported_apple_pay_payment_method:x.UNSUPPORTED_APPLE_PAY_PAYMENT_METHOD,unsupported_google_pay_payment_method:x.UNSUPPORTED_GOOGLE_PAY_PAYMENT_METHOD,custom_validation:x.WALLET_PROCESSING_FAILED,cart_empty:x.WALLET_PROCESSING_FAILED,payments_country_invalid:x.PAYMENTS_COUNTRY_INVALID,generic_error:x.WALLET_PROCESSING_FAILED,nested_line_subscription:x.WALLET_PROCESSING_FAILED,nested_line_deferred_payment:x.WALLET_PROCESSING_FAILED,cart_throttled:null};function Tn({cart:r,warnings:e}){const t=r&&r.lineItems.length>0&&r.lineItems.every(n=>n.quantity===0);if(e!=null&&e.includes("MERCHANDISE_OUT_OF_STOCK")&&t)return"out_of_stock"}function mr({warnings:r,cart:e,cartStatus:t,errors:n,supportsSubscriptions:a,supportsDeferredPurchaseOptions:o}){for(const s of n||[]){if(s.code==="PAYMENT_METHOD_NOT_APPLICABLE")return"payment_method_not_applicable";if(s.code==="INVALID_PAYMENT_DEFERRED_PAYMENT_REQUIRED")return"invalid_payment_deferred_payment_required"}if(t==="CartThrottled")return"cart_throttled";if(!r||r.length===0)return Nn(a!=null?a:!0,o!=null?o:!0,e);if(r.includes("MERCHANDISE_NOT_ENOUGH_STOCK"))return"not_enough_stock";const i=e==null?void 0:e.lineItems.some(s=>s.quantity>0);return r.includes("MERCHANDISE_OUT_OF_STOCK")&&i?"not_enough_stock":Nn(a!=null?a:!0,o!=null?o:!0,e)}function Nn(r,e,t){const n=j.enabled(Wr);if(n&&!r&&t!=null&&t.lineItems.some(a=>{var o;return(o=a.sellingPlanAllocation)==null?void 0:o.sellingPlan.billingPolicy}))return"nested_line_subscription";if(n&&!e&&t!=null&&t.lineItems.some(a=>{var o,i;return((o=a.sellingPlanAllocation)==null?void 0:o.remainingBalanceChargeAmount)&&!((i=a.sellingPlanAllocation)!=null&&i.sellingPlan.billingPolicy)}))return"nested_line_deferred_payment"}function Jr({currentCartTotal:r,initialBuyerCurrency:e}){const t=r.amount;return!(!t||Number(t)===0||e.toUpperCase()===r.currencyCode.toUpperCase())}function jt({previousCart:r,currentCart:e}){if(!r||!e)return;const t=parseFloat(r.totalAmount.amount),n=parseFloat(e.totalAmount.amount);let a;return n>t?a="inc":n<t?a="dec":a="eq",a}function U({checkoutUrl:r,instrumentName:e,reason:t,stage:n}){if(!r)throw new Error("Invalid Checkout URL");const a=new URL(r),o=mc[t];o&&a.searchParams.set(o,"true"),p.decelerated({instrument:e,reason:t,stage:n}),we(a.toString())}class gc extends Tt{constructor(){super(),d(this,"name",y.MoreOptions),d(this,"anchor"),d(this,"i18n"),d(this,"dataSource"),d(this,"classNames"),d(this,"setI18n"),d(this,"setDataSource"),d(this,"setClassNames"),[this.i18n,this.setI18n]=he(),[this.dataSource,this.setDataSource]=he(),[this.classNames,this.setClassNames]=he()}static get observedAttributes(){return["disabled"]}connectedCallback(){this.anchor||this.render()}attributeChangedCallback(e,t,n){t!==n&&e==="disabled"&&this.anchor&&(n===""?this.anchor.setAttribute("aria-disabled","true"):this.anchor.removeAttribute("aria-disabled"),this.setAccessibilityAttributes())}async handleClick(e){var t,n;if(e.preventDefault(),this.disabled||!this.anchor)return;this.disabled=!0;const[a,o]=await Promise.all([this.i18n,this.dataSource]);try{const{decelerationReason:i,cart:s,customValidationError:l,unrecoverableError:c,abortReason:u}=await Ae({element:this,instrumentName:y.MoreOptions,dataSource:o});if(c){p.sheetClicked({instrument:this.name,result:"rejected",reason:"unrecoverable_error"}),p.log({body:"Unrecoverable error detected in More Options sheet clicked",attributes:{unrecoverableError:c}}),xe(a,c);return}if(l){p.sheetClicked({instrument:this.name,result:"rejected",reason:"custom_validation_error"}),p.log({body:"Custom validation error detected in More Options sheet clicked",attributes:{errorMessage:l==null?void 0:l.message}}),Le(a,l.message);return}if(u==="out_of_stock"){p.sheetClicked({instrument:this.name,result:"rejected",reason:"out_of_stock"}),be(a);return}if(i){p.sheetClicked({instrument:y.MoreOptions,result:"success",reason:"deceleration"}),U({checkoutUrl:(t=s==null?void 0:s.checkoutUrl)!=null?t:"",instrumentName:y.MoreOptions,reason:i});return}p.sheetClicked({instrument:y.MoreOptions,result:"success"}),we((n=s==null?void 0:s.checkoutUrl)!=null?n:"","skip_shop_pay")}catch(i){p.sheetClicked({instrument:y.MoreOptions,result:"failed",reason:"unhandled_error"}),p.log({body:"Unhandled error detected in More Options sheet clicked",attributes:{error:String(i)}}),b.notify(i),Je(a)}}async render(){const e=await this.i18n,t=await this.classNames;this.anchor=document.createElement("a"),this.anchor.textContent=e.translate("more_payment_options"),this.anchor.className=t,this.anchor.setAttribute("id","more-payment-options-link"),this.anchor.onclick=a=>this.handleClick(a),this.setAccessibilityAttributes(),this.appendChild(this.anchor);const n=document.createElement("style");n.textContent=ns,this.appendChild(n)}setAccessibilityAttributes(){this.anchor&&(this.disabled?(this.anchor.removeAttribute("href"),this.anchor.role="link"):(this.anchor.removeAttribute("role"),this.anchor.href="#"))}}var M=(r=>(r.ButtonDisplay="buttonDisplay",r.LoadInstrument="loadInstrument",r.LoadSdk="loadSDK",r.AuthorizationLatency="authorizationLatency",r.SheetLoad="sheetLoad",r.StyleExtract="styleExtract",r))(M||{});function ja(){var r,e;return!!((r=window.performance)!=null&&r.mark)&&!!((e=window.performance)!=null&&e.measure)}function Xe(r,e){return et(r,e),()=>Q(r,e)}function et(r,e){ja()&&window.performance.mark("".concat(r,"-").concat(e,"-start"))}function Q(r,e){var t,n;if(ja())try{const a="".concat(r,"-").concat(e,"-start"),o="".concat(r,"-").concat(e,"-end"),i="".concat(r,"-").concat(e,"-duration");window.performance.mark(o);const s=(n=window.performance.measure(i,a,o))!=null?n:(t=window.performance.getEntriesByName(i,"measure"))==null?void 0:t[0],l=s==null?void 0:s.duration;return l==null?void 0:l}catch(a){return}}function Xr(r,e,t){if(ct!=null&&ct.length){const n=ct.join(",");r.querySelectorAll(n).forEach(a=>{t===null?a.removeAttribute(e):a.setAttribute(e,t)})}}function yc(r,e){try{const t=JSON.parse(r!=null?r:"[]");if(!(t instanceof Array))throw new te({code:"invalid-wallet-configs",message:"[".concat(e,"] invalid walletConfigs found")});return t}catch(t){throw new te({code:"invalid-wallet-configs",message:"[".concat(e,"] Error while parsing walletConfigs JSON: ").concat(t)},{cause:t})}}function fc(r,e){try{return r?JSON.parse(r):null}catch(t){throw new te({code:"invalid-wallet-config",message:"[".concat(e,"] Error while parsing walletConfig JSON: ").concat(t)},{cause:t})}}function qt(r,e){var t;const n=e==null?void 0:e.getLoadEligibility(r);return p.instrumentLoadEligibility({instrument:e==null?void 0:e.getInstrumentName(),result:n!=null&&n.eligible?"success":"failed",reason:n!=null&&n.eligible||n==null?void 0:n.reason}),(t=n==null?void 0:n.eligible)!=null?t:!1}function bc(r,e){return e.filter(t=>qt(r,t))}async function qa({walletInstrument:r,instanceNumber:e}){const t=r.getInstrumentName(),n=Xe(M.LoadSdk,"".concat(t,":").concat(e));try{await r.loadWalletSDK(),p.instrumentSDKLoaded({instrument:t,measurement:n(),result:"success"})}catch(o){return b.leaveBreadcrumb("Failed to load wallet SDK",{instrumentName:t,instanceNumber:e},"error"),b.notify(o),p.log({body:"Error loading wallet SDK",attributes:{instrumentName:t,instanceNumber:e,error:String(o),walletParams:JSON.stringify(r.walletParams),userAgent:navigator.userAgent}}),p.instrumentSDKLoaded({instrument:t,measurement:n(),result:"failed"}),null}let a;try{a=r.getPartnerSDKEligibility()}catch(o){b.notify(o),a={eligible:!1,reason:"uncaught exception"}}return a.eligible?(p.instrumentSDKEligible({instrument:t,result:"success"}),r):(p.instrumentSDKEligible({instrument:t,reason:a.reason,result:"failed"}),null)}function ke(r,...e){try{const t=window[r];if(typeof t=="function")return new t(...e)}catch(t){}return null}class Zr extends Tt{constructor(){super(...arguments),d(this,"apiClient"),d(this,"i18n"),d(this,"policy"),d(this,"isFetchingPolicy",!1),d(this,"intersectionObserver",null),d(this,"handleIntersection",(e,t)=>{e.some(n=>n.isIntersecting)&&(this.apiClient&&this.apiClient.setVisible(),t.disconnect(),H({event:B.FirstVisible}))})}connectedCallback(){this.mountIntersectionObserver(),j.register(this.getEnabledFlags())}get shopId(){return this.getAttribute("shop-id")}get cartId(){return this.getAttribute("cart-id")}get walletConfigs(){return this.getAttribute("wallet-configs")}get recommendedWallet(){return this.getAttribute("recommended")}get fallbackWallet(){return this.getAttribute("fallback")}get variantParams(){var e;try{return JSON.parse((e=this.getAttribute("variant-params"))!=null?e:"[]")}catch(t){throw new te({code:"invalid-variant-params",message:"variant-params must be a valid JSON string. Received variant-params: ".concat(this.getAttribute("variant-params"),", received error: ").concat(t)})}}get styleExtractorDisabled(){return this.hasAttribute("disable-compat")}get onlySdk(){return this.hasAttribute("only-sdk")}get debug(){return this.hasAttribute("debug")}triggerLoadedEvent(){document.dispatchEvent(new Event("shopify:payment_button:loaded",{bubbles:!0,cancelable:!0}))}async attributeChangedCallback(e,t,n){t!==n&&Xr(this,e,n)}showBuyerConsent(e,t){var n,a,o;e&&((o=(a=(n=window.Shopify)==null?void 0:n.PaymentButton)==null?void 0:a.showBuyerConsent)==null||o.call(a,i=>this.onClickSubscriptionPolicy(i,e,t)))}hideBuyerConsent(){var e,t,n;(n=(t=(e=window.Shopify)==null?void 0:e.PaymentButton)==null?void 0:t.hideBuyerConsent)==null||n.call(t)}clearUI(){this.innerHTML=""}setupManagedMarketsHandlers(e){const t=document.getElementById("shopify-buyer-consent");if((t==null?void 0:t.getAttribute("data-consent-type"))!=="managed-markets")return;const n=document.getElementById("shopify-managed-markets-terms-and-conditions-button"),a=document.getElementById("shopify-managed-markets-privacy-policy-button");if(!n||!a)return;const o=i=>{const s=i.target;if(s.id==="shopify-managed-markets-terms-and-conditions-button"){i.preventDefault(),i.stopImmediatePropagation(),this.showModalWithIframe("https://content.global-e.com/shopper-terms",e.translate("managed_markets.terms_and_conditions"),e);return}s.id==="shopify-managed-markets-privacy-policy-button"&&(i.preventDefault(),i.stopImmediatePropagation(),this.showModalWithIframe("https://content.global-e.com/privacy-policy",e.translate("managed_markets.privacy_policy"),e))};document.addEventListener("click",o,!0)}showModalWithIframe(e,t,n){const a=n.translate("managed_markets.policy_not_found"),o=1e4,i=800,s=Oa(t);document.body.appendChild(s);const l=document.createElement("div");ht(l,{position:"relative",width:"100%"});const c=document.createElement("iframe");It(c,{width:"100%",height:"100%",title:t,frameborder:"no"}),ht(c,{border:"none","min-height":"50vh",display:"none"});const u=document.createElement("div");u.className="skeleton-overlay",u.innerHTML=ka(),ht(u,{background:"white"}),l.appendChild(c),l.appendChild(u),s.appendChild(l);let m=!1,h=!1,g=!1;const f=()=>{!g&&m&&h&&(u.remove(),c.style.display="block")},v=setTimeout(()=>{m||(g=!0,rs(s,a))},o);c.addEventListener("load",()=>{clearTimeout(v),m=!0,f()}),setTimeout(()=>{h=!0,f()},i),c.src=e}getEnabledFlags(){const e=this.getAttribute("enabled-flags");if(!e)return[];try{return JSON.parse(e)}catch(t){return console.warn("Invalid enabled-flags attribute value:",e),[]}}async onClickSubscriptionPolicy(e,t,n){if(e.preventDefault(),this.isFetchingPolicy)return;if(this.policy){this.showPolicy(this.policy,n);return}this.isFetchingPolicy=!0;const a=this.fetchSubscriptionPolicy(t).then(o=>(this.policy=o,o)).catch(o=>(b.notify(o),n.translate("subscriptions.policy_not_found"))).finally(()=>{this.isFetchingPolicy=!1});this.showPolicy(a,n)}async fetchSubscriptionPolicy(e){const t=await e.fetchSubscriptionPolicy();return this.policy=t,t}showPolicy(e,t){jr(t.translate("subscriptions.cancellation_policy"),e,t.translate("subscriptions.policy_not_found"))}mountIntersectionObserver(){this.intersectionObserver=ke("IntersectionObserver",this.handleIntersection),this.intersectionObserver?this.intersectionObserver.observe(this):H({event:B.FirstVisibleNotAvailable})}}function en(r){var e,t;Ta({shop_id:(e=r.shopId)!=null?e:wa,cartId:(t=r.cartId)!=null?t:void 0,debug:r.debug,pageType:r.pageType,cartPrepare:j.enabled(Re)})}class tn{constructor(e,t){d(this,"addToCartMutationObserver"),d(this,"addToCartForm"),d(this,"addToCartButtons"),this.element=e,this.onFormChanged=t,this.addToCartMutationObserver=null,this.addToCartForm=null,this.addToCartButtons=[]}setupMutationObservers(){if(this.findAndSetAddToCartButtons(),!this.addToCartForm)return;this.syncComponentStateWithForm();const e=new MutationObserver(()=>this.reobserveOnFormChanges());this.addToCartMutationObserver=new MutationObserver(()=>this.syncComponentStateWithForm()),e.observe(this.addToCartForm,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),this.observeAddToCartButtons()}syncComponentStateWithForm(){if(!this.addToCartForm){this.onFormChanged({disabled:!0,hasSellingPlan:!1});return}const e=$a(this.addToCartForm),t=!!(this.addToCartButtons.length>0&&this.addToCartButtons.every(n=>n.hasAttribute("disabled")||n.getAttribute("aria-disabled")==="true"));this.onFormChanged({disabled:t||e===null,hasSellingPlan:$l(this.addToCartForm),variantId:e==null?void 0:e.variantId,sellingPlanId:e==null?void 0:e.sellingPlanId})}observeAddToCartButtons(){this.addToCartButtons.forEach(e=>{this.addToCartMutationObserver.observe(e,{attributes:!0})})}reobserveOnFormChanges(){var e;(e=this.addToCartMutationObserver)==null||e.disconnect(),this.findAndSetAddToCartButtons(),this.observeAddToCartButtons(),this.syncComponentStateWithForm()}findAndSetAddToCartButtons(){if(this.addToCartForm=Nt({page:"product",element:this.element}),this.addToCartForm){const e=this.addToCartForm.querySelectorAll("[type=submit]");e instanceof NodeList&&(this.addToCartButtons=[...e])}}}function wc(r,e,t){try{const n=JSON.parse(r!=null?r:"{}"),a=JSON.parse(e!=null?e:JSON.stringify(_a));if(n===null||Object.keys(n).length===0){if(!(a instanceof Object))throw p.walletConfigDeveloperError(),new te({code:"invalid-fallback-wallet-config",message:"[".concat(t,"] Invalid fallback wallet configs JSON")});return{recommendedWallet:null,fallbackWallet:a}}return{recommendedWallet:n,fallbackWallet:a}}catch(n){throw p.walletConfigDeveloperError(),new te({code:"invalid-recommended-fallback-config",message:"[".concat(t,"] Error while parsing recommended/fallback JSON: ").concat(n)},{cause:n})}}const _c=".shopify-payment-button__button--hidden{visibility:hidden}.shopify-payment-button__button{height:clamp(25px,var(--shopify-accelerated-checkout-button-block-size, 44px),55px);min-height:clamp(25px,var(--shopify-accelerated-checkout-button-block-size, 44px),55px);border-radius:var(--shopify-accelerated-checkout-button-border-radius, 0px);width:100%;border:none;box-shadow:0 0 0 0 transparent;color:#fff;cursor:pointer;display:block;font-size:1em;font-weight:500;line-height:1;text-align:center;transition:background .2s ease-in-out}.shopify-payment-button__button[disabled]{opacity:.6;cursor:default}.shopify-payment-button__button--unbranded{background-color:#1990c6;padding:1em 2em}.shopify-payment-button__button--unbranded:hover:not([disabled]){background-color:#136f99}.shopify-payment-button__more-options{background:transparent;border:0 none;cursor:pointer;display:block;font-size:1em;margin-top:1em;text-align:center;text-decoration:underline;width:100%}.shopify-payment-button__more-options.shopify-payment-button__skeleton{height:auto!important;min-height:0!important;border-radius:4px!important;width:50%;margin-left:25%;margin-right:25%}.shopify-payment-button__more-options[disabled]{opacity:.6;cursor:default!important}.shopify-payment-button__button.shopify-payment-button__button--branded{display:flex;flex-direction:column;position:relative;z-index:1}.shopify-payment-button__button.shopify-payment-button__button--branded .shopify-cleanslate{flex:1!important;display:flex!important;flex-direction:column!important}.shopify-payment-button__button.button.loading{position:relative;color:transparent}.shopify-payment-button__button.button.loading>.loading-overlay__spinner{top:50%;left:50%;transform:translate(-50%,-50%);position:absolute;height:100%;display:flex;align-items:center}.shopify-payment-button__button.button.loading>.loading-overlay__spinner .spinner{width:-moz-fit-content;width:-webkit-fit-content;width:fit-content}.button.loading>.loading-overlay__spinner .path{stroke:#fff}.shopify-payment-button__button .loading-overlay__spinner{width:1.8rem;display:inline-block}.shopify-payment-button__button .spinner{animation:shopify-rotator 1.4s linear infinite}@keyframes shopify-rotator{0%{transform:rotate(0)}to{transform:rotate(270deg)}}.shopify-payment-button__button .path{stroke-dasharray:280;stroke-dashoffset:0;transform-origin:center;stroke:#121212;animation:shopify-dash 1.4s ease-in-out infinite}@media screen and (forced-colors: active){.shopify-payment-button__button .path{stroke:CanvasText}}@keyframes shopify-dash{0%{stroke-dashoffset:280}50%{stroke-dashoffset:75;transform:rotate(135deg)}to{stroke-dashoffset:280;transform:rotate(450deg)}}#shopify-buyer-consent{margin-top:1em;display:inline-block;width:100%}#shopify-buyer-consent.hidden{display:none}#shopify-subscription-policy-button,#shopify-managed-markets-terms-and-conditions-button,#shopify-managed-markets-privacy-policy-button{background:none;border:none;padding:0;text-decoration:underline;font-size:inherit;cursor:pointer}#shopify-subscription-policy-button:before,#shopify-managed-markets-terms-and-conditions-button:before,#shopify-managed-markets-privacy-policy-button:before{box-shadow:none}@keyframes acceleratedCheckoutLoadingSkeleton{50%{opacity:var(--shopify-accelerated-checkout-skeleton-animation-opacity-start, 1)}75%{opacity:var(--shopify-accelerated-checkout-skeleton-animation-opacity-end, .5)}to{opacity:var(--shopify-accelerated-checkout-skeleton-animation-opacity-start, 1)}}.shopify-payment-button__skeleton{animation:acceleratedCheckoutLoadingSkeleton var(--shopify-accelerated-checkout-skeleton-animation-duration, 4s) var(--shopify-accelerated-checkout-skeleton-animation-timing-function, ease) infinite;animation-delay:-.168s;background-color:var(--shopify-accelerated-checkout-skeleton-background-color, #dedede);box-sizing:border-box;text-decoration:none!important;height:var(--shopify-accelerated-checkout-button-block-size, inherit);min-height:25px;max-height:55px;border-radius:var( --shopify-accelerated-checkout-button-border-radius, inherit )}",Ac='.accelerated-checkout-button{height:clamp(25px,var(--shopify-accelerated-checkout-button-block-size, 44px),55px);min-height:clamp(25px,var(--shopify-accelerated-checkout-button-block-size, 44px),55px);border-radius:var(--shopify-accelerated-checkout-button-border-radius, 0px);box-shadow:var(--shopify-accelerated-checkout-button-box-shadow)}:host([page-type="cart_page"]) .accelerated-checkout-button{height:100%;width:100%;border-radius:var(--shopify-accelerated-checkout-button-border-radius, 4px);box-shadow:var(--shopify-accelerated-checkout-button-box-shadow)}:host([page-type="product"]) .accelerated-checkout-button{min-width:150px}@media (forced-colors: active){.accelerated-checkout-button{border:1px solid transparent!important}:host([page-type="cart_page"]) .accelerated-checkout-button{border:1px solid transparent!important}}',Ec=70;class pt{constructor(e,t,n,a){d(this,"red"),d(this,"green"),d(this,"blue"),d(this,"opacity"),this.red=e||0,this.green=t||0,this.blue=n||0,this.opacity=typeof a>"u"?1:a}getLuminance(){const e=this.red&255,t=this.green&255,n=this.blue&255;return e*.2126+t*.7152+n*.0722}isDark(){return this.opacity===0?!1:this.getLuminance()/this.opacity<Ec}blendWith(e,t){this.opacity=1-(1-e.opacity)*(1-t.opacity),this.red=this.blend(e.red,t.red,e,t),this.green=this.blend(e.green,t.green,e,t),this.blue=this.blend(e.blue,t.blue,e,t)}blend(e,t,n,a){return Math.round(e*n.opacity/this.opacity+t*a.opacity*(1-n.opacity)/this.opacity)}}function Cc(r){const e=[...r];let t=new pt(0,0,0,0),n=new pt(255,255,255,1),a=e.shift();for(;a;)t.opacity>0&&a.opacity>0?(n=new pt(0,0,0,0),n.blendWith(a,t)):a.opacity>0?n=a:n=t,t=n,a=e.shift();return n}const Ir=new pt(255,255,255,1);function Sc(r){const e=[];let t=r;for(;t.parentElement;){t=t.parentElement;const n=window.getComputedStyle(t).backgroundColor,a=Pc(n);if(n&&e.push(a),a.opacity===1)break}try{return Cc(e.reverse())}catch(n){return b.notify(new Wa("[BackgroundDetection] Failed to blend colors for element ".concat(r.outerHTML),{cause:n})),Ir}}function Pc(r){if(!r)return Ir;try{const e=r.split("(")[1].split(")")[0].replace(" ","").split(",");return new pt(Number(e[0]),Number(e[1]),Number(e[2]),typeof e[3]>"u"?1:Number(e[3]))}catch(e){b.notify(new Wa("[BackgroundDetection] Failed to convert rgbString to array ".concat(r),{cause:e}))}return Ir}class Wa extends Error{constructor(){super(...arguments),d(this,"name","ColorProcessingError")}}var pe;class Ee extends Tt{constructor(){super(),d(this,"name",y.Unknown),d(this,"i18n"),d(this,"dataSource"),d(this,"apiClient"),d(this,"classNames"),d(this,"containerInstanceNumber"),d(this,"supportsSubscriptions"),d(this,"supportsDeferredPurchaseOptions"),d(this,"onRendered"),d(this,"setI18n"),d(this,"setDataSource"),d(this,"setApiClient"),d(this,"setClassNames"),d(this,"setContainerInstanceNumber"),d(this,"parsedWalletParams"),V(this,pe),this.onRendered=()=>{},this.supportsSubscriptions=!1,this.supportsDeferredPurchaseOptions=!1,[this.i18n,this.setI18n]=he(),[this.dataSource,this.setDataSource]=he(),[this.apiClient,this.setApiClient]=he(),[this.classNames,this.setClassNames]=he(),[this.containerInstanceNumber,this.setContainerInstanceNumber]=he()}async cleanupOnFailure(e,t){var n;try{await e()}catch(a){b.notify(new Ic("An error occurred requiring cleanup when attempting to render the ".concat(t," instrument: ").concat(a),{cause:a}));const o=await this.containerInstanceNumber;p.instrumentLoaded({instrumentOrComponentName:t,result:"failed",measurement:Q(M.ButtonDisplay,"".concat(t,":").concat(o))}),(n=this.parentElement)==null||n.remove()}}attributeChangedCallback(e,t,n,a){t!==n&&e==="disabled"&&a&&(n===""?(a.setAttribute("aria-disabled","true"),a.setAttribute("disabled","")):(a.removeAttribute("aria-disabled"),a.removeAttribute("disabled")))}get pageType(){return this.getAttribute("page-type")||R.Unknown}get buttonTheme(){return Sc(this).isDark()?"LIGHT":"DARK"}get isCTA(){return this.hasAttribute("call-to-action")}get walletParams(){var e;if(this.parsedWalletParams===void 0)try{this.parsedWalletParams=JSON.parse((e=this.getAttribute("wallet-params"))!=null?e:"{}")}catch(t){throw new te({code:"invalid-wallet-params",message:"[".concat(this.name,"] Error while parsing wallet-params JSON: ").concat(t)},{cause:t})}return this.parsedWalletParams}async initializeShadowStyles(e,t=""){const n=document.createElement("style");n.innerHTML=[Ac,t].join("\n"),e.appendChild(n)}async ensureLightDOMIsNotEmpty(){this.textContent="\xA0"}dispatchWalletEvent({eventName:e,detail:t={}}){var n;(n=this.parentElement)==null||n.dispatchEvent(new CustomEvent(e,{detail:t}))}getOrCreateShadowRoot(){return P(this,pe)||F(this,pe,this.attachShadow({mode:"closed"})),P(this,pe)}clearShadowRoot(){P(this,pe)&&(P(this,pe).innerHTML="")}}pe=new WeakMap;class Ic extends Error{constructor(){super(...arguments),d(this,"name","CleanupOnFailureError")}}class vc extends Ee{constructor(){super(...arguments),d(this,"name",y.BuyItNow),d(this,"button",null)}static get observedAttributes(){return["disabled"]}connectedCallback(){this.cleanupOnFailure(this.render.bind(this),this.name)}attributeChangedCallback(e,t,n){super.attributeChangedCallback(e,t,n,this.button)}async handleClick(){var e,t;if(this.disabled||!this.button||this.button.getAttribute("aria-disabled"))return;this.disabled=!0;const[n,a]=await Promise.all([this.i18n,this.dataSource]);try{const{decelerationReason:o,cart:i,customValidationError:s,unrecoverableError:l,abortReason:c}=await Ae({element:this,instrumentName:this.name,dataSource:a});if(l){p.sheetClicked({instrument:this.name,result:"rejected",reason:"unrecoverable_error"}),xe(n,l);return}if(c==="out_of_stock"){p.sheetClicked({instrument:this.name,result:"rejected",reason:"out_of_stock"}),be(n);return}if(s){p.sheetClicked({instrument:this.name,result:"rejected",reason:"custom_validation_error"}),Le(n,s.message);return}if(o){p.sheetClicked({instrument:this.name,result:"success",reason:"deceleration"}),U({checkoutUrl:(e=i==null?void 0:i.checkoutUrl)!=null?e:"",instrumentName:this.name,reason:o});return}p.sheetClicked({instrument:this.name,result:"success"}),we((t=i==null?void 0:i.checkoutUrl)!=null?t:"","allow_redirect")}catch(o){b.notify(o),p.sheetClicked({instrument:this.name,result:"failed",reason:"unhandled_error"}),p.log({body:"Unhandled error detected in Buy It Now Button click",attributes:{error:String(o)}}),Je(n)}}async render(){var e;this.button||(this.button=ar());const t=await this.classNames;this.button.textContent=(await this.i18n).translate("instruments_copy.checkout.buy_now"),this.button.className=t,this.disabled&&this.button.setAttribute("aria-disabled","true"),this.button.onclick=()=>this.handleClick(),this.appendChild(this.button),(e=this.onRendered)==null||e.call(this)}}const Tc=1e3;function Nc(){const r=navigator.userAgent,e=r.indexOf("Android")>-1,t=r.indexOf("Chrome/")>-1,n=parseInt((/Chrome\/([0-9]+)/.exec(r)||["0","0"])[1],10);return e&&t&&n===114}function Rc(r){return Promise.race([r,new Promise((e,t)=>setTimeout(()=>t(new Error("timed out")),Tc))])}class Ce{constructor(e){d(this,"walletParams"),d(this,"supportsSubscriptions"),d(this,"supportsDeferredPurchaseOptions");var t,n;this.walletParams=e.wallet_params,this.supportsSubscriptions=(t=e.supports_subs)!=null?t:!1,this.supportsDeferredPurchaseOptions=(n=e.supports_def_opts)!=null?n:!1}static walletName(){throw new Error("Must define walletName for WalletInstrument subclass")}async createWebComponent({walletContainer:e,dataSource:t,i18n:n,apiClient:a,containerInstanceNumber:o,classNames:i="",callToAction:s,pageType:l=R.ProductPage,slot:c="button",onRendered:u=()=>{}}){var m,h,g;const f=this.getWebComponentName();if(!ce(f,this.getWebComponentClass(),{isChildCustomElement:!0}))throw new Z("Failed to define custom element ".concat(f,", aborting execution"));try{await Rc(customElements.whenDefined(f))}catch(A){throw new Z("Timeout waiting for custom element ".concat(f," to be defined"))}const v=document.createElement(f);if(!(v instanceof Ee))throw new Z("Failed to create web component instance for ".concat(f,", element is not a WalletButtonElement"));const _={"access-token":(m=e.accessToken)!=null?m:"","buyer-country":(h=e.buyerCountry)!=null?h:"","buyer-currency":e.buyerCurrency,"wallet-params":JSON.stringify((g=this.walletParams)!=null?g:{}),"page-type":l,slot:c};try{e.disabled&&v.setAttribute("disabled",""),It(v,_),e.isShippingRequired&&v.setAttribute("requires-shipping",""),e.hasSellingPlan&&v.setAttribute("has-selling-plan",""),e.pciEnabled&&v.setAttribute("pci-enabled","")}catch(A){const k=A;throw k.message.includes("setAttribute is not a function")&&Nc()?new Z(k.message):k}if(s&&v.setAttribute("call-to-action",""),typeof v.setDataSource!="function")throw new Z("Custom element ".concat(f," is not properly upgraded, aborting execution"));return v.setDataSource(t),v.setApiClient(a),v.setI18n(n),v.setClassNames(i),v.setContainerInstanceNumber(o),v.supportsSubscriptions=this.supportsSubscriptions,v.supportsDeferredPurchaseOptions=this.supportsDeferredPurchaseOptions,v.onRendered=u,v}loadWalletSDK(){return Promise.resolve()}getLoadEligibility(e){return{eligible:!0}}getPartnerSDKEligibility(){return{eligible:!0}}isInIframe(){return typeof window>"u"||window.self!==window.top}}class Dc extends Ce{static walletName(){return"buy_it_now"}getWebComponentName(){return"shopify-buy-it-now-button"}getInstrumentName(){return y.BuyItNow}getWebComponentClass(){return vc}}const kc="shopify-paypal-button[disabled]{opacity:.5;cursor:not-allowed}shopify-paypal-button div.paypal-buttons>iframe{z-index:auto!important;border-radius:0!important;box-shadow:none}",Oc='::slotted(div){height:100%}:host([page-type="cart_page"]) ::slotted(div){width:100%;min-width:100px;display:flex;justify-content:center}:host([page-type="cart_page"]) .accelerated-checkout-button{overflow:hidden;display:flex;justify-content:center}';async function je(r){const{cartId:e,cartClient:t,instrumentName:n,abortSignal:a}=r;try{if(!e)throw new Error("[".concat(n,"] provided no cart ID when updating buyer identity"));if(!t)throw new Error("[".concat(n,"] provided invalid cart client when updating buyer identity"));return await t.updateCartBuyerIdentity(r,a)}catch(o){throw p.updateFailed({instrument:n,request:"updateBuyerIdentity",error:o}),o}}async function rn({cartId:r,totalAmount:e,paymentMethod:t,billingAddress:n,cartClient:a,instrumentName:o,abortSignal:i,hasSellingPlan:s,canUsePaymentMethodForFreeOrder:l}){try{if(!r)throw new Error("[".concat(o,"] provided no cart ID when updating payment"));if(!e)throw new Error("[".concat(o,"] provided no total amount when updating payment"));if(!t)throw new Error("[".concat(o,"] provided no apple pay wallet content when updating payment"));if(!a)throw new Error("[".concat(o,"] provided invalid cart client when updating payment"));const c={freePaymentMethod:{billingAddress:n}};return await a.updateCartPayment(r,{amount:{amount:e.amount,currencyCode:e.currencyCode},...Number(e.amount)<=0&&!l&&!s?c:t},o,i)}catch(c){throw p.updateFailed({instrument:o,request:"updatePayment",error:c}),c}}function Ya(r){return window[Ka(r)]}function Ka(r){return"paypal-".concat(r.replace(/[^a-zA-Z0-9]/g,""))}const Lc="RESTRICTED_WALLET_ACCOUNT",xc="GENERIC_ERROR",Mc="NO_PENDING_TASK",Uc="WALLET_SERVICE_DISABLED",Bc="FAILED_TO_ENQUEUE_BACKGROUND_JOB",Fc="REQUEST_MISSING_VALID_MERCHANDISE_SOURCE",$c="THROTTLE_EXCEEDED",zc="INTERNAL_SERVER_ERROR",Hc=[xc,Mc,Uc,Bc,Fc,$c,zc];function Rn(r){return r==null?void 0:r.map(e=>{var t,n;return{code:(t=e.extensions)==null?void 0:t.code,isLoggable:Hc.includes((n=e.extensions)==null?void 0:n.code)}}).find(({code:e,isLoggable:t})=>e===Lc||t)}function Wt(r){if(!r)return null;const e=getComputedStyle(r).borderRadius;return e.includes("px")?parseInt(e,10):null}function Yt(r){if(!r)return null;const e=getComputedStyle(r).height;return e.includes("px")?parseInt(e,10):null}const gr=25,Dn=55,Gc=["cart_throttled","payment_method_not_applicable","invalid_payment_deferred_payment_required","nested_line_subscription","nested_line_deferred_payment"],yr="PAYPAL_CALLBACK_HANDLED_ERROR",Vc=["Can not set name for cross-domain window","too much recursion"];var me;class jc extends Ee{constructor(){super(...arguments),d(this,"name",y.PayPal),d(this,"abortController",null),d(this,"cartId"),d(this,"sdkButtonsComponent"),d(this,"container",null),d(this,"resizeObserver",null),d(this,"buttonHeight"),d(this,"rendering",!1),d(this,"prevBorderRadius",0),d(this,"prevHeight",0),V(this,me,!1)}connectedCallback(){this.resizeObserver=ke("ResizeObserver",()=>this.onResize()),this.cleanupOnFailure(this.render.bind(this),this.name)}async disconnectedCallback(){var e;this.innerHTML="",this.clearShadowRoot(),await this.teardownPayPalButton(),(e=this.resizeObserver)==null||e.disconnect()}async teardownPayPalButton(){var e;try{await((e=this.sdkButtonsComponent)==null?void 0:e.close().catch(()=>{}))}catch(t){}finally{this.sdkButtonsComponent=void 0}}async onResize(){const e=Wt(this.container),t=Yt(this.container),n=e!==null&&this.prevBorderRadius!==e||t!==null&&this.prevHeight!==t;!this.rendering&&n&&(await this.teardownPayPalButton(),this.container.innerHTML="",await this.cleanupOnFailure(()=>this.renderFromPayPalSDK(),this.name))}async render(){var e;const t=this.getOrCreateShadowRoot(),n=document.createElement("div");n.className=Oe.BUTTON;const a=document.createElement("style");a.innerHTML=kc,this.appendChild(a),await this.initializeShadowStyles(t,Oc),t.appendChild(n),this.container=n,await Xi(),this.renderFromPayPalSDK(),(e=this.resizeObserver)==null||e.observe(this.container)}getHeight(){const e=Yt(this.container);return e?e>=gr&&e<=Dn?e:e<gr?(console.debug("[PayPalButton] Container height is less than the minimum height of the PayPal button. Using the minimum height of 25px."),gr):(console.debug("[PayPalButton] Container height is greater than the maximum height of the PayPal button. Using the maximum height of 55px."),Dn):Qo}async renderFromPayPalSDK(){var e,t,n;if(!this.container)throw new Error("button container not set when attempting to render");this.rendering=!0;const a=this.requiresBillingAgreement(),o=async()=>this.createToken({apiClientPromise:this.apiClient,requiresBillingAgreement:a});let i,s;a?s=o:i=o;const l=Wt(this.container),c=this.getHeight();this.prevHeight=c;const u={color:"gold",label:this.isCTA?"pay":"paypal",disableMaxWidth:!0,height:c,shape:"sharp"};l&&l>0&&(u.borderRadius=l,this.prevBorderRadius=l);const m=await this.i18n;this.sdkButtonsComponent=(t=(e=Ya(this.walletParams.sdkUrl))==null?void 0:e.Buttons)==null?void 0:t.call(e,{fundingSource:"paypal",style:u,createOrder:i,createBillingAgreement:s,onApprove:async g=>{await this.onApprove(g)},onCancel:()=>{this.cancelPaymentSheet("Payment sheet cancelled")},onClick:this.onClick.bind(this),onError:g=>{this.onError(g,m)}});let h=!1;try{await((n=this.sdkButtonsComponent)==null?void 0:n.render(this.container)),h=!0}catch(g){p.renderFailed(this.name),p.log({body:"PayPal Button not able to render into container.",attributes:{pageType:this.pageType,error:g==null?void 0:g.toString()}})}finally{this.rendering=!1}h&&this.onRendered()}cancelPaymentSheet(e){var t;F(this,me,!0),p.sheetCancelled(this.name),(t=this.abortController)==null||t.abort("[PayPal] ".concat(e))}async onClick(e,t){var n,a;if(this.disabled)return t.reject();F(this,me,!1),this.abortController=ke("AbortController");const o=this.getBoundingClientRect(),i=o.left+o.width/2,s=o.top+o.height/2,l=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1,clientX:i,clientY:s,screenX:window.screenX+i,screenY:window.screenY+s});this.dispatchEvent(l);const[c,u]=await Promise.all([this.dataSource,this.i18n]);try{const{decelerationReason:m,cart:h,customValidationError:g,unrecoverableError:f,abortReason:v}=await Ae({element:this,instrumentName:this.name,dataSource:c});return f?(p.sheetClicked({instrument:this.name,result:"rejected",reason:"unrecoverable_error"}),p.log({body:"Unrecoverable error detected in PayPal sheet clicked",attributes:{unrecoverableError:f}}),xe(u,f),t.reject()):v==="out_of_stock"?(p.sheetClicked({instrument:this.name,result:"rejected",reason:"out_of_stock"}),be(u),t.reject()):g?(p.sheetClicked({instrument:this.name,result:"rejected",reason:"custom_validation_error"}),p.log({body:"Custom validation error detected in PayPal sheet clicked",attributes:{errorMessage:g==null?void 0:g.message}}),Le(u,g.message),t.reject()):this.hasSellingPlanConflict(h)?(p.sheetClicked({instrument:this.name,result:"success",reason:"redirected_to_checkout"}),we((n=h==null?void 0:h.checkoutUrl)!=null?n:""),t.reject()):m?(p.sheetClicked({instrument:this.name,result:"success",reason:"deceleration"}),U({checkoutUrl:(a=h==null?void 0:h.checkoutUrl)!=null?a:"",instrumentName:this.name,reason:m}),t.reject()):(this.cartId=h.id,t.resolve())}catch(m){return p.sheetClicked({instrument:this.name,result:"failed",reason:"unhandled_error"}),p.log({body:"Unhandled error detected in PayPal sheet clicked",attributes:{error:String(m),location:"onClick",...this.cartId&&{cartId:Mt(this.cartId)}}}),b.notify(m),Je(u),t.reject()}}async createToken({apiClientPromise:e,requiresBillingAgreement:t}){const n=await e;try{if(!this.cartId)throw new Error("cartId not found when creating token");const a=await n.paypalTokenCreate({cartId:this.cartId,billingAgreement:t});return p.sheetClicked({instrument:this.name,result:"success"}),a}catch(a){throw P(this,me)||(a instanceof Z?p.sheetClicked({instrument:this.name,result:"rejected",reason:"silenced_error"}):(p.sheetClicked({instrument:this.name,result:"failed",reason:"unhandled_error"}),p.log({body:"Unhandled error detected in PayPal sheet clicked",attributes:{error:String(a),location:"createToken",...this.cartId&&{cartId:Mt(this.cartId)}}}),b.notify(a))),Je(await this.i18n),new Error(yr)}}async onApprove({orderID:e,payerID:t,billingToken:n}){var a;try{if(p.authorizationAttempt(this.name),et(M.AuthorizationLatency,this.name),!this.cartId)throw new Error("Cart not found");const o=await this.apiClient,i=this.requiresBillingAgreement()&&n!=null?n:e,{billingAddress:s,destinationAddress:l,expiresAt:c,email:u,remoteOrderId:m,payerApprovedAmount:h}=await o.paypalBuyerDetailsFetch(i,this.cartId),g=await je({cartId:this.cartId,cartClient:o,instrumentName:this.name,emailAddress:u,streetAddress:l});if(!(g!=null&&g.data))throw new Error("Cart not found");if(await this.decelerateOrAbort(g))return;const{id:f,totalAmount:v,checkoutUrl:_}=g.data,A=await rn({abortSignal:(a=this.abortController)==null?void 0:a.signal,cartClient:o,cartId:f,instrumentName:y.PayPal,billingAddress:s!=null?s:l,paymentMethod:{walletPaymentMethod:{paypalWalletContent:{billingAddress:s!=null?s:l,email:u,expiresAt:c,payerId:t,token:m!=null?m:e,acceptedSubscriptionTerms:!1,vaultingAgreement:!1,merchantId:this.walletParams.merchantId,...h&&{payerApprovedAmount:h}}}},canUsePaymentMethodForFreeOrder:!0,totalAmount:v});if(await this.decelerateOrAbort(A))return;p.authorizationComplete({instrument:this.name,result:"success",measurement:Q(M.AuthorizationLatency,this.name)}),we(_)}catch(o){throw P(this,me)||(p.authorizationComplete({instrument:this.name,result:"failed",measurement:Q(M.AuthorizationLatency,this.name)}),b.notify(o)),new Error(yr)}}onError(e,t){var n;if(P(this,me)||e.message.includes(yr))return;if(e.message==="Window is closed, can not determine type"){this.cancelPaymentSheet("Window Closed Error");return}if(e.message==="Detected popup close"){this.cancelPaymentSheet("Popup Closed Error");return}e.message==="RESTRICTED_WALLET_ACCOUNT"?p.log({body:"PayPal modal closed due to error: ".concat(e)}):Vc.some(o=>e.message.includes(o))?p.log({body:"Internal PayPal error occurred"}):b.notify(new qc(e)),p.sheetFailed(this.name,e),(n=this.abortController)==null||n.abort("[PayPal] Error occurred");const a=t.translate("brand.paypal");ie(a,t)}requiresBillingAgreement(){return this.walletParams.hasManagedSellingPlanState||this.walletParams.requiresBillingAgreement}async decelerateOrAbort(e){if(e.abortReason==="out_of_stock")return await this.handleOutOfStock(),!0;if(!e.data)return!1;const{totalAmount:t,checkoutUrl:n}=e.data;let a;return e.decelerationReason&&Gc.includes(e.decelerationReason)?a=e.decelerationReason:Jr({currentCartTotal:t,initialBuyerCurrency:this.buyerCurrency})&&(a="currency_changed"),a?(U({checkoutUrl:n,instrumentName:this.name,reason:a}),!0):!1}async handleOutOfStock(){p.authorizationComplete({instrument:this.name,result:"failed",measurement:Q(M.AuthorizationLatency,this.name)}),be(await this.i18n)}hasSellingPlanConflict(e){const{hasManagedSellingPlanState:t}=this.walletParams;return t==null||!e?!1:e.lineItems.some(n=>n.sellingPlanAllocation!=null)!==t}}me=new WeakMap;class qc extends ee{constructor(e){super(e.message,{cause:e.cause}),d(this,"name","PayPalError"),d(this,"useHashPrefix",!0),this.stack=e.stack}}const Fe=class Yh extends Ce{static walletName(){return"paypal"}constructor(e){super(e)}getWebComponentName(){return"shopify-paypal-button"}getInstrumentName(){return y.PayPal}getWebComponentClass(){return jc}loadWalletSDK(){let e=Yh.paypalSDKPromiseByUrl.get(this.walletParams.sdkUrl);if(e)return p.log({body:"Returning cached PayPal SDK promise",attributes:{sdkUrl:this.walletParams.sdkUrl}}),e;const t=document.createElement("script");return t.setAttribute("src",this.walletParams.sdkUrl),e=new Promise((n,a)=>{t.setAttribute("data-namespace",Ka(this.walletParams.sdkUrl)),t.onload=()=>n(),t.onerror=o=>{Yh.paypalSDKPromiseByUrl.delete(this.walletParams.sdkUrl),t&&document.body.contains(t)&&document.body.removeChild(t),a(o)},document.body.appendChild(t)}),Yh.paypalSDKPromiseByUrl.set(this.walletParams.sdkUrl,e),e}getLoadEligibility(){return this.isInIframe()?{eligible:!1,reason:"cannot be loaded in an iframe"}:{eligible:!0}}getPartnerSDKEligibility(){var e,t;try{return(t=(e=Ya(this.walletParams.sdkUrl))==null?void 0:e.Buttons)!=null&&t.call(e).isEligible()?{eligible:!0}:{eligible:!1,reason:"PayPal SDK not eligible"}}catch(n){throw new te({code:"paypal-sdk-eligibility-check-failed",message:"PayPal SDK 'isEligible' method failed unexpectedly: ".concat(n)})}}};d(Fe,"paypalSDKPromiseByUrl",new Map);let vr=Fe;const Wc=".apple-pay-button{display:flex;align-items:center;justify-content:center;width:100%;padding:0!important;cursor:pointer;border:none}.apple-pay-button:hover:not(:disabled){filter:brightness(92%)}.apple-pay-button:disabled{opacity:.5;cursor:not-allowed}.apple-pay-button svg{height:100%;flex-shrink:0}.apple-pay--content{font-size:16px;font-family:San Francisco,sans-serif;width:100%;height:100%;flex-grow:1;display:flex;align-items:center;justify-content:center;white-space:pre}.apple-pay--light{background:#fff;color:#000}.apple-pay--light svg{fill:#000}.apple-pay--dark{background:#000;color:#fff}.apple-pay--dark svg{fill:#fff}",Tr={UK:"GB",JA:"JP"},Yc={EG:"EG",AE:"AE"},Qa=["AS","GU","MP","PR","VI"];Qa.forEach(r=>{Tr[r]="US"});const Kc=/^[A-Z]{1,2}[0-9]{1,2}[A-Z]?$/,Qc=/^[A-Z][0-9][A-Z]$/;function Jc({postalCode:r,countryCode:e}){let t=r;const n=r.trim().toUpperCase();return e==="CA"&&Qc.test(n)?t="".concat(n," 0Z0"):e==="GB"&&Kc.test(n)&&(t="".concat(n," 0ZZ")),t}function Rt(r,e=!1){var t,n;const a=r.countryCode,o={firstName:r.givenName||void 0,lastName:r.familyName||void 0,address1:(t=r==null?void 0:r.addressLines)==null?void 0:t[0],address2:((n=r==null?void 0:r.addressLines)==null?void 0:n[1])||void 0,city:r.locality||void 0,zip:r.postalCode||void 0,province:r.administrativeArea||r.subLocality||void 0,country:Xc(r.countryCode),phone:r.phoneNumber||void 0};return a&&Object.keys(Yc).includes(a.toUpperCase())&&(o.province=r.locality||void 0,o.city=r.administrativeArea||r.subLocality||void 0),e&&o.zip&&(o.zip=Jc({postalCode:o.zip,countryCode:o.country})),o.country==="HK"&&(o.zip=void 0,o.province=r.postalCode),a&&Qa.includes(a)&&(o.province=a),o.lastName||(o.lastName=o.firstName),o}function Xc(r){if(!r)return"ZZ";const e=r.toUpperCase();return Object.keys(Tr).includes(e)?Tr[e]:e}function Zc(r,e){return r.map(t=>{const{title:n,deliveryPromise:a}=rd(t,e);return{title:n,estimatedCost:{amount:td(t),currencyCode:t[0].estimatedCost.currencyCode},handle:Xa(t),deliveryPromise:a}})}function ed(r,e){return r.map(t=>{const{title:n,description:a}=nd(t,e);return{title:n,description:a,handle:Xa(t)}})}function Ja({deliveryGroups:r}){return r.map(e=>e.deliveryOptions.filter(({deliveryMethodType:t})=>t==="SHIPPING").map(t=>({...t,groupType:e.groupType}))).reduce((e,t)=>e.flatMap(n=>t.map(a=>[...n,a])),[[]])}function td(r){return r.reduce((e,t)=>e+Number(t.estimatedCost.amount),0).toFixed(2)}function rd(r,e){const t=r.find(l=>l.groupType===De.OneTimePurchase),n=r.find(l=>l.groupType===De.Subscription),a=[...new Set([t==null?void 0:t.title,n==null?void 0:n.title])].filter(Boolean),o=[...new Set([t==null?void 0:t.deliveryPromise,n==null?void 0:n.deliveryPromise])].filter(Boolean),i=a.length===2?e.translate("shipping_methods.connect_shipping_methods",{methodOne:a[0],methodTwo:a[1]}):a[0],s=o.length===2?e.translate("delivery_promises.connect_delivery_promises",{promiseOne:o[0],promiseTwo:o[1]}):o[0];return{title:i,deliveryPromise:s}}function nd(r,e){const t=r.find(i=>i.groupType===De.OneTimePurchase),n=r.find(i=>i.groupType===De.Subscription),a=r.map(ad).filter(Boolean).join(", ");let o=(t==null?void 0:t.title)||(n==null?void 0:n.title);return t&&n&&(o=e.translate("shipping_methods.connect_shipping_methods",{methodOne:t.title,methodTwo:n.title})),{title:o,description:a}}function ad(r){const e=Number(r.estimatedCost.amount).toFixed(2),t=r.estimatedCost.currencyCode,n=r.deliveryPromise;return n?"(".concat(n,") ").concat(e," ").concat(t):"".concat(e," ").concat(t)}function Xa(r){return r.map(e=>e.handle).join(",")}function Za({deliveryGroups:r,i18n:e}){const t=r.some(n=>n.groupType===De.Subscription);return r.map(n=>{var a;let o=e.translate("order_summary.shipping");return t&&(o=n.groupType===De.Subscription?e.translate("order_summary.shipping_subscription"):e.translate("order_summary.shipping_one_time_purchase")),{label:o,amount:ye(((a=n.selectedDeliveryOption)==null?void 0:a.estimatedCost.amount)||0)}})}function od(r,e){return dt({label:r,possibleLines:[e]})[0]}function id({subtotal:r,deliveryGroups:e,duties:t,taxes:n,discountAllocations:a,i18n:o,formattedRecurringTotals:i,lineItems:s}){var l;const c=dt({label:o.translate("order_summary.subtotal"),possibleLines:[r]}),u=Za({deliveryGroups:e,i18n:o}),m=dt({label:o.translate("order_summary.duties"),possibleLines:[t]}),h=dt({label:o.translate("order_summary.taxes"),possibleLines:[n]}),g=i.map(_=>({label:_,amount:"0.00",type:"pending"})),f=g.length?[{label:o.translate("order_summary.subscriptions.recurring_total_tooltip_line"),amount:"0.00",type:"pending"}]:[],v=(l=a==null?void 0:a.flatMap(_=>{var A;const k=(A=_.title)!=null?A:_.code;return dt({label:k!=null?k:o.translate("order_summary.discount"),possibleLines:[_.discountedAmount],isDiscount:!0})}))!=null?l:[];return[...Da(s,(_,A)=>({label:_,amount:A,type:"final"})),...c,...u,...m,...h,...v,...g,...f]}function dt({label:r,possibleLines:e,isDiscount:t=!1}){return e.filter(n=>(n==null?void 0:n.amount)!==void 0).map(n=>({label:r,amount:t?"-".concat(ye(n.amount)):ye(n.amount)}))}function kn(r,e){if(!r.length)return[];const t=Ja({deliveryGroups:r});return Zc(t,e).map(n=>{var a;return{label:n.title||"",amount:n.estimatedCost.amount,identifier:n.handle,detail:(a=n.deliveryPromise)!=null?a:""}})}const sd=["decelerate","abort","show_error","complete","update"];class Kt extends ee{constructor(){super(...arguments),d(this,"name","UnhandledActionError")}}class eo{constructor(){d(this,"generatePrioritizedPaymentSheetAction",(e,t)=>{let n;const a=[],o=[],i=[],s=t.filter(c=>c.code!=="PAYMENTS_UNACCEPTABLE_PAYMENT_AMOUNT").some(c=>e.get(c)!==void 0);for(const c of e.keys())if(!(c.code==="PAYMENTS_UNACCEPTABLE_PAYMENT_AMOUNT"&&s)){const u=e.get(c)();u.effects&&o.push(...u.effects),u.action!=="complete"&&u.errors&&i.push(...u.errors),a.push(u)}const l=(c=>sd.map(u=>c.find(m=>m.action===u)).find(u=>!!u))(a);return l&&(n=l,n.effects=o,n.action!=="complete"&&(n.errors=i)),n})}getMergedPaymentSheetAction({result:e,errorActions:t}){const n=new Map;t.forEach(o=>{o.matchers.forEach(i=>{const s=e.errors.find(l=>bt(l,i));s&&n.set(s,o.generateAction)})});let a;for(const o of e.errors){const i=n.get(o);if(i){a=i();break}}return{firstPaymentSheetAction:a,prioritizedPaymentSheetAction:this.generatePrioritizedPaymentSheetAction(n,e.errors)}}getUnhandledErrors(e,t){const n=t.flatMap(a=>a.matchers);return e.filter(a=>!n.some(o=>bt(a,o)))}decelerateOrAbort({reason:e,instrumentName:t,errorOrWarning:n,checkoutUrl:a,requestType:o}){return a?{action:"decelerate",redirectUrl:a,reason:e}:{action:"abort",effects:[()=>{b.notify(new Error("[".concat(t,"] unexpected ").concat(n," received in ").concat(o," response, aborting")))}]}}}function ld({error:r,context:e,result:t}){var n,a;return(a=r.code==="PENDING_PROCESS"&&!e.shippingRequired&&((n=t.data)==null?void 0:n.lineItems.some(o=>o.merchandise.requiresShipping)))!=null?a:!1}class cd extends eo{constructor(e){super(),this.i18n=e}mapMutationResultToPaymentSheetAction({result:e,context:t,checkoutUrl:n,requestType:a}){var o;const i=this.mapCustomValidationFunctionErrorToAction(e.errors);if(i)return i;const s=this.getErrorActions({shippingCountryCode:t==null?void 0:t.shippingCountryCode,billingCountryCode:t==null?void 0:t.billingCountryCode,checkoutUrl:n,requestType:a}),l=e.errors,c=this.getUnhandledErrors(l,s);c.forEach(m=>{ld({error:m,context:t,result:e})?b.notify(new hn("[".concat(y.ApplePay,"] digital physical mismatch issue, PENDING_PROCESS returned and shipping is not required but items require shipping"))):b.notify(new Kt("[".concat(y.ApplePay,"] mutation result error not handled: ").concat(ge(m)),{groupingHash:"UnhandledActionError:".concat(y.ApplePay,":").concat(ge(m))}))});const{firstPaymentSheetAction:u}=this.getMergedPaymentSheetAction({result:e,errorActions:s});return!u&&((o=e.data)==null?void 0:o.deliveryGroups.length)===0&&t!=null&&t.shippingRequired?{action:"show_error",errors:[new ApplePayError("addressUnserviceable")]}:u||(c.length>0?{action:"abort",effects:[()=>{ie(this.i18n.translate("brand.apple_pay"),this.i18n)}]}:{action:"update",errors:[]})}mapCompletionResultToPaymentSheetAction({result:e,context:t,checkoutUrl:n}){if(!e.data)throw new Sa(y.ApplePay);switch(e.data.__typename){case"SubmitSuccess":return{action:"complete",redirectUrl:e.data.redirectUrl};case"SubmitAlreadyAccepted":case"SubmitThrottled":case"SubmitFailed":{const a=this.mapCustomValidationFunctionErrorToAction(e.errors);if(a)return a;const o=this.getErrorActions({shippingCountryCode:t==null?void 0:t.shippingCountryCode,billingCountryCode:t==null?void 0:t.billingCountryCode,checkoutUrl:n,requestType:"completion"}),i=e.errors;i.some(l=>l.code==="NO_DELIVERY_GROUP_SELECTED")&&!t.shippingRequired&&b.notify(new hn("[".concat(y.ApplePay,"] digital physical mismatch issue: NO_DELIVERY_GROUP_SELECTED returned but shipping is not required"))),this.getUnhandledErrors(i,o).forEach(l=>{b.notify(new Kt("[".concat(y.ApplePay,"] completion result error not handled: ").concat(ge(l)),{groupingHash:"UnhandledActionError:".concat(y.ApplePay,":").concat(ge(l))}))});const{prioritizedPaymentSheetAction:s}=this.getMergedPaymentSheetAction({result:e,errorActions:o});return s||{action:"abort",effects:[()=>{ie(this.i18n.translate("brand.apple_pay"),this.i18n)}]}}default:throw new Error("[".concat(y.ApplePay,"] unknown completion result type: ").concat(e.data.__typename))}}decelerateOrAbort(...e){var t;const n=super.decelerateOrAbort(...e);return n.action==="abort"&&((t=n.effects)==null||t.push(()=>{ie(this.i18n.translate("brand.apple_pay"),this.i18n)})),n}getAbortActions(){return[{matchers:Qr,generateAction:()=>({action:"abort",effects:[()=>be(this.i18n)]})}]}getDecelerateActions({checkoutUrl:e,requestType:t}){return[{matchers:[Bt],generateAction:()=>this.decelerateOrAbort({reason:"captcha_required",instrumentName:y.ApplePay,errorOrWarning:Bt.code,checkoutUrl:e,requestType:t})},{matchers:[Ft],generateAction:()=>this.decelerateOrAbort({reason:"localization_extension_field_error",instrumentName:y.ApplePay,errorOrWarning:Ft.code,checkoutUrl:e,requestType:t})},{matchers:[Cn],generateAction:()=>this.decelerateOrAbort({reason:"account_info_mismatch",instrumentName:y.ApplePay,errorOrWarning:Cn.code,checkoutUrl:e,requestType:t})},{matchers:[$t],generateAction:()=>this.decelerateOrAbort({reason:"invalid_language",instrumentName:y.ApplePay,errorOrWarning:$t.code,checkoutUrl:e,requestType:t})},{matchers:[zt],generateAction:()=>this.decelerateOrAbort({reason:"invalid_country",instrumentName:y.ApplePay,errorOrWarning:zt.code,checkoutUrl:e,requestType:t})},{matchers:[Sn],generateAction:()=>this.decelerateOrAbort({reason:"payments_country_invalid",instrumentName:y.ApplePay,errorOrWarning:Sn.code,checkoutUrl:e,requestType:t})},{matchers:[Pn],generateAction:()=>this.decelerateOrAbort({reason:"cart_empty",instrumentName:y.ApplePay,errorOrWarning:Pn.code,checkoutUrl:e,requestType:t})},{matchers:[Ht],generateAction:()=>this.decelerateOrAbort({reason:"missing_cart_id",instrumentName:y.ApplePay,errorOrWarning:Ht.code,checkoutUrl:e,requestType:t})},{matchers:[Vt],generateAction:()=>this.decelerateOrAbort({reason:"redirect_to_checkout_required",instrumentName:y.ApplePay,errorOrWarning:Vt.code,checkoutUrl:e,requestType:t})},{matchers:[Gt],generateAction:()=>this.decelerateOrAbort({reason:"unsupported_apple_pay_payment_method",instrumentName:y.ApplePay,errorOrWarning:Gt.code,checkoutUrl:e,requestType:t})},{matchers:[Pr],generateAction:()=>this.decelerateOrAbort({reason:"custom_validation",instrumentName:y.ApplePay,errorOrWarning:Pr.code,checkoutUrl:e,requestType:t})},{matchers:Yr,generateAction:()=>this.decelerateOrAbort({reason:"invalid_payment_amount",instrumentName:y.ApplePay,errorOrWarning:"INVALID_PAYMENT",checkoutUrl:e,requestType:t})},{matchers:Kr,generateAction:()=>this.decelerateOrAbort({reason:"dynamic_tax",instrumentName:y.ApplePay,errorOrWarning:"TAX_NEW_TAX_MUST_BE_ACCEPTED",checkoutUrl:e,requestType:t})},{matchers:[In],generateAction:()=>this.decelerateOrAbort({reason:"generic_error",instrumentName:y.ApplePay,errorOrWarning:In.code,checkoutUrl:e,requestType:t})},{matchers:Va,generateAction:()=>this.decelerateOrAbort({reason:"not_enough_stock",instrumentName:y.ApplePay,errorOrWarning:"MERCHANDISE_NOT_ENOUGH_STOCK",checkoutUrl:e,requestType:t})}]}getShowErrorActions({shippingCountryCode:e,billingCountryCode:t}){return[{matchers:ft.required,generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","emailAddress",this.i18n.translate("errors.missing.email"))]})},{matchers:ft.invalid,generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","emailAddress",this.i18n.translate("errors.invalid.email"))]})},{matchers:w.required.firstName,generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","name",this.i18n.translate("errors.missing.first_name"))]})},{matchers:w.invalid.firstName,generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","name",this.i18n.translate("errors.invalid.first_name"))]})},{matchers:w.required.lastName,generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","name",this.i18n.translate("errors.missing.last_name"))]})},{matchers:w.invalid.lastName,generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","name",this.i18n.translate("errors.invalid.last_name"))]})},{matchers:Ga,generateAction:()=>({action:"show_error",errors:[new ApplePayError("addressUnserviceable")]})},{matchers:w.required.address1,generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","addressLines",this.i18n.translate("errors.missing.address1"))]})},{matchers:w.invalid.address1,generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","addressLines",this.i18n.translate("errors.invalid.address1"))]})},{matchers:w.emojis.lastName,generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","name",this.i18n.translate("errors.emojis.last_name"))]})},{matchers:w.emojis.firstName,generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","name",this.i18n.translate("errors.emojis.first_name"))]})},{matchers:w.tooLong.address1,generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","addressLines",this.i18n.translate("errors.too_long.address1"))]})},{matchers:w.tooLong.address2,generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","addressLines",this.i18n.translate("errors.too_long.address2"))]})},{matchers:w.tooLong.firstName,generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","name",this.i18n.translate("errors.too_long.first_name"))]})},{matchers:w.tooLong.lastName,generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","name",this.i18n.translate("errors.too_long.last_name"))]})},{matchers:w.tooLong.city,generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","locality",this.i18n.translate("errors.too_long.city"))]})},{matchers:w.containsUrl.firstName,generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","name",this.i18n.translate("errors.url.first_name"))]})},{matchers:w.containsUrl.lastName,generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","name",this.i18n.translate("errors.url.last_name"))]})},{matchers:w.htmlTags.address1,generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","addressLines",this.i18n.translate("errors.html_tags.address1"))]})},{matchers:w.htmlTags.address2,generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","addressLines",this.i18n.translate("errors.html_tags.address2"))]})},{matchers:w.htmlTags.city,generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","locality",this.i18n.translate("errors.html_tags.city"))]})},{matchers:w.htmlTags.firstName,generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","name",this.i18n.translate("errors.html_tags.first_name"))]})},{matchers:w.htmlTags.lastName,generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","name",this.i18n.translate("errors.html_tags.last_name"))]})},{matchers:w.emojis.city,generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","locality",this.i18n.translate("errors.emojis.city"))]})},{matchers:w.emojis.address1,generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","addressLines",this.i18n.translate("errors.emojis.address1"))]})},{matchers:w.emojis.address2,generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","addressLines",this.i18n.translate("errors.emojis.address2"))]})},{matchers:w.emojis.postalCode,generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","postalCode",this.i18n.translate("errors.emojis.postal_code"))]})},{matchers:w.required.address2,generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","addressLines",this.i18n.translate("errors.missing.address2"))]})},{matchers:w.invalid.address2,generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","addressLines",this.i18n.translate("errors.invalid.address2"))]})},{matchers:w.required.city,generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","locality",this.i18n.translate("errors.missing.city"))]})},{matchers:w.invalid.city,generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","locality",this.i18n.translate("errors.invalid.city"))]})},{matchers:w.invalid.province,generateAction:()=>({action:"show_error",errors:[this.createApplePayZoneError(this.i18n.translate("errors.invalid.zone"),this.i18n.translate("errors.invalid.emirate"),"shippingContactInvalid",e)]})},{matchers:w.required.province,generateAction:()=>({action:"show_error",errors:[this.createApplePayZoneError(this.i18n.translate("errors.missing.zone"),this.i18n.translate("errors.missing.emirate"),"shippingContactInvalid",e)]})},{matchers:w.required.postalCode,generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","postalCode",this.i18n.translate("errors.missing.postal_code"))]})},{matchers:w.invalid.postalCode,generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","postalCode",this.i18n.translate("errors.invalid.postal_code"))]})},{matchers:w.required.country,generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","country",this.i18n.translate("errors.missing.country"))]})},{matchers:w.invalid.phoneNumber,generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","phoneNumber",this.i18n.translate("errors.invalid.phone"))]})},{matchers:w.invalid.country,generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","country",this.i18n.translate("errors.invalid.country"))]})},{matchers:w.required.phoneNumber,generateAction:()=>({action:"show_error",errors:[new ApplePayError("shippingContactInvalid","phoneNumber",this.i18n.translate("errors.missing.phone"))]})},{matchers:C.invalid.generic,generateAction:()=>({action:"show_error",errors:[new ApplePayError("billingContactInvalid")]})},{matchers:C.required.firstName,generateAction:()=>({action:"show_error",errors:[new ApplePayError("billingContactInvalid","name",this.i18n.translate("errors.missing.first_name"))]})},{matchers:C.required.lastName,generateAction:()=>({action:"show_error",errors:[new ApplePayError("billingContactInvalid","name",this.i18n.translate("errors.missing.last_name"))]})},{matchers:C.required.address1,generateAction:()=>({action:"show_error",errors:[new ApplePayError("billingContactInvalid","addressLines",this.i18n.translate("errors.missing.address1"))]})},{matchers:C.required.address2,generateAction:()=>({action:"show_error",errors:[new ApplePayError("billingContactInvalid","addressLines",this.i18n.translate("errors.missing.address2"))]})},{matchers:C.required.city,generateAction:()=>({action:"show_error",errors:[new ApplePayError("billingContactInvalid","locality",this.i18n.translate("errors.missing.city"))]})},{matchers:C.required.phoneNumber,generateAction:()=>({action:"show_error",errors:[new ApplePayError("billingContactInvalid","phoneNumber",this.i18n.translate("errors.missing.phone"))]})},{matchers:C.required.postalCode,generateAction:()=>({action:"show_error",errors:[new ApplePayError("billingContactInvalid","postalCode",this.i18n.translate("errors.missing.postal_code"))]})},{matchers:C.required.province,generateAction:()=>({action:"show_error",errors:[this.createApplePayZoneError(this.i18n.translate("errors.missing.zone"),this.i18n.translate("errors.missing.emirate"),"billingContactInvalid",t)]})},{matchers:C.emojis.firstName,generateAction:()=>({action:"show_error",errors:[new ApplePayError("billingContactInvalid","name",this.i18n.translate("errors.emojis.first_name"))]})},{matchers:C.htmlTags.firstName,generateAction:()=>({action:"show_error",errors:[new ApplePayError("billingContactInvalid","name",this.i18n.translate("errors.html_tags.first_name"))]})},{matchers:C.invalid.firstName,generateAction:()=>({action:"show_error",errors:[new ApplePayError("billingContactInvalid","name",this.i18n.translate("errors.invalid.first_name"))]})},{matchers:C.emojis.lastName,generateAction:()=>({action:"show_error",errors:[new ApplePayError("billingContactInvalid","name",this.i18n.translate("errors.emojis.last_name"))]})},{matchers:C.htmlTags.lastName,generateAction:()=>({action:"show_error",errors:[new ApplePayError("billingContactInvalid","name",this.i18n.translate("errors.html_tags.last_name"))]})},{matchers:C.invalid.lastName,generateAction:()=>({action:"show_error",errors:[new ApplePayError("billingContactInvalid","name",this.i18n.translate("errors.invalid.last_name"))]})},{matchers:C.emojis.address1,generateAction:()=>({action:"show_error",errors:[new ApplePayError("billingContactInvalid","addressLines",this.i18n.translate("errors.emojis.address1"))]})},{matchers:C.htmlTags.address1,generateAction:()=>({action:"show_error",errors:[new ApplePayError("billingContactInvalid","addressLines",this.i18n.translate("errors.html_tags.address1"))]})},{matchers:C.invalid.address1,generateAction:()=>({action:"show_error",errors:[new ApplePayError("billingContactInvalid","addressLines",this.i18n.translate("errors.invalid.address1"))]})},{matchers:C.emojis.address2,generateAction:()=>({action:"show_error",errors:[new ApplePayError("billingContactInvalid","addressLines",this.i18n.translate("errors.emojis.address2"))]})},{matchers:C.htmlTags.address2,generateAction:()=>({action:"show_error",errors:[new ApplePayError("billingContactInvalid","addressLines",this.i18n.translate("errors.html_tags.address2"))]})},{matchers:C.invalid.address2,generateAction:()=>({action:"show_error",errors:[new ApplePayError("billingContactInvalid","addressLines",this.i18n.translate("errors.invalid.address2"))]})},{matchers:C.emojis.city,generateAction:()=>({action:"show_error",errors:[new ApplePayError("billingContactInvalid","locality",this.i18n.translate("errors.emojis.city"))]})},{matchers:C.htmlTags.city,generateAction:()=>({action:"show_error",errors:[new ApplePayError("billingContactInvalid","locality",this.i18n.translate("errors.html_tags.city"))]})},{matchers:C.invalid.city,generateAction:()=>({action:"show_error",errors:[new ApplePayError("billingContactInvalid","locality",this.i18n.translate("errors.invalid.city"))]})},{matchers:C.emojis.phoneNumber,generateAction:()=>({action:"show_error",errors:[new ApplePayError("billingContactInvalid","phoneNumber",this.i18n.translate("errors.emojis.phone"))]})},{matchers:C.invalid.phoneNumber,generateAction:()=>({action:"show_error",errors:[new ApplePayError("billingContactInvalid","phoneNumber",this.i18n.translate("errors.invalid.phone"))]})},{matchers:C.emojis.postalCode,generateAction:()=>({action:"show_error",errors:[new ApplePayError("billingContactInvalid","postalCode",this.i18n.translate("errors.emojis.postal_code"))]})},{matchers:C.invalid.postalCode,generateAction:()=>({action:"show_error",errors:[new ApplePayError("billingContactInvalid","postalCode",this.i18n.translate("errors.invalid.postal_code"))]})},{matchers:[Xl],generateAction:()=>({action:"show_error",errors:[new ApplePayError("unknown")]})},{matchers:[Zl],generateAction:()=>({action:"show_error",errors:[new ApplePayError("couponCodeInvalid",void 0,this.i18n.translate("errors.invalid.discount"))]})}]}getErrorActions({shippingCountryCode:e,billingCountryCode:t,checkoutUrl:n,requestType:a}){return[...this.getAbortActions(),...this.getDecelerateActions({checkoutUrl:n,requestType:a}),...this.getShowErrorActions({shippingCountryCode:e,billingCountryCode:t})]}mapCustomValidationFunctionErrorToAction(e){const t=Vr(e);return t?{action:"abort",effects:[()=>{const n=this.i18n.translate("brand.apple_pay");jr(this.i18n.translate("error_dialogs.wallet.title",{wallet:n}),t.message)}]}:null}createApplePayZoneError(e,t,n,a){const o=a==="AE"?"subLocality":"administrativeArea";return new ApplePayError(n,o,a==="AE"?t:e)}}const On=["name","postalAddress"];function dd({shippingRequired:r,walletParams:e,buyerCurrency:t}){const{phoneRequired:n,emailRequired:a}=e,o=[...a?["email"]:[],...n?["phone"]:[]],i=r?[...On,...o]:o;return{countryCode:e.countryCode,currencyCode:t,merchantCapabilities:e.merchantCapabilities,supportedNetworks:e.supportedNetworks,total:{type:"pending",label:e.merchantName,amount:"1.00"},requiredBillingContactFields:On,requiredShippingContactFields:i,shippingType:e.shippingType}}const ud=r=>{const e=r.lineItems.flatMap(t=>t.discountAllocations);return[...r.discountCodes.filter(t=>t.applicable&&r.discountAllocations.findIndex(n=>n.code===t.code)===-1&&e.findIndex(n=>n.code===t.code)===-1).map(t=>({code:t.code,discountedAmount:{amount:"0",currencyCode:r.totalAmount.currencyCode}})),...r.discountAllocations,...e]};class hd extends ee{constructor(){super(...arguments),d(this,"name","ApplePaySessionCreationError"),d(this,"useHashPrefix",!0),d(this,"autogenerateHash",!0)}}const to=r=>{const e=r.lineItems.reduce((t,n)=>t+Number(n.subtotalAmount.amount),0);return{amount:String(e),currencyCode:r.totalAmount.currencyCode}};function pd(r,e){return r.reduce((t,n)=>{if(!n.sellingPlanAllocation)return t;const{sellingPlanAllocation:{sellingPlan:a,priceAdjustments:o},quantity:i}=n;if(!a.recurringDeliveries||!a.billingPolicy)return t;const s=md({billingPolicy:a.billingPolicy,i18n:e});if(o.length===0){const l=Dt({price:Number(n.subtotalAmount.amount)*i,currencyCode:n.subtotalAmount.currencyCode,locale:e.locale});return[...t,e.translate("order_summary.subscriptions.recurring_totals",{fixedPrice:l,interval:s})]}else if(o.length===1){const l=Dt({price:Number(o[0].price.amount)*i,currencyCode:o[0].price.currencyCode,locale:e.locale});return[...t,e.translate("order_summary.subscriptions.recurring_totals",{fixedPrice:l,interval:s})]}else if(o.length===2){const l=Dt({price:Number(o[0].price.amount)*i,currencyCode:o[0].price.currencyCode,locale:e.locale}),c=Dt({price:Number(o[1].price.amount)*i,currencyCode:o[1].price.currencyCode,locale:e.locale}),u=a.priceAdjustments[0].orderCount;return[...t,e.translate("order_summary.subscriptions.recurring_totals_with_policies",{count:u,fixedPrice:l,recurringPrice:c,interval:s})]}return t},[])}function Dt({price:r,currencyCode:e,locale:t}){return Intl.NumberFormat(t,{style:"currency",currency:e,currencyDisplay:"narrowSymbol"}).format(r)}function md({billingPolicy:r,i18n:e}){const{interval:t,intervalCount:n}=r,a={YEAR:"order_summary.subscriptions.recurring_total_intervals.year",MONTH:"order_summary.subscriptions.recurring_total_intervals.month",WEEK:"order_summary.subscriptions.recurring_total_intervals.week",DAY:"order_summary.subscriptions.recurring_total_intervals.day"}[t];if(!a)throw new Error("Unknown selling plan interval provided: ".concat(t));return e.translate(a,{count:n})}const ir="GraphQL Client",Ln=0,xn=3,ro="An error occurred while fetching from the API. Review 'graphQLErrors' for details.",no="Response returned unexpected Content-Type:",ao="An unknown error has occurred. The API did not return a data object or any errors in its response.",Nr={json:"application/json",multipart:"multipart/mixed"},Mn="X-SDK-Variant",Un="X-SDK-Version",gd="shopify-graphql-client",yd="1.4.1",oo=1e3,fd=[429,503],io=/@(defer)\b/i,Bn="\r\n",bd=/boundary="?([^=";]+)"?/i,Fn=Bn+Bn;function fe(r,e=ir){return r.startsWith("".concat(e))?r:"".concat(e,": ").concat(r)}function tt(r){return r instanceof Error?r.message:JSON.stringify(r)}function so(r){return r instanceof Error&&r.cause?r.cause:void 0}function lo(r){return r.flatMap(({errors:e})=>e!=null?e:[])}function co({client:r,retries:e}){if(e!==void 0&&(typeof e!="number"||e<Ln||e>xn))throw new Error("".concat(r,': The provided "retries" value (').concat(e,") is invalid - it cannot be less than ").concat(Ln," or greater than ").concat(xn))}function q(r,e){return e&&(typeof e!="object"||Array.isArray(e)||typeof e=="object"&&Object.keys(e).length>0)?{[r]:e}:{}}function uo(r,e){if(r.length===0)return e;const t={[r.pop()]:e};return r.length===0?t:uo(r,t)}function ho(r,e){return Object.keys(e||{}).reduce((t,n)=>(typeof e[n]=="object"||Array.isArray(e[n]))&&r[n]?(t[n]=ho(r[n],e[n]),t):(t[n]=e[n],t),Array.isArray(r)?[...r]:{...r})}function po([r,...e]){return e.reduce(ho,{...r})}function wd({clientLogger:r,customFetchApi:e=fetch,client:t=ir,defaultRetryWaitTime:n=oo,retriableCodes:a=fd}){const o=async(i,s,l)=>{const c=s+1,u=l+1;let m;try{if(m=await e(...i),r({type:"HTTP-Response",content:{requestParams:i,response:m}}),!m.ok&&a.includes(m.status)&&c<=u)throw new Error;const h=(m==null?void 0:m.headers.get("X-Shopify-API-Deprecated-Reason"))||"";return h&&r({type:"HTTP-Response-GraphQL-Deprecation-Notice",content:{requestParams:i,deprecationNotice:h}}),m}catch(h){if(c<=u){const g=m==null?void 0:m.headers.get("Retry-After");return await _d(g?parseInt(g,10):n),r({type:"HTTP-Retry",content:{requestParams:i,lastResponse:m,retryAttempt:s,maxRetries:l}}),o(i,c,l)}throw new Error(fe("".concat(l>0?"Attempted maximum number of ".concat(l," network retries. Last message - "):"").concat(tt(h)),t))}};return o}async function _d(r){return new Promise(e=>setTimeout(e,r))}function Ad({headers:r,url:e,customFetchApi:t=fetch,retries:n=0,logger:a}){co({client:ir,retries:n});const o={headers:r,url:e,retries:n},i=Ed(a),s=wd({customFetchApi:t,clientLogger:i,defaultRetryWaitTime:oo}),l=Cd(s,o),c=Sd(l),u=Dd(l);return{config:o,fetch:l,request:c,requestStream:u}}function Ed(r){return e=>{r&&r(e)}}async function mo(r){const{errors:e,data:t,extensions:n}=await r.json();return{...q("data",t),...q("extensions",n),headers:r.headers,...e||!t?{errors:{networkStatusCode:r.status,message:fe(e?ro:ao),...q("graphQLErrors",e),response:r}}:{}}}function Cd(r,{url:e,headers:t,retries:n}){return async(a,o={})=>{const{variables:i,headers:s,url:l,retries:c,keepalive:u,signal:m}=o,h=JSON.stringify({query:a,variables:i});co({client:ir,retries:c});const g=Object.entries({...t,...s}).reduce((v,[_,A])=>(v[_]=Array.isArray(A)?A.join(", "):A.toString(),v),{});!g[Mn]&&!g[Un]&&(g[Mn]=gd,g[Un]=yd);const f=[l!=null?l:e,{method:"POST",headers:g,body:h,signal:m,keepalive:u}];return r(f,1,c!=null?c:n)}}function Sd(r){return async(...e)=>{if(io.test(e[0]))throw new Error(fe("This operation will result in a streamable response - use requestStream() instead."));let t=null;try{t=await r(...e);const{status:n,statusText:a}=t,o=t.headers.get("content-type")||"";return t.ok?o.includes(Nr.json)?await mo(t):{errors:{networkStatusCode:n,message:fe("".concat(no," ").concat(o)),response:t}}:{errors:{networkStatusCode:n,message:fe(a),response:t}}}catch(n){return{errors:{message:tt(n),...t==null?{}:{networkStatusCode:t.status,response:t}}}}}}function Pd(r){return Ue(this,null,function*(){const e=new TextDecoder;if(r.body[Symbol.asyncIterator])try{for(var t=ne(r.body),n,a,o;n=!(a=yield new re(t.next())).done;n=!1){const i=a.value;yield e.decode(i)}}catch(i){o=[i]}finally{try{n&&(a=t.return)&&(yield new re(a.call(t)))}finally{if(o)throw o[0]}}else{const i=r.body.getReader();let s;try{for(;!(s=yield new re(i.read())).done;)yield e.decode(s.value)}finally{i.cancel()}}})}function Id(r,e){return{[Symbol.asyncIterator](){return Ue(this,null,function*(){try{let i="";try{for(var t=ne(r),n,a,o;n=!(a=yield new re(t.next())).done;n=!1){const s=a.value;if(i+=s,i.indexOf(e)>-1){const l=i.lastIndexOf(e),c=i.slice(0,l).split(e).filter(u=>u.trim().length>0).map(u=>u.slice(u.indexOf(Fn)+Fn.length).trim());c.length>0&&(yield c),i=i.slice(l+e.length),i.trim()==="--"&&(i="")}}}catch(s){o=[s]}finally{try{n&&(a=t.return)&&(yield new re(a.call(t)))}finally{if(o)throw o[0]}}}catch(i){throw new Error("Error occured while processing stream payload - ".concat(tt(i)))}})}}}function vd(r){return{[Symbol.asyncIterator](){return Ue(this,null,function*(){yield{...yield new re(mo(r)),hasNext:!1}})}}}function Td(r){return r.map(e=>{try{return JSON.parse(e)}catch(t){throw new Error("Error in parsing multipart response - ".concat(tt(t)))}}).map(e=>{const{data:t,incremental:n,hasNext:a,extensions:o,errors:i}=e;if(!n)return{data:t||{},...q("errors",i),...q("extensions",o),hasNext:a};const s=n.map(({data:l,path:c,errors:u})=>({data:l&&c?uo(c,l):{},...q("errors",u)}));return{data:s.length===1?s[0].data:po([...s.map(({data:l})=>l)]),...q("errors",lo(s)),hasNext:a}})}function Nd(r,e){if(r.length>0)throw new Error(ro,{cause:{graphQLErrors:r}});if(Object.keys(e).length===0)throw new Error(ao)}function Rd(r,e){var t,n;const a=(e!=null?e:"").match(bd),o="--".concat(a?a[1]:"-");if(!((t=r.body)!=null&&t.getReader)&&!((n=r.body)!=null&&n[Symbol.asyncIterator]))throw new Error("API multipart response did not return an iterable body",{cause:r});const i=Pd(r);let s={},l;return{[Symbol.asyncIterator](){return Ue(this,null,function*(){var c,u;try{let v=!0;try{for(var m=ne(Id(i,o)),h,g,f;h=!(g=yield new re(m.next())).done;h=!1){const _=g.value,A=Td(_);l=(u=(c=A.find(E=>E.extensions))==null?void 0:c.extensions)!=null?u:l;const k=lo(A);s=po([s,...A.map(({data:E})=>E)]),v=A.slice(-1)[0].hasNext,Nd(k,s),yield{...q("data",s),...q("extensions",l),hasNext:v}}}catch(_){f=[_]}finally{try{h&&(g=m.return)&&(yield new re(g.call(m)))}finally{if(f)throw f[0]}}if(v)throw new Error("Response stream terminated unexpectedly")}catch(v){const _=so(v);yield{...q("data",s),...q("extensions",l),errors:{message:fe(tt(v)),networkStatusCode:r.status,...q("graphQLErrors",_==null?void 0:_.graphQLErrors),response:r},hasNext:!1}}})}}}function Dd(r){return async(...e)=>{if(!io.test(e[0]))throw new Error(fe("This operation does not result in a streamable response - use request() instead."));try{const t=await r(...e),{statusText:n}=t;if(!t.ok)throw new Error(n,{cause:t});const a=t.headers.get("content-type")||"";switch(!0){case a.includes(Nr.json):return vd(t);case a.includes(Nr.multipart):return Rd(t,a);default:throw new Error("".concat(no," ").concat(a),{cause:t})}}catch(t){return{[Symbol.asyncIterator](){return Ue(this,null,function*(){const n=so(t);yield{errors:{message:fe(tt(t)),...q("networkStatusCode",n==null?void 0:n.status),...q("response",n)},hasNext:!1}})}}}}}const kd="mutation cartCreate($input:CartInput!$country:CountryCode$language:LanguageCode$withCarrierRates:Boolean=false)@inContext(country:$country language:$language){result:cartCreate(input:$input){...@defer(if:$withCarrierRates){cart{...CartParts}errors:userErrors{...on CartUserError{message field code}}warnings:warnings{...on CartWarning{code}}}}}",Od="mutation cartUpdateDeliveryAddressAndContact($cartId:ID!$addressInput:[CartSelectableAddressInput!]!$buyerIdentityInput:CartBuyerIdentityInput!$country:CountryCode$language:LanguageCode$withCarrierRates:Boolean=false$prepareCart:Boolean=true)@inContext(country:$country language:$language){buyerIdentityUpdateResult:cartBuyerIdentityUpdate(cartId:$cartId buyerIdentity:$buyerIdentityInput){errors:userErrors{...CartErrorParts}warnings:warnings{...on CartWarning{code}}}addressUpdateResult:cartDeliveryAddressesReplace(addresses:$addressInput cartId:$cartId){errors:userErrors{...CartErrorParts}warnings:warnings{...on CartWarning{code}}}...PreparedCartFragment}",Ld="mutation cartAttributesUpdate($cartId:ID!$attributes:[AttributeInput!]!$country:CountryCode=CA$language:LanguageCode=EN$withCarrierRates:Boolean=false$prepareCart:Boolean=false)@inContext(country:$country language:$language){result:cartAttributesUpdate(cartId:$cartId attributes:$attributes){...@defer(if:$withCarrierRates)@skip(if:$prepareCart){cart{...CartParts}errors:userErrors{...CartErrorParts}warnings:warnings{...on CartWarning{code}}}...@include(if:$prepareCart){errors:userErrors{...CartErrorParts}warnings:warnings{...on CartWarning{code}}}}...PreparedCartFragment}",xd="mutation cartBillingAddressUpdate($cartId:ID!$billingAddress:MailingAddressInput$country:CountryCode$language:LanguageCode$withCarrierRates:Boolean=false$prepareCart:Boolean=false)@inContext(country:$country language:$language){result:cartBillingAddressUpdate(cartId:$cartId billingAddress:$billingAddress){...@defer(if:$withCarrierRates)@skip(if:$prepareCart){cart{...CartParts}errors:userErrors{...CartErrorParts}warnings:warnings{...on CartWarning{code}}}...@include(if:$prepareCart){errors:userErrors{...CartErrorParts}warnings:warnings{...on CartWarning{code}}}}...PreparedCartFragment}",Md="mutation cartBuyerIdentityUpdate($cartId:ID!$buyerIdentity:CartBuyerIdentityInput!$country:CountryCode$language:LanguageCode$withCarrierRates:Boolean=false$prepareCart:Boolean=false)@inContext(country:$country language:$language){result:cartBuyerIdentityUpdate(cartId:$cartId buyerIdentity:$buyerIdentity){...@defer(if:$withCarrierRates)@skip(if:$prepareCart){cart{...CartParts}errors:userErrors{...CartErrorParts}warnings:warnings{...on CartWarning{code}}}...@include(if:$prepareCart){errors:userErrors{...CartErrorParts}warnings:warnings{...on CartWarning{code}}}}...PreparedCartFragment}",Ud="mutation cartSelectedDeliveryOptionsUpdate($cartId:ID!$selectedDeliveryOptions:[CartSelectedDeliveryOptionInput!]!$country:CountryCode=CA$language:LanguageCode=EN$withCarrierRates:Boolean=false$prepareCart:Boolean=false)@inContext(country:$country language:$language){result:cartSelectedDeliveryOptionsUpdate(cartId:$cartId selectedDeliveryOptions:$selectedDeliveryOptions){...@defer(if:$withCarrierRates)@skip(if:$prepareCart){cart{...CartParts}errors:userErrors{...CartErrorParts}warnings:warnings{...on CartWarning{code}}}...@include(if:$prepareCart){errors:userErrors{...CartErrorParts}warnings:warnings{...on CartWarning{code}}}}...PreparedCartFragment}",Bd="mutation applePaySessionCreate($validationUrl:URL!){applePaySessionCreate(validationUrl:$validationUrl){...@defer{applePaySession{body}}}}",Fd="mutation PayPalBuyerDetailsFetch($token:String!$cartId:ID){paypalBuyerDetailsFetch(token:$token cartId:$cartId){...@defer{paypalDetails{email expiresAt remoteOrderId destinationAddress{...on MailingAddress{address1 address2 city company country firstName lastName phone province zip}}billingAddress{...on MailingAddress{address1 address2 city company country firstName lastName phone province zip}}payerApprovedAmount{currencyCode amount}}}}}",$d="mutation PayPalTokenCreate($cartId:ID!$billingAgreement:Boolean!){paypalTokenCreate(cartId:$cartId billingAgreement:$billingAgreement){...@defer{paypalToken{token}}}}",zd="query cartQuery($id:ID!$country:CountryCode$language:LanguageCode$withCarrierRates:Boolean=false)@inContext(country:$country language:$language){cart(id:$id){...@defer(if:$withCarrierRates){...CartParts}}}",Hd="query limitedCartQuery($id:ID!$country:CountryCode$language:LanguageCode)@inContext(country:$country language:$language){cart(id:$id){id lines(first:50){edges{node{merchandise{...on ProductVariant{requiresShipping}}sellingPlanAllocation{sellingPlan{id}}}}}}}",Gd="query subscriptionPolicyQuery($country:CountryCode$language:LanguageCode)@inContext(country:$country language:$language){shop{subscriptionPolicy(sanitized:true){body}}}",Vd="mutation cartPaymentUpdate($cartId:ID!$input:CartPaymentInput!$country:CountryCode$language:LanguageCode$withCarrierRates:Boolean=false$prepareCart:Boolean=false)@inContext(country:$country language:$language){result:cartPaymentUpdate(cartId:$cartId payment:$input){...@defer(if:$withCarrierRates)@skip(if:$prepareCart){cart{...CartParts}errors:userErrors{...CartErrorParts}warnings:warnings{...on CartWarning{code}}}...@include(if:$prepareCart){errors:userErrors{...CartErrorParts}warnings:warnings{...on CartWarning{code}}}}...PreparedCartFragment}",kt="fragment CartParts on Cart{id checkoutUrl deliveryGroups(first:10 withCarrierRates:$withCarrierRates){edges{node{id groupType selectedDeliveryOption{code title handle deliveryPromise deliveryMethodType estimatedCost{amount currencyCode}}deliveryOptions{code title handle deliveryPromise deliveryMethodType estimatedCost{amount currencyCode}}}}}cost{subtotalAmount{amount currencyCode}totalAmount{amount currencyCode}totalTaxAmount{amount currencyCode}totalDutyAmount{amount currencyCode}}discountAllocations{discountedAmount{amount currencyCode}...on CartCodeDiscountAllocation{code}...on CartAutomaticDiscountAllocation{title}...on CartCustomDiscountAllocation{title}}discountCodes{code applicable}lines(first:10){edges{node{...on CartLine{parentRelationship{parent{id}}}quantity cost{subtotalAmount{amount currencyCode}totalAmount{amount currencyCode}}discountAllocations{discountedAmount{amount currencyCode}...on CartCodeDiscountAllocation{code}...on CartAutomaticDiscountAllocation{title}...on CartCustomDiscountAllocation{title}}merchandise{...on ProductVariant{requiresShipping title product{title}}}sellingPlanAllocation{remainingBalanceChargeAmount{amount}priceAdjustments{price{amount currencyCode}}sellingPlan{billingPolicy{...on SellingPlanRecurringBillingPolicy{interval intervalCount}}priceAdjustments{orderCount}recurringDeliveries}}}}}}",fr="fragment CartErrorParts on CartUserError{message field code}",$n="fragment PreparedCartFragment on Mutation{preparedCart:cartPrepareForCompletion(cartId:$cartId)@include(if:$prepareCart){...@defer(if:$withCarrierRates){result{__typename ...on CartStatusReady{cart{...CartParts}}...on CartStatusNotReady{cart{...CartParts}errors{code message}}...on CartThrottled{cart{...CartParts}pollAfter}}errors:userErrors{...CartErrorParts}}}}",jd="mutation prepareCart($cartId:ID!$country:CountryCode$language:LanguageCode$withCarrierRates:Boolean=false$prepareCart:Boolean=true)@inContext(country:$country language:$language){...PreparedCartFragment}",qd="mutation cartSubmitForCompletion($cartId:ID!$attemptToken:String!$country:CountryCode$language:LanguageCode)@inContext(country:$country language:$language){cartSubmitForCompletion(cartId:$cartId attemptToken:$attemptToken){result{__typename ...on SubmitSuccess{redirectUrl}...on SubmitThrottled{pollAfterV2:pollAfter}...on SubmitFailed{errors{code message}checkoutUrl}}errors:userErrors{...on CartUserError{code field message}}}}",Wd="mutation cartRemovePersonalData($cartId:ID!){cartRemovePersonalData(cartId:$cartId){errors:userErrors{...CartErrorParts}warnings:warnings{...on CartWarning{code}}}}";async function Yd(r,e){var t,n;if(!e.errors)return;const a=nu(e.errors,r),o=await ru(e.errors.response),i=((n=(t=e.errors.response)==null?void 0:t.headers)==null?void 0:n.get("content-type"))||void 0,s=[];if(e.errors.graphQLErrors)for(const l of e.errors.graphQLErrors)l.code&&s.push(l.code);return{operationName:r,statusCode:e.errors.networkStatusCode,contentType:i,message:a,responseBody:o,errorCodes:s}}const Kd=[/API multipart response did not return an iterable body/,/Error in parsing multipart response/,/GraphQL Client: Response returned unexpected Content-Type:/,/GraphQL Client: (?:null|undefined) is not an object/i,/Internal error/,/Carrier-calculated rates through @defer is temporarily unavailable/,/Throttled/,/Request blocked/,/Network request failed/,/Load failed/,/Failed to fetch/,/when attempting to fetch resource/],Qd=[/signal is aborted/i,/fetch is aborted/i,/operation was aborted/i,/\[Apple Pay\] Payment sheet cancelled/],Jd=[/timed?.out/i,/error occured while processing stream payload/i,/response stream terminated/i],Xd=/provided invalid value/,Zd=["quantity","sellingPlanId","attributes"];function eu(r){var e;return Xd.test(r)&&(e=Zd.find(t=>r.includes(t)))!=null?e:null}function tu(r,{hasBeenVisible:e=!1}={}){if(r.statusCode&&r.statusCode!==200)return{isIgnorable:!0,reason:"statusCode-".concat(r.statusCode)};if(r.message){if(Jd.some(n=>n.test(r.message)))return{isIgnorable:!0,reason:"timeout"};if(Qd.some(n=>n.test(r.message)))return{isIgnorable:!0,reason:"abort"};if(Kd.some(n=>n.test(r.message)))return{isIgnorable:!0,reason:"message"};const t=eu(r.message);if(t)return{isIgnorable:!0,reason:"graphql-input-validation-".concat(t)}}return e?{isIgnorable:!1,reason:void 0}:{isIgnorable:!0,reason:"component-not-visible"}}async function ru(r){if(!r||r.bodyUsed)return"";try{return(await r.text()).slice(0,1024)}catch(e){return console.error("Failed to read response body:",e),""}}function nu(r,e){var t,n;if(!r)return"";const a=(n=(t=r.graphQLErrors)==null?void 0:t.map(s=>s.message).join(", "))!=null?n:"",o="".concat(r.message).concat(a.length>0?" - ".concat(a):""),i=r.networkStatusCode?"with status ".concat(r.networkStatusCode," => ").concat(o):"=> ".concat(o);return"GraphQL response error for ".concat(e,": ").concat(i)}const zn="UNKNOWN";function au({url:r,accessToken:e}){return{headers:{"Content-Type":"application/json",Accept:"application/json","X-Shopify-Storefront-Access-Token":e,"X-SDK-Variant":"portable-wallets"},url:r,retries:0,customFetchApi:(t,n)=>(b.leaveBreadcrumb("Request ".concat((n==null?void 0:n.method)||zn,": ").concat(t),{url:t,method:n==null?void 0:n.method},"request"),fetch(t,n)),logger:t=>{try{switch(t.type){case"HTTP-Response":{const[n,a]=t.content.requestParams,{status:o,statusText:i,headers:s,type:l}=t.content.response;b.leaveBreadcrumb("Response ".concat((a==null?void 0:a.method)||zn,": ").concat(n),{statusCode:o,statusText:i,responseHeaders:ou(s),responseType:l,url:n,method:a==null?void 0:a.method,headers:a==null?void 0:a.headers,body:a==null?void 0:a.body},"log");break}case"HTTP-Retry":{const{retryAttempt:n,maxRetries:a,lastResponse:o,requestParams:[i,s]=[]}=t.content;b.leaveBreadcrumb("GraphQL Retry Attempt ".concat(n,"/").concat(a,": ").concat(i),{retryAttempt:n,maxRetries:a,url:i,method:s==null?void 0:s.method,lastResponseStatus:o==null?void 0:o.status},"log");break}case"HTTP-Response-GraphQL-Deprecation-Notice":{const{deprecationNotice:n,requestParams:a}=t.content,[o,i]=a||[];b.leaveBreadcrumb("GraphQL Deprecation Notice: ".concat(o),{deprecationNotice:n,url:o,method:i==null?void 0:i.method},"log");break}default:{const n=t;b.leaveBreadcrumb("GraphQL Logger: ".concat(n.type),{type:n.type,content:n.content},"log")}}}catch(n){}}}}function ou(r){if("fromEntries"in Object)return Object.fromEntries(r);const e={};for(const[t,n]of r.entries())e[t]=n;return e}function iu({streetAddress:r,validateAddress:e}){return[{selected:!0,oneTimeUse:!0,validationStrategy:e?"STRICT":"COUNTRY_CODE_ONLY",address:{deliveryAddress:su(r)}}]}function su(r){return{address1:r.address1,address2:r.address2,city:r.city,firstName:r.firstName,lastName:r.lastName,phone:r.phone,zip:r.zip,company:r.company,countryCode:r.country,provinceCode:r.province}}const lu="unstable";class sr{constructor({accessToken:e,country:t,locale:n,apiVersion:a=lu,withCarrierRates:o=!1}){if(d(this,"OPERATION_NAME_REGEX",/[^ ]+ (\w+)/),d(this,"LANGUAGES_WITH_REGION",["zh-CN","zh-TW","pt-BR","pt-PT"]),d(this,"client"),d(this,"country"),d(this,"url"),d(this,"locale"),d(this,"withCarrierRates"),d(this,"lastValidCart"),d(this,"hasBeenVisible",!1),d(this,"checkoutState","building"),!e||!t)throw new te({code:"invalid-webcomponent",message:"accelerated checkout rendered without required webcomponent attributes"});if(!n)throw new Error("StorefrontApiClient constructed with no locale");this.country=t,this.locale=n,this.withCarrierRates=o,this.url="/api/".concat(a,"/graphql.json"),this.client=Ad(au({url:this.url,accessToken:e}))}async createCart(e,t,n){var a,o,i;const s=await this.requestStream([kd,kt],{input:{lines:du()?e.lines.map(h=>({merchandiseId:h.merchandiseId,quantity:h.quantity,sellingPlanId:h.sellingPlanId,attributes:this.stringifyAttributes(h.lineItemProperties),parent:h.parent})):[{merchandiseId:e.merchandiseId,quantity:e.quantity,sellingPlanId:e.sellingPlanId,attributes:this.stringifyAttributes(e.lineItemProperties)}],discountCodes:e.discountCodes,buyerIdentity:e.buyerIdentity},country:this.country,language:this.formatLanguage(this.locale)},{instrumentName:e.instrumentName,startingCheckout:!0,operationName:"createCart"});try{for(var l=ne(s),c,u,m;c=!(u=await l.next()).done;c=!1){const h=u.value;h.errors&&await this.onError({operationName:"createCart",response:h});const g=(a=h.data)==null?void 0:a.result;if(g&&!h.hasNext){g.errors.length>0&&this.onResultError(g.errors);const f=this.parseMutationWarnings((i=(o=h.data)==null?void 0:o.result)==null?void 0:i.warnings),v=g.cart?this.parseCartResponse(g.cart):null;return{data:v,errors:this.parseMutationErrors({result:h,key:"result",operationName:"cartCreate"}),warnings:f,decelerationReason:mr({cart:v,warnings:f,supportsSubscriptions:t,supportsDeferredPurchaseOptions:n}),abortReason:Tn({cart:v,warnings:f})}}}}catch(h){m=[h]}finally{try{c&&(u=l.return)&&await u.call(l)}finally{if(m)throw m[0]}}throw new ue("Cart create operation returned no response")}async updateCartBillingAddress(e){const{cartId:t,billingAddress:n,instrumentName:a}=e;return this.requestDeferredCart(xd,{cartId:t,billingAddress:n},{instrumentName:a,operationName:"updateCartBillingAddress"})}async updateCartBuyerIdentity(e,t){const{cartId:n,instrumentName:a,validateAddress:o=!1,streetAddress:i}=e;if(this.checkoutState=o?"authorized":"building",st()){const{deliveryAddressPreferences:s,...l}=Hn(e);return await this.requestDeferredCart(Od,{cartId:n,buyerIdentityInput:l,addressInput:i?iu({streetAddress:i,validateAddress:o}):[]},{instrumentName:a,operationName:"cartUpdateDeliveryAddressAndContact",abortSignal:t})}else return this.requestDeferredCart(Md,{cartId:n,buyerIdentity:Hn(e)},{instrumentName:a,operationName:"updateCartBuyerIdentity",abortSignal:t})}async updateSelectedDeliveryOptions(e,t,n,a){let o=t;const i=oe()+2e4;for(;oe()<i;){const s=await this.requestDeferredCart(Ud,{cartId:e,selectedDeliveryOptions:o},{instrumentName:n,operationName:"updateSelectedDeliveryOptions",abortSignal:a});if(st())return s.errors=s.errors.filter(c=>c.code!=="PENDING_DELIVERY_GROUPS"),s;if(!s.errors.some(c=>c.code==="PENDING_DELIVERY_GROUPS"))return s;const l=s.data.deliveryGroups.flatMap(c=>c.deliveryOptions.map(u=>({deliveryOptionHandle:u.handle,deliveryGroupId:c.id})));o=o.map(c=>{var u;return(u=l.find(m=>m.deliveryOptionHandle===c.deliveryOptionHandle))!=null?u:c})}throw new Error("Selected delivery options update operation timed out")}async applePaySessionCreate(e){var t,n,a;const o=await this.requestStream([Bd],{validationUrl:e.toString()},{instrumentName:y.ApplePay,operationName:"applePaySessionCreate"});try{for(var i=ne(o),s,l,c;s=!(l=await i.next()).done;s=!1){const u=l.value;u.errors&&await this.onError({operationName:"applePaySessionCreate",response:u});const m=(a=(n=(t=u.data)==null?void 0:t.applePaySessionCreate)==null?void 0:n.applePaySession)==null?void 0:a.body;if(m)return m}}catch(u){c=[u]}finally{try{s&&(l=i.return)&&await l.call(i)}finally{if(c)throw c[0]}}throw new ue("Apple Pay session create operation returned no response")}async paypalBuyerDetailsFetch(e,t){var n,a;const o=await this.requestStream([Fd],{token:e,cartId:t},{instrumentName:y.PayPal,operationName:"paypalBuyerDetailsFetch"});try{for(var i=ne(o),s,l,c;s=!(l=await i.next()).done;s=!1){const u=l.value;if(u.hasNext)continue;if(u.errors){if(u.errors.graphQLErrors){const h=Rn(u.errors.graphQLErrors);if(h!=null&&h.code)throw new Z(h.code)}await this.onError({operationName:"paypalBuyerDetailsFetch",response:u})}const m=(a=(n=u.data)==null?void 0:n.paypalBuyerDetailsFetch)==null?void 0:a.paypalDetails;if(m)return m}}catch(u){c=[u]}finally{try{s&&(l=i.return)&&await l.call(i)}finally{if(c)throw c[0]}}throw new ue("PayPal buyer details fetch operation returned no response")}async paypalTokenCreate({cartId:e,billingAgreement:t}){var n,a,o;const i=await this.requestStream([$d],{cartId:e,billingAgreement:t},{instrumentName:y.PayPal,operationName:"paypalTokenCreate"});try{for(var s=ne(i),l,c,u;l=!(c=await s.next()).done;l=!1){const m=c.value;if(m.errors){if(m.errors.graphQLErrors){const g=Rn(m.errors.graphQLErrors);if(g!=null&&g.code)throw g.isLoggable&&(p.log({body:"PayPal Token Create ".concat(g.code," Error")}),p.paypalTokenCreationError({errorCode:g.code})),new Z(g.code)}await this.onError({operationName:"paypalTokenCreate",response:m})}const h=(o=(a=(n=m.data)==null?void 0:n.paypalTokenCreate)==null?void 0:a.paypalToken)==null?void 0:o.token;if(h)return h}}catch(m){u=[m]}finally{try{l&&(c=s.return)&&await c.call(s)}finally{if(u)throw u[0]}}throw new ue("PayPal token create operation returned no response")}async fetchLimitedCart({id:e,startingCheckout:t,instrumentName:n}){var a,o;const i=await this.request([Hd],{id:e},{instrumentName:n,startingCheckout:t});if(i.errors&&await this.onError({operationName:"limitedCartQuery",response:i}),!((a=i.data)!=null&&a.cart))throw new bi("Limited cart query returned no response");return b.leaveBreadcrumb("limitedCartQuery response",{operationName:"limitedCartQuery",body:(o=i.data)==null?void 0:o.cart},"log"),{id:i.data.cart.id,shippingRequired:i.data.cart.lines.edges.some(s=>s.node.merchandise.requiresShipping),sellingPlan:i.data.cart.lines.edges.some(s=>s.node.sellingPlanAllocation!=null)}}async fetchCart({id:e,startingCheckout:t,instrumentName:n}){var a;const o=this.formatLanguage(this.locale),i=st(),s=i?"Prepare cart":"Fetch cart",l=i?jd:zd,c=i?[kt,fr,$n]:[kt],u=i?{cartId:e,country:this.country,language:o,withCarrierRates:!1,prepareCart:!0}:{id:e,country:this.country,language:o,withCarrierRates:this.withCarrierRates},m=await this.requestStream([l,...c],u,{instrumentName:n,startingCheckout:t,operationName:"fetchCart"});try{for(var h=ne(m),g,f,v;g=!(f=await h.next()).done;g=!1){const _=f.value;_.errors&&await this.onError({operationName:"fetchCart",response:_});let A=null,k;if(!_.data)throw new ue("".concat(s," operation returned no data in response"));if(cu(_.data)){const E=_.data.preparedCart;A=(a=E==null?void 0:E.result)==null?void 0:a.cart,k=this.parsePreparedCartMutationErrors(_.errors,this.extractPreparedCartMutationErrors(E,n),"prepareCart")}else A=_.data.cart;if(b.leaveBreadcrumb("".concat(s," response"),{operationName:s,body:A,errors:k,hasNext:_.hasNext},"log"),A&&!_.hasNext){const E=this.parseCartResponse(A);return this.lastValidCart=E,E}}}catch(_){v=[_]}finally{try{g&&(f=h.return)&&await f.call(h)}finally{if(v)throw v[0]}}throw new ue("".concat(s," operation returned no response"))}async updateCartPayment(e,t,n,a){var o,i,s,l,c,u,m,h,g,f;const v={cartId:e,input:t},{amount:_,currencyCode:A}=t.amount;let k,E,rt=!1,$;this.checkoutState="authorized";try{const z=oe()+1e4;for(;oe()<z;){const S=await this.requestDeferredCart(Vd,v,{instrumentName:n,operationName:"updateCartPayment",abortSignal:a});if(k||(k=S),E=S,!st()&&S.errors.length>0&&S.errors.some(G=>Yr.some(se=>bt(G,se)))){parseFloat((i=(o=S.data.totalTaxAmount)==null?void 0:o.amount)!=null?i:"0")===0&&await new Promise(G=>setTimeout(G,500)),v.input.amount={amount:S.data.totalAmount.amount,currencyCode:S.data.totalAmount.currencyCode},$!=null||($={retryCount:0,retryStartTime:oe()}),$.retryCount++;continue}return jt({currentCart:{totalAmount:S.data.totalAmount},previousCart:{totalAmount:{amount:_,currencyCode:A}}})!=="inc"&&S.data.totalAmount.currencyCode===A?(rt=!0,S):k}throw p.updateCartPaymentTimeout({instrument:n}),new Ve("Payment update operation timed out",{reason:"timeout",errorDetails:{operationName:"updateCartPayment"}})}finally{if($){const z=oe()-$.retryStartTime,S=(s=E==null?void 0:E.data)==null?void 0:s.totalAmount.amount;let G;E!=null&&E.data&&_&&(G=jt({currentCart:{totalAmount:E.data.totalAmount},previousCart:{totalAmount:{amount:_,currencyCode:A}}})),p.cartPaymentUpdateRetryResult({instrument:n,retryCount:$.retryCount,retryDuration:z,success:rt,totalAmountChange:G,originalAmount:_,originalCurrencyCode:A,finalAmount:S,finalCurrencyCode:(l=E==null?void 0:E.data)==null?void 0:l.totalAmount.currencyCode,finalSubtotalAmount:(u=(c=E==null?void 0:E.data)==null?void 0:c.subtotalAmount)==null?void 0:u.amount,finalTotalTaxAmount:(h=(m=E==null?void 0:E.data)==null?void 0:m.totalTaxAmount)==null?void 0:h.amount,finalTotalDutyAmount:(f=(g=E==null?void 0:E.data)==null?void 0:g.totalDutyAmount)==null?void 0:f.amount})}}}async updateCartAttributes({cartId:e,attributes:t,instrumentName:n,startingCheckout:a}){const o={cartId:e,attributes:t};return await this.requestDeferredCart(Ld,o,{instrumentName:n,operationName:"updateCartAttributes",startingCheckout:a})}async submitForCompletion(e,t,n){var a,o;const i=this.formatLanguage(this.locale),s=await this.request([qd],{cartId:e,attemptToken:t,country:this.country,language:i,withCarrierRates:this.withCarrierRates},{instrumentName:n,operationName:"submitForCompletion"});return s.errors&&await this.handleGraphQLErrorResponse("submitForCompletion",s),{data:(o=(a=s.data)==null?void 0:a.cartSubmitForCompletion)==null?void 0:o.result,errors:this.parseCompletionErrors(s)}}async fetchSubscriptionPolicy(){var e,t;const{data:n}=await this.request([Gd],{country:this.country,language:this.formatLanguage(this.locale)},{operationName:"fetchSubscriptionPolicy"});return(t=(e=n==null?void 0:n.shop)==null?void 0:e.subscriptionPolicy)==null?void 0:t.body}async cartRemovePersonalData({cartId:e,instrumentName:t}){var n,a;let o,i,s;try{const c=await this.request([Wd,fr],{cartId:e},{instrumentName:t,keepalive:!0});o=this.parseMutationWarnings((a=(n=c.data)==null?void 0:n.cartRemovePersonalData)==null?void 0:a.warnings),i=this.parseMutationErrors({result:c,key:"cartRemovePersonalData",operationName:"cartRemovePersonalData"})}catch(c){s=c.toString()}const l=!(o!=null&&o.length||i!=null&&i.length||s);p.removePersonalDataResult({success:l}),l||p.log({body:"cartRemovePersonalData failed",attributes:{cartId:e,warnings:o,errors:i,exception:s}})}setVisible(){this.hasBeenVisible=!0}generateURLWithOperationName(e){const t=e.match(this.OPERATION_NAME_REGEX);if(t){const n=this.url.includes("?")?"&":"?",a="operation_name=".concat(t[1]);return"".concat(this.url).concat(n).concat(a)}return this.url}async request(e,t,n){return this.client.request(e.join(""),{variables:t,headers:Gn(n),url:this.generateURLWithOperationName(e[0]),keepalive:n.keepalive})}async requestStream(e,t,n){return this.client.requestStream(e.join(""),{variables:t,headers:Gn(n),url:this.generateURLWithOperationName(e[0]),signal:n.abortSignal})}async requestDeferredCart(e,t,n){var a,o,i,s,l;const c=this.formatLanguage(this.locale),u=st(),m=await this.requestStream([e,kt,fr,$n],{...t,country:this.country,language:c,withCarrierRates:this.withCarrierRates&&!u,prepareCart:u},n);try{for(var h=ne(m),g,f,v;g=!(f=await h.next()).done;g=!1){const _=f.value;_.errors&&await this.onError({operationName:n.operationName,response:_,abortSignal:n.abortSignal});const A=this.extractMutationErrors(_,n),k=this.extractMutationWarnings(_),E=(o=(a=_.data)==null?void 0:a.preparedCart)==null?void 0:o.result,rt=(l=(s=(i=_.data)==null?void 0:i.result)==null?void 0:s.cart)!=null?l:E==null?void 0:E.cart;if(rt&&!_.hasNext){let $;u?($=this.parseCartResponse(rt),this.lastValidCart=$):$=await this.fetchCart({id:rt.id,instrumentName:n.instrumentName,startingCheckout:!1});const z=this.parsePreparedCartMutationErrors(_.errors,A,n.operationName);return{data:$,errors:z,warnings:k,abortReason:Tn({cart:$,warnings:k}),decelerationReason:mr({warnings:k,cart:$,cartStatus:E==null?void 0:E.__typename,errors:z})}}if(this.lastValidCart&&A.length>0)return this.onResultError(A),{data:this.lastValidCart,errors:this.parsePreparedCartMutationErrors(_.errors,A,n.operationName),warnings:k,decelerationReason:mr({warnings:k,cart:this.lastValidCart})}}}catch(_){v=[_]}finally{try{g&&(f=h.return)&&await f.call(h)}finally{if(v)throw v[0]}}throw new ue("Deferred cart operation returned no response")}async handleGraphQLErrorResponse(e,t){const n=await Yd(e,t);if(!n)return;const{message:a,...o}=n,{isIgnorable:i,reason:s}=tu(n,{hasBeenVisible:this.hasBeenVisible});if(b.leaveBreadcrumb(a,{ignored:i,ignoredReason:s,...t,...o},"error"),i)throw p.log({body:"Ignored GraphQL response error",attributes:{message:a,reason:s,...o}}),new Ve(a,{reason:s,errorDetails:o});return{message:a,errorDetails:o}}async onError({operationName:e,response:t,abortSignal:n}){if(n!=null&&n.aborted)throw p.log({body:"Request aborted",attributes:{operationName:e,reason:n.reason}}),new Ve("Request aborted",{reason:"abort",errorDetails:{operationName:e}});const a=await this.handleGraphQLErrorResponse(e,t);if(!a)return;const{message:o,errorDetails:i}=a;throw new Pt(o,{errorDetails:i})}onResultError(e){b.leaveBreadcrumb("GraphQL result error",e,"error")}formatLanguage(e){return e.includes("-")?this.LANGUAGES_WITH_REGION.includes(e)?e.toUpperCase().replace("-","_"):e.split("-")[0].toUpperCase():e.toUpperCase()}parseCartResponse(e){var t,n,a;const o=e.lines.edges.map(s=>{var l,c,u,m;const h=s.node,g="parentRelationship"in h&&((c=(l=h.parentRelationship)==null?void 0:l.parent)==null?void 0:c.id)!==void 0;return{quantity:h.quantity,totalAmount:{amount:h.cost.totalAmount.amount,currencyCode:h.cost.totalAmount.currencyCode},subtotalAmount:{amount:(u=h.cost.subtotalAmount)==null?void 0:u.amount,currencyCode:(m=h.cost.subtotalAmount)==null?void 0:m.currencyCode},merchandise:{requiresShipping:h.merchandise.requiresShipping,title:h.merchandise.title,product:{title:h.merchandise.product.title}},discountAllocations:h.discountAllocations,sellingPlanAllocation:h.sellingPlanAllocation,isNestedLine:g}}),i=e.deliveryGroups.edges.map(s=>s.node);return{id:e.id,totalAmount:e.cost.totalAmount,subtotalAmount:(t=e.cost.subtotalAmount)!=null?t:void 0,totalTaxAmount:(n=e.cost.totalTaxAmount)!=null?n:void 0,totalDutyAmount:(a=e.cost.totalDutyAmount)!=null?a:void 0,discountAllocations:e.discountAllocations,discountCodes:e.discountCodes,lineItems:o,deliveryGroups:i,checkoutUrl:e.checkoutUrl}}parseGraphQlErrors(e){var t,n;return(n=(t=e==null?void 0:e.graphQLErrors)==null?void 0:t.map(a=>({code:a.message.replace(/\(Expected.*\)/,"").trim()})))!=null?n:[]}parseErrorIntoCartError({message:e,code:t,field:n}){let a;if(n&&n.length===1)a=n.at(0);else if(n&&n.length>1){const o=n[n.length-1];a=["billingAddress","deliveryAddress"].includes(o)?o:n.slice(-2).filter(i=>!i.match(/^\d+$/)).join(".")}return{code:t===null?void 0:t,field:a,message:e}}parseMutationErrors({result:e,key:t,operationName:n}){var a,o,i;const s=this.parseGraphQlErrors(e.errors),l=((i=(o=(a=e.data)==null?void 0:a[t])==null?void 0:o.errors)==null?void 0:i.map(this.parseErrorIntoCartError).filter(u=>u))||[],c=[...s,...l];return c.length>0&&b.leaveBreadcrumb("GraphQL errors on mutation '".concat(n,"'"),c,"error"),c}parseMutationWarnings(e){return!e||e.length===0?[]:e.map(t=>t.code)}stringifyAttributes(e){return e&&e.map(t=>({key:t.key,value:typeof t.value=="string"?t.value:JSON.stringify(t.value)}))}extractPreparedCartMutationErrors(e,t){var n,a;const o=(n=e==null?void 0:e.errors)!=null?n:[];if(((a=e==null?void 0:e.result)==null?void 0:a.__typename)==="CartStatusNotReady"){const i=[];o.push(...e.result.errors.filter(s=>{const l=lc[this.checkoutState];return l.length===0?!0:l.some(c=>c.code===s.code)?(i.push(s.code),!1):!0})),i.includes("DELIVERY_WRONG_NUMBER_OF_LINES")&&p.deliveryWrongNumberOfLines({instrument:t}),i.length>0&&b.leaveBreadcrumb("Filtered errors on mutation prepareCart",i,"log")}return o}extractMutationErrors(e,{instrumentName:t,operationName:n}){var a;if(!e.data)return[];const{preparedCart:o,__typename:i,...s}=e.data,l=Object.values(s).map(u=>{var m;return(m=u==null?void 0:u.errors)!=null?m:[]}).flat(),c=this.extractPreparedCartMutationErrors((a=e.data)==null?void 0:a.preparedCart,t);return c.length>0&&n==="updateCartAttributes"?(p.log({body:"Update cart attributes errors from prepareCart mutation",attributes:{instrumentName:t,errors:JSON.stringify(c)}}),l):[...l,...c]}extractMutationWarnings(e){if(!e.data)return[];const{preparedCart:t,__typename:n,...a}=e.data;return Object.values(a).map(o=>{var i;return this.parseMutationWarnings((i=o==null?void 0:o.warnings)!=null?i:[])}).flat()}parsePreparedCartMutationErrors(e,t,n){const a=this.parseGraphQlErrors(e),o=t.map(this.parseErrorIntoCartError).filter(s=>s),i=[...a,...o];return i.length>0&&b.leaveBreadcrumb("GraphQL errors on mutation '".concat(n,"'"),i,"error"),i}parseCompletionErrors(e){var t,n,a,o,i,s;const l=this.parseGraphQlErrors(e.errors);let c=[];((a=(n=(t=e.data)==null?void 0:t.cartSubmitForCompletion)==null?void 0:n.result)==null?void 0:a.__typename)==="SubmitFailed"&&(c=(o=e.data.cartSubmitForCompletion.result.errors.map(m=>({code:m.code})))!=null?o:[]);const u=[...l,...c];return u.length>0?b.leaveBreadcrumb("GraphQL errors on completion",u,"error"):e.errors&&b.leaveBreadcrumb("Errors on submitForCompletion",{errors:e.errors,hasData:!!e.data,hasResult:!!((s=(i=e.data)==null?void 0:i.cartSubmitForCompletion)!=null&&s.result)},"error"),u}}function cu(r){return!("cart"in r)}function st(){return j.enabled(Re)}function du(){return j.enabled(Wr)}function Hn({emailAddress:r,countryCode:e,phone:t,streetAddress:n,validateAddress:a,preferences:o}){return{email:r,countryCode:e!=null?e:n==null?void 0:n.country,phone:t!=null?t:n==null?void 0:n.phone,deliveryAddressPreferences:n?[{deliveryAddressValidationStrategy:a?"STRICT":"COUNTRY_CODE_ONLY",deliveryAddress:n}]:[],preferences:o}}function Gn({instrumentName:r,startingCheckout:e}){const t={};return r&&(t["X-Wallet-Name"]="".concat(r)),e&&(t["X-Start-Wallet-Checkout"]="".concat(e)),t}async function go({cartId:r,cartClient:e,instrumentName:t,selectedDeliveryOptions:n,abortSignal:a}){try{if(!r)throw new Error("[".concat(t,"] provided no cart ID when updating shipping method"));if(!e)throw new Error("[".concat(t,"] provided invalid cart client when updating shipping method"));return await e.updateSelectedDeliveryOptions(r,n,t,a)}catch(o){throw p.updateFailed({instrument:t,request:"updateSelectedDeliveryOptions",error:o}),o}}async function yo({cartId:r,token:e,cartClient:t,instrumentName:n}){try{if(!r)throw new Error("[".concat(n,"] provided no cart ID when submitting for completion"));if(!t)throw new Error("[".concat(n,"] provided invalid cart client when submitting for completion"));if(!e)throw new Error("[".concat(n,"] provided no token when submitting for completion"));return await t.submitForCompletion(r,e,n)}catch(a){throw p.updateFailed({instrument:n,request:"submitForCompletion",error:a}),a}}function fo({selectedDeliveryOptionHandles:r,deliveryGroups:e,instrumentName:t}){return e.map(n=>{const a=n.deliveryOptions.filter(o=>r.includes(o.handle));if(!a.length)return{deliveryGroupId:"",deliveryOptionHandle:""};if(a.length>1)throw new uu("[".concat(t,"] found multiple delivery options with selectedDeliverOptionHandle in group: ").concat(n.id),{groupingHash:"getSelectedDeliveryOptions::MultipleOptions"});return{deliveryGroupId:n.id,deliveryOptionHandle:a[0].handle}}).filter(n=>!!n.deliveryGroupId)}class uu extends ee{constructor(){super(...arguments),d(this,"name","GetSelectedDeliveryOptionsError")}}async function hu(r){const{cartClient:e,instrumentName:t}=r;try{if(!r.cartId)throw new Error("[".concat(t,"] provided no cart ID when updating billing address"));if(!e)throw new Error("[".concat(t,"] provided invalid cart client when updating billing address"));return await e.updateCartBillingAddress(r)}catch(n){throw p.updateFailed({instrument:t,request:"updateBillingAddress",error:n}),n}}function mt({result:r,instrument:e}){var t;const n=(t=r.errors)!=null?t:[];cc(n,Kr)&&p.dynamicTaxFailed({instrument:e})}const Vn=["cart_throttled","not_enough_stock","payment_method_not_applicable","account_info_mismatch","price_increased","nested_line_subscription","nested_line_deferred_payment"];class pu{constructor({accessToken:e,buyerCountry:t,buyerCurrency:n,button:a,i18n:o,merchantName:i,dataSource:s,apiClient:l,walletParams:c}){d(this,"name",y.ApplePay),d(this,"accessToken"),d(this,"button"),d(this,"buyerCountry"),d(this,"cart"),d(this,"apiClient"),d(this,"dataSource"),d(this,"i18n"),d(this,"merchantName"),d(this,"session"),d(this,"paymentSheetActionGenerator"),d(this,"cancelled"),d(this,"buyerCurrency"),d(this,"customerAccountEmail"),d(this,"abortController",null),d(this,"isPersonalDataCleared",!1),d(this,"isSheetLoaded",!1),d(this,"walletParams"),d(this,"shouldPadPostalCode"),d(this,"onvalidatemerchant",async u=>{var m,h,g,f;try{b.leaveBreadcrumb("ApplePay onvalidatemerchant: Starting merchant validation",{validationURL:u.validationURL},"log");const v=new URL(u.validationURL),_=this.getMerchantSession(v);b.leaveBreadcrumb("ApplePay onvalidatemerchant: Calling handleCreateCart",{},"log");const{cart:A,decelerationReason:k,customValidationError:E,unrecoverableError:rt}=await Ae({element:this.button,instrumentName:this.name,dataSource:this.dataSource});if(b.leaveBreadcrumb("ApplePay onvalidatemerchant: handleCreateCart result",{hasCart:!!A,cartId:(m=A==null?void 0:A.id)!=null?m:"null"},"log"),rt){b.leaveBreadcrumb("ApplePay Session unrecoverable error",{unrecoverableError:rt},"error"),p.sheetClicked({instrument:this.name,result:"rejected",reason:"unrecoverable_error"}),this.withActiveSession("abort",()=>this.session.abort()),(h=this.abortController)==null||h.abort("[Apple Pay] Unrecoverable error ".concat(rt)),xe(this.i18n,rt);return}if(E){b.leaveBreadcrumb("ApplePay Session custom validation error",{customValidationError:E},"error"),p.sheetClicked({instrument:this.name,result:"rejected",reason:"custom_validation_error"}),this.withActiveSession("abort",()=>this.session.abort()),(g=this.abortController)==null||g.abort("[Apple Pay] Custom validation error"),Le(this.i18n,E.message);return}this.cart=A,Ta({cart_token:Gr(A)});const $=await _;if(b.leaveBreadcrumb("ApplePay Session completeMerchantValidation",{session:$},"log"),k&&Vn.includes(k)){p.sheetClicked({instrument:this.name,result:"success",reason:"deceleration"}),await this.terminateSession(),U({checkoutUrl:(f=A==null?void 0:A.checkoutUrl)!=null?f:"",instrumentName:this.name,reason:k,stage:"onValidateMerchant::createCart"});return}if(this.sessionIsCancelled()){p.sheetClicked({instrument:this.name,result:"rejected",reason:"cancelled"});return}this.withActiveSession("completeMerchantValidation",()=>this.session.completeMerchantValidation($)),p.sheetClicked({instrument:this.name,result:"success"})}catch(v){p.sheetClicked({instrument:y.ApplePay,result:"failed",reason:"unhandled_error"}),p.log({body:"Unhandled error detected in Apple Pay sheet clicked",attributes:{error:String(v),location:"onvalidatemerchant"}}),this.terminateSession({error:v})}}),d(this,"onshippingcontactselected",async u=>{if(!this.sessionIsCancelled())try{const m=Rt(u.shippingContact,this.shouldPadPostalCode),h=await je({cartId:this.cart.id,streetAddress:m,cartClient:this.apiClient,instrumentName:this.name});if(await this.decelerateOrAbort({result:h,stage:"onShippingContactSelected::updateBuyerIdentity"}))return;await this.applyPaymentSheetActions({result:h,onProceed:g=>this.completeShippingContactSelection(h.data,g),context:{shippingRequired:this.isShippingRequired,shippingCountryCode:m.country},checkoutUrl:this.cart.checkoutUrl,requestType:"onShippingContactSelected::updateBuyerIdentity",afterAuthorization:!1})}catch(m){this.terminateSession({error:m})}}),d(this,"onshippingmethodselected",async u=>{var m,h,g;if(!this.sessionIsCancelled()){b.leaveBreadcrumb("ApplePay onshippingmethodselected: START",{hasCart:!!this.cart,cartId:(h=(m=this.cart)==null?void 0:m.id)!=null?h:"null",shippingMethodId:u.shippingMethod.identifier},"log");try{const f=u.shippingMethod.identifier.split(","),v=fo({selectedDeliveryOptionHandles:f,deliveryGroups:this.cart.deliveryGroups,instrumentName:this.name});if(v.length===0){this.handleShippingMethodNotFoundInCart(f);return}const _=await go({cartId:this.cart.id,cartClient:this.apiClient,instrumentName:this.name,selectedDeliveryOptions:v,abortSignal:(g=this.abortController)==null?void 0:g.signal});if(await this.decelerateOrAbort({result:_,stage:"onShippingMethodSelected::updateSelectedDeliveryOptions"}))return;await this.applyPaymentSheetActions({result:_,onProceed:()=>this.completeShippingMethodSelection(_.data),context:{shippingRequired:this.isShippingRequired,shippingCountryCode:void 0},checkoutUrl:this.cart.checkoutUrl,requestType:"onShippingMethodSelected::updateSelectedDeliveryOptions",afterAuthorization:!1}),this.onSheetLoaded()}catch(f){this.terminateSession({error:f})}}}),d(this,"onpaymentmethodselected",async u=>{var m,h;if(!this.sessionIsCancelled()){b.leaveBreadcrumb("ApplePay onpaymentmethodselected: START",{hasCart:!!this.cart,cartId:(h=(m=this.cart)==null?void 0:m.id)!=null?h:"null"},"log");try{const{billingContact:g}=u.paymentMethod,f=this.cart.id;if(!this.isShippingRequired&&g){const A=Rt(g,!1),k=await je({cartId:this.cart.id,countryCode:A.country,cartClient:this.apiClient,instrumentName:this.name});if(await this.decelerateOrAbort({result:k,stage:"onPaymentMethodSelected::updateBuyerIdentity"}))return;await this.applyPaymentSheetActions({result:k,onProceed:()=>{this.cart=k.data},context:{shippingRequired:this.isShippingRequired,shippingCountryCode:A.country},checkoutUrl:this.cart.checkoutUrl,requestType:"onPaymentMethodSelected::updateBuyerIdentity",afterAuthorization:!1});const E=await hu({billingAddress:A,cartId:this.cart.id,cartClient:this.apiClient,instrumentName:this.name});if(await this.decelerateOrAbort({result:E,stage:"onPaymentMethodSelected::updateBillingAddress"}))return;await this.applyPaymentSheetActions({result:E,onProceed:()=>{this.cart=E.data},context:{shippingRequired:this.isShippingRequired,shippingCountryCode:A.country},checkoutUrl:this.cart.checkoutUrl,requestType:"onPaymentMethodSelected::updateBillingAddress",afterAuthorization:!1}),this.cart||p.log({body:"[ApplePay] Cart is null after onPaymentMethodSelected::updateBillingAddress",attributes:{cartId:f,result:E,walletParams:this.walletParams,isShippingRequired:this.isShippingRequired,session:this.sessionIsCancelled()}})}const{newTotal:v,newLineItems:_}=this.getNewTotalAndLineItems(this.cart);if(b.leaveBreadcrumb("ApplePay Session completePaymentMethodSelection",{newTotal:v,newLineItems:_},"log"),this.sessionIsCancelled())return;this.withActiveSession("completePaymentMethodSelection",()=>this.session.completePaymentMethodSelection({newTotal:v,newLineItems:_})),this.isShippingRequired||this.onSheetLoaded()}catch(g){this.terminateSession({error:g})}}}),d(this,"oncancel",()=>{var u;this.cancelled=!0,this.removePersonalData(),Q(M.SheetLoad,this.name),p.sheetCancelled(this.name),this.button.disabled=!1,(u=this.abortController)==null||u.abort("[Apple Pay] Payment sheet cancelled")}),d(this,"onpaymentauthorized",async u=>{var m,h;b.leaveBreadcrumb("ApplePay onpaymentauthorized: START",{hasCart:!!this.cart,cartId:(h=(m=this.cart)==null?void 0:m.id)!=null?h:"null",hasToken:!!u.payment.token},"log"),p.authorizationAttempt(this.name),et(M.AuthorizationLatency,this.name);const g=async z=>{var S,G,se;switch((S=z.effects)==null||S.forEach(Me=>Me()),z.action){case"complete":{const Me=ApplePaySession.STATUS_SUCCESS;try{await this.completePayment(Me),we(z.redirectUrl)}catch(pa){this.terminateSession({error:pa,afterAuthorization:!0})}break}case"show_error":{const Me=(G=z.errors)!=null?G:[];try{await this.completePayment(ApplePaySession.STATUS_FAILURE,Me)}catch(pa){this.terminateSession({error:pa,afterAuthorization:!0})}break}case"abort":{try{this.abortPaymentSheetAndShowError(),this.removePersonalData()}catch(Me){this.terminateSession({error:Me,afterAuthorization:!0})}break}case"decelerate":{try{await this.completePayment(ApplePaySession.STATUS_FAILURE),mu()?H({event:B.RecoveryFlowInitiated,checkoutToken:Mt((se=this.cart)==null?void 0:se.id),instrumentId:this.name}):await this.removePersonalData(),U({checkoutUrl:z.redirectUrl,instrumentName:this.name,reason:z.reason,stage:"onPaymentAuthorized::submitForCompletion"})}catch(Me){this.terminateSession({error:Me,afterAuthorization:!0})}break}default:this.terminateSession({error:new Error("[".concat(this.name,"] completion action not handled: ").concat(z.action)),afterAuthorization:!0})}},{token:f,billingContact:v,shippingContact:_}=u.payment;let A=null,k=null;try{if(!v){await this.completePayment(ApplePaySession.STATUS_FAILURE);return}if(A=Rt({...v,phoneNumber:_==null?void 0:_.phoneNumber},!1),this.isShippingRequired){if(!_){await this.completePayment(ApplePaySession.STATUS_FAILURE);return}k=Rt(_,this.shouldPadPostalCode)}}catch(z){this.terminateSession({error:z,afterAuthorization:!0});return}const E=async()=>{var z,S;try{const G=this.isShippingRequired?{validateAddress:!0,streetAddress:k}:{},se=(z=this.customerAccountEmail)!=null?z:_==null?void 0:_.emailAddress,Me=await je({cartId:this.cart.id,emailAddress:se,cartClient:this.apiClient,instrumentName:this.name,...G});mt({result:Me,instrument:this.name});const pa=jt({currentCart:Me.data,previousCart:this.cart});if(j.enabled(Re)&&Me.data&&pa!=="inc"&&(this.cart=Me.data),j.enabled(Re)&&pa==="inc"&&(Me.decelerationReason||(Me.decelerationReason="price_increased")),await this.decelerateOrAbort({result:Me,stage:"onPaymentAuthorized::updateBuyerIdentity"}))return;const qh=this.paymentSheetActionGenerator.mapMutationResultToPaymentSheetAction({result:Me,context:{shippingRequired:this.isShippingRequired,shippingCountryCode:k==null?void 0:k.country,billingCountryCode:A==null?void 0:A.country},checkoutUrl:this.cart.checkoutUrl,requestType:"onPaymentAuthorized::updateBuyerIdentity"});(S=qh.effects)==null||S.forEach(ko=>ko()),await this.handlePaymentSheetAction({paymentSheetAction:qh,onProceed:async ko=>{ko&&ko.length>0?await this.completePayment(ApplePaySession.STATUS_FAILURE,ko):await rt()},afterAuthorization:!0,stage:"onPaymentAuthorized::updateBuyerIdentity"})}catch(G){this.terminateSession({error:G,afterAuthorization:!0})}},rt=async()=>{var z,S;try{const G=this.cart.lineItems.some(pa=>!!pa.sellingPlanAllocation),se=await rn({cartId:this.cart.id,totalAmount:this.cart.totalAmount,paymentMethod:{walletPaymentMethod:{applePayWalletContent:{billingAddress:A,data:f.paymentData.data,header:f.paymentData.header,lastDigits:f.paymentMethod.displayName.split(" ")[1],signature:f.paymentData.signature,version:f.paymentData.version}}},canUsePaymentMethodForFreeOrder:!1,billingAddress:A,cartClient:this.apiClient,instrumentName:this.name,hasSellingPlan:G,abortSignal:(z=this.abortController)==null?void 0:z.signal});if(mt({result:se,instrument:this.name}),await this.decelerateOrAbort({result:se,stage:"onPaymentAuthorized::updatePayment"}))return;const Me=this.paymentSheetActionGenerator.mapMutationResultToPaymentSheetAction({result:se,context:{shippingRequired:this.isShippingRequired,shippingCountryCode:k==null?void 0:k.country,billingCountryCode:A==null?void 0:A.country},checkoutUrl:this.cart.checkoutUrl,requestType:"onPaymentAuthorized::updatePayment"});(S=Me.effects)==null||S.forEach(pa=>pa()),await this.handlePaymentSheetAction({paymentSheetAction:Me,onProceed:async pa=>{pa&&pa.length>0?await this.completePayment(ApplePaySession.STATUS_FAILURE,pa):await $()},afterAuthorization:!0,stage:"onPaymentAuthorized::updatePayment"})}catch(G){this.terminateSession({error:G,afterAuthorization:!0})}},$=async()=>{var z;try{const S=await yo({cartId:this.cart.id,token:f.transactionIdentifier,cartClient:this.apiClient,instrumentName:this.name});mt({result:S,instrument:this.name}),(z=S.errors)!=null&&z.some(se=>se.code==="ERROR")&&(b.leaveBreadcrumb("ApplePay Generic ERROR encountered during completion",{errorCodes:S.errors},"error"),p.log({body:"[ApplePay] Generic ERROR code encountered during completion",attributes:{errorCodes:S.errors}}));const G=this.paymentSheetActionGenerator.mapCompletionResultToPaymentSheetAction({result:S,context:{shippingRequired:this.isShippingRequired,shippingCountryCode:k==null?void 0:k.country,billingCountryCode:A==null?void 0:A.country},checkoutUrl:S.data&&"checkoutUrl"in S.data&&S.data.checkoutUrl?S.data.checkoutUrl:this.cart.checkoutUrl});await g(G)}catch(S){this.terminateSession({error:S,afterAuthorization:!0})}};await E()}),d(this,"terminateSession",async({error:u,afterAuthorization:m=!1}={})=>{var h;try{this.button.disabled=!1,u&&b.notify(u),m?p.authorizationComplete({instrument:this.name,measurement:Q(M.AuthorizationLatency,this.name),result:"failed"}):(Q(M.SheetLoad,this.name),p.sheetFailed(this.name,u)),b.leaveBreadcrumb("ApplePay Session abort",{afterAuthorization:m},"log");try{this.withActiveSession("abort",()=>this.session.abort()),(h=this.abortController)==null||h.abort("[Apple Pay] Payment sheet terminated")}catch(g){}if(u){const g=this.i18n.translate("brand.apple_pay");ie(g,this.i18n)}}finally{await this.removePersonalData()}}),d(this,"getMostRecentNonNullCart",(u,m)=>u?(this.cart=u,u):m),d(this,"handleNullCart",u=>{if(!u)throw new Error("[".concat(this.name,"] no cart returned on mutation, aborting"))}),d(this,"completeShippingContactSelection",(u,m)=>{try{const h=this.getMostRecentNonNullCart(u,this.cart),{newTotal:g,newLineItems:f}=this.getNewTotalAndLineItems(h),v=kn(h.deliveryGroups,this.i18n);b.leaveBreadcrumb("ApplePay Session completeShippingContactSelection",{errors:m,newTotal:g,newLineItems:f,newShippingMethods:v},"log"),this.withActiveSession("completeShippingContactSelection",()=>this.session.completeShippingContactSelection({errors:m!=null?m:[],newTotal:g,newLineItems:f,newShippingMethods:v}))}catch(h){this.terminateSession({error:h})}}),d(this,"completeShippingMethodSelection",u=>{try{this.handleNullCart(u),this.cart=u;const{newTotal:m,newLineItems:h}=this.getNewTotalAndLineItems(u);b.leaveBreadcrumb("ApplePay Session completeShippingContactSelection",{newTotal:m,newLineItems:h},"log"),this.withActiveSession("completeShippingMethodSelection",()=>this.session.completeShippingMethodSelection({newTotal:m,newLineItems:h}))}catch(m){this.terminateSession({error:m})}}),d(this,"sessionIsCancelled",()=>this.cancelled),this.accessToken=e,this.buyerCountry=t,this.button=a,this.cart=null,this.apiClient=l,this.shouldPadPostalCode=j.enabled(Re),this.dataSource=s,this.i18n=o,this.merchantName=i,this.cancelled=!1,this.buyerCurrency=n,this.customerAccountEmail=c.customerAccountEmail,this.walletParams=c;try{this.session=new ApplePaySession(ma,dd({shippingRequired:this.isShippingRequired,walletParams:c,buyerCurrency:n}))}catch(u){throw new hd(String(u),{cause:u})}this.session.onvalidatemerchant=this.onvalidatemerchant,this.session.onshippingcontactselected=this.onshippingcontactselected,this.session.onshippingmethodselected=this.onshippingmethodselected,this.session.onpaymentmethodselected=this.onpaymentmethodselected,this.session.oncancel=this.oncancel,this.session.onpaymentauthorized=this.onpaymentauthorized,this.paymentSheetActionGenerator=new cd(o)}begin(){b.leaveBreadcrumb("ApplePay Session begin",{shippingRequired:this.isShippingRequired,buyerCurrency:this.buyerCurrency,walletParams:this.walletParams},"log"),this.abortController=ke("AbortController"),this.session.begin()}handleShippingMethodNotFoundInCart(e){var t,n;const a=kn((n=(t=this.cart)==null?void 0:t.deliveryGroups)!=null?n:[],this.i18n);b.leaveBreadcrumb("ApplePay Session selected shipping method(s) not found in current cart, updating payment sheet",{attemptedDeliveryOptionHandles:e,currentShippingMethods:a},"log"),this.completeShippingMethodSelection(this.cart)}async applyPaymentSheetActions({result:e,onProceed:t,context:n,checkoutUrl:a,requestType:o,afterAuthorization:i}){var s;const l=this.paymentSheetActionGenerator.mapMutationResultToPaymentSheetAction({result:e,context:n,checkoutUrl:a,requestType:o});(s=l.effects)==null||s.forEach(c=>c()),!this.sessionIsCancelled()&&await this.handlePaymentSheetAction({paymentSheetAction:l,onProceed:t,afterAuthorization:i,stage:o})}async getMerchantSession(e){const t=await new sr({accessToken:this.accessToken,country:this.buyerCountry,locale:this.i18n.locale,apiVersion:"unstable"}).applePaySessionCreate(e);return JSON.parse(t)}abortPaymentSheetAndShowError(){b.leaveBreadcrumb("ApplePay Session abort",{},"log"),this.withActiveSession("abort",()=>this.session.abort()),this.button.disabled=!1,this.emitPaymentCompleteTelemetry(ApplePaySession.STATUS_FAILURE)}abortPaymentSheetAndShowOutOfStockModal(){b.leaveBreadcrumb("ApplePay Session abort",{},"log"),this.withActiveSession("abort",()=>this.session.abort()),this.button.disabled=!1,be(this.i18n),this.emitPaymentCompleteTelemetry(ApplePaySession.STATUS_FAILURE)}emitPaymentCompleteTelemetry(e){p.authorizationComplete({instrument:this.name,measurement:Q(M.AuthorizationLatency,this.name),result:e===ApplePaySession.STATUS_SUCCESS?"success":"failed"})}async completePayment(e,t=void 0){b.leaveBreadcrumb("ApplePay Session completePayment",{status:e,errors:t},"log");const n=this.withActiveSession("completePayment",()=>{this.session.completePayment({status:e,errors:t})});this.emitPaymentCompleteTelemetry(e),n===void 0&&e===ApplePaySession.STATUS_SUCCESS&&p.paymentCompletedAfterAbort({instrument:this.name,error:"Session already terminated"})}getNewTotalAndLineItems(e){return{newTotal:od(this.merchantName,e.totalAmount),newLineItems:id({subtotal:to(e),discountAllocations:ud(e),deliveryGroups:e.deliveryGroups,duties:e.totalDutyAmount,taxes:e.totalTaxAmount,i18n:this.i18n,formattedRecurringTotals:pd(this.cart.lineItems,this.i18n),lineItems:j.enabled(xa)?e.lineItems:[]})}}async decelerateOrAbort({result:e,stage:t}){return e.abortReason==="out_of_stock"?(p.sheetClicked({instrument:this.name,result:"rejected",reason:"out_of_stock"}),this.abortPaymentSheetAndShowOutOfStockModal(),!0):this.decelerateIfNeeded({result:e,stage:t})}async decelerateIfNeeded({result:e,stage:t}){if(!e.data)return!1;const{checkoutUrl:n,totalAmount:a}=e.data;let o;if(e.decelerationReason&&Vn.includes(e.decelerationReason)?o=e.decelerationReason:Jr({currentCartTotal:a,initialBuyerCurrency:this.buyerCurrency})&&(o="currency_changed"),o){p.sheetClicked({instrument:this.name,result:"success",reason:"deceleration"});try{await this.terminateSession()}finally{U({checkoutUrl:n,instrumentName:this.name,reason:o,stage:t})}return!0}return!1}get isShippingRequired(){return this.button.isShippingRequired}async removePersonalData(){this.isPersonalDataCleared||!this.cart||(await this.apiClient.cartRemovePersonalData({cartId:this.cart.id,instrumentName:this.name}),this.isPersonalDataCleared=!0)}onSheetLoaded(){if(this.isSheetLoaded)return;this.isSheetLoaded=!0;const e=Q(M.SheetLoad,this.name);e&&(H({event:B.SheetLoaded,ttl:e}),p.sheetLoaded({instrument:this.name,measurement:e}))}withActiveSession(e,t){var n,a;if((a=(n=this.abortController)==null?void 0:n.signal)!=null&&a.aborted){p.walletSessionAbortError({instrument:this.name,errorName:"SessionAlreadyTerminated",methodName:e});return}try{return t()}catch(o){if(o instanceof Error&&o.name==="InvalidAccessError"){p.walletSessionAbortError({instrument:this.name,errorName:"InvalidAccessError",methodName:e});return}throw o}}async handlePaymentSheetAction({paymentSheetAction:e,onProceed:t,afterAuthorization:n,stage:a}){switch(e.action){case"abort":this.terminateSession({afterAuthorization:n});break;case"show_error":await t(e.errors);break;case"update":await t(e.errors);break;case"decelerate":try{await this.terminateSession({afterAuthorization:n})}finally{U({instrumentName:this.name,checkoutUrl:e.redirectUrl,reason:e.reason,stage:a})}break;default:throw new Error('Missing handler for payment sheet action "'.concat(e.action,'"'))}}}function mu(){return j.enabled(Qs)}function nn({translate:r,logoElement:e,setAriaHidden:t,translationKey:n="buy_with_button_content"}){const a=document.createElement("div");return r(n,{wallet:"LOGO_PLACEHOLDER"}).split(new RegExp("(LOGO_PLACEHOLDER)")).filter(Boolean).forEach(o=>{let i;o==="LOGO_PLACEHOLDER"?i=e:(i=document.createElement("span"),i.innerText=o,t&&i.setAttribute("aria-hidden","true")),a.appendChild(i)}),a}const Qt=new Map;function gu({instrumentName:r,logoType:e="LIGHT",logoContent:t}){const n=Qt.get(r)||{};n[e]||(n[e]=t,Qt.set(r,n))}function wt({instrumentName:r,logoType:e="LIGHT"}){var t;const n=(t=Qt.get(r))==null?void 0:t[e];if(!n)throw new Error("".concat(r," ").concat(e," logo not loaded"));return n}class yu extends Ee{constructor(){super(...arguments),d(this,"name",y.ApplePay),d(this,"button",null)}static get observedAttributes(){return["disabled"]}get merchantName(){return this.walletParams.merchantName}connectedCallback(){this.cleanupOnFailure(this.render.bind(this),this.name)}attributeChangedCallback(e,t,n){super.attributeChangedCallback(e,t,n,this.button)}async handleClick(e){if(e.preventDefault(),this.disabled||!this.button||this.button.hasAttribute("aria-disabled"))return;this.disabled=!0;const[t,n,a]=await Promise.all([this.i18n,this.dataSource,this.apiClient]);et(M.SheetLoad,this.name);let o;try{if(o=new pu({accessToken:this.accessToken,buyerCountry:this.buyerCountry,buyerCurrency:this.buyerCurrency,button:this,i18n:t,merchantName:this.merchantName,dataSource:n,apiClient:a,walletParams:this.walletParams}),!o)throw new Error("missing ApplePaySession");o.begin()}catch(i){b.leaveBreadcrumb("Failed to create ApplePay Session",{error:i},"error"),o||(p.sheetClicked({instrument:this.name,result:"failed",reason:"unhandled_error"}),p.log({body:"Unhandled error detected in Apple Pay session creation",attributes:{error:String(i),location:"handleClick"}})),o==null||o.terminateSession(),ie(t.translate("brand.apple_pay"),t),this.disabled=!1}}async render(){var e;const t=this.getOrCreateShadowRoot(),{translate:n}=await this.i18n,a=wt({instrumentName:y.ApplePay}),o=new DOMParser().parseFromString(a,"image/svg+xml").documentElement;if(!this.button){const i=this.isCTA?n("buy_with_button_content",{wallet:n("brand.apple_pay")}):n("brand.apple_pay");if(this.button=ar({label:i}),this.button.onclick=s=>this.handleClick(s),this.button.classList.add("apple-pay-button",Ko[this.buttonTheme],Oe.BUTTON),this.isCTA){const s=nn({translate:n,logoElement:o,setAriaHidden:!0});s.classList.add("apple-pay--content"),this.button.appendChild(s)}else this.button.appendChild(o);this.initializeShadowStyles(t,Wc),t.appendChild(this.button),this.ensureLightDOMIsNotEmpty(),(e=this.onRendered)==null||e.call(this)}this.disabled&&(this.button.setAttribute("disabled",""),this.button.setAttribute("aria-disabled","true"))}}function an(r){return function(e,t,n){const a=n.value;return n.value=function(...o){const i=a.apply(this,o);return i.eligible||console.debug("[DEBUG] ".concat(r," could not be rendered. Reason: ").concat(i.reason)),i},n}}async function Ze({svg:r,instrumentName:e,logoType:t="LIGHT"}){var n;if((n=Qt.get(e))!=null&&n[t])return;let a,o,i;try{if(i=fu(r),a=await fetch(i,{headers:{Accept:"image/svg+xml"}}),!a.ok)throw new Error("Failed to fetch SVG: ".concat(a.status," ").concat(a.statusText));if(o=await a.text(),!o||!o.includes("<svg"))throw new Error("Invalid SVG content received");gu({instrumentName:e,logoType:t,logoContent:o})}catch(s){const l=s instanceof Error?s.message:String(s);throw b.leaveBreadcrumb("SVG fetch failed",{error:l,responseStatus:a==null?void 0:a.status,responseHeaders:a==null?void 0:a.headers,responseBody:o==null?void 0:o.slice(0,100),assetUrl:i}),new Z("SVG fetch failed",{cause:l})}}function fu(r){const e=new URL(import.meta.url);return new URL("assets/".concat(r),e).href}var bu=Object.defineProperty,wu=Object.getOwnPropertyDescriptor,bo=(r,e,t,n)=>{for(var a=wu(e,t),o=r.length-1,i;o>=0;o--)(i=r[o])&&(a=i(e,t,a)||a);return a&&bu(e,t,a),a};class on extends Ce{constructor(e){super(e),d(this,"companyFieldRequired"),this.companyFieldRequired=!!this.walletParams.companyRequired}static walletName(){return"apple_pay"}getWebComponentName(){return"shopify-apple-pay-button"}getWebComponentClass(){return yu}getInstrumentName(){return y.ApplePay}getLoadEligibility(){return this.isInIframe()?{eligible:!1,reason:"cannot be loaded in an iframe"}:{eligible:!0}}getPartnerSDKEligibility(){var e,t,n,a;if(typeof window>"u"||window.ApplePaySession===void 0)return{eligible:!1,reason:"window or ApplePaySession is undefined"};try{if(!((t=(e=window.ApplePaySession).supportsVersion)!=null&&t.call(e,ma)))return{eligible:!1,reason:"SDK does not meet minimum version requirement"};if(!((a=(n=window.ApplePaySession).canMakePayments)!=null&&a.call(n)))return{eligible:!1,reason:"failed SDK eligibility check"}}catch(o){return{eligible:!1,reason:"error in SDK eligibility checks"}}return{eligible:!0}}async loadWalletSDK(){await this.loadAppleLogo()}async loadAppleLogo(){await Ze({svg:"apple-pay-logo.svg",instrumentName:y.ApplePay})}}bo([an("Apple Pay")],on.prototype,"getLoadEligibility"),bo([an("Apple Pay")],on.prototype,"getPartnerSDKEligibility");const _u=".buy-with-prime-button{width:100%;height:100%;padding:12px 10px 8px;display:flex;align-items:center;justify-content:center;gap:5px;opacity:1;border-width:0px}.buy-with-prime-button:hover:enabled{background-color:#0684eb!important}.buy-with-prime-button:focus{box-shadow:0 0 0 2px #1a98ff,inset 0 0 0 2px rgb(var(--color-background))!important;outline:none!important}.buy-with-prime-button:active,.buy-with-prime-button:hover:enabled:active{background-color:#0066cd!important;box-shadow:none!important}.buy-with-prime-button>svg{min-width:85px}";class Jt extends Error{constructor(){super(...arguments),d(this,"name","MissingAccessTokenError")}}class sn extends Error{constructor(){super(...arguments),d(this,"name","FetchingWalletsPlatformConfigError")}}class ln extends Error{constructor(){super(...arguments),d(this,"name","EmptyLineItemsWalletsPlatformConfigError")}}async function wo({configOptionsEndpoint:r,checkoutUrl:e,sourceId:t,accessToken:n,instrument:a}){try{const o=JSON.stringify({checkout_url:e,checkout_cancel_url:window.location.href,cart_id:t}),i=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json","X-Shopify-Storefront-Access-Token":n},body:o});if(i.ok)return i.json();const s=await i.json();throw s.error?new Error(s.error):new Error("Could not fetch wallets platform configs: [".concat(i.status,"] ").concat(i.statusText))}catch(o){const{message:i}=o!=null?o:{};switch(i){case"empty_line_items":throw new ln("[Fetch Pay Config][".concat(a,"] No eligible line items provided in the config request."));default:throw new sn("[Fetch Pay Config][".concat(a,"] ").concat(i))}}}const Au={[R.Checkout]:"Checkout",[R.CartAjax]:"Cart",[R.CartPage]:"Cart",[R.ProductPage]:"Product",[R.Unknown]:"Product"},$e=class Kh extends Ee{constructor(){super(...arguments),d(this,"name",y.BuyWithPrime),d(this,"button",null),d(this,"apiClientId","")}connectedCallback(){this.cleanupOnFailure(this.render.bind(this),this.name),this.handleOnSendCheckoutAction=this.handleOnSendCheckoutAction.bind(this)}async createButton(){const{translate:e}=await this.i18n,t=ar({label:e("brand.buy_with_prime")});return t.type="button",t.className="buy-with-prime-button",this.applyEnabledStyles(t),t}applyEnabledStyles(e){const t=wt({instrumentName:y.BuyWithPrime});e.innerHTML=t,e.disabled=!1,ht(e,{"background-color":"#1A98FF",color:"#FFFFFF",cursor:"pointer"})}applyDisabledStyles(e){const t=wt({instrumentName:y.BuyWithPrime,logoType:"DARK"});e.innerHTML=t,e.disabled=!0,ht(e,{"background-color":"#C0E3FF",color:"#7292AC",cursor:"not-allowed"})}async handleClick(){var e,t,n;if(!this.button)return;const[a,o]=await Promise.all([this.i18n,this.dataSource]);let i;try{this.applyDisabledStyles(this.button);let s=this.walletParams;if(this.apiClientId=this.apiClientId||s.appId||"",i=this.apiClientId?{apiClientId:this.apiClientId,pageType:this.pageType}:void 0,!s.createCheckoutSessionConfig){const{cart:u,decelerationReason:m,customValidationError:h,unrecoverableError:g}=await Ae({element:this,instrumentName:this.name,dataSource:o});if(g){p.sheetClicked({instrument:this.name,result:"rejected",reason:"unrecoverable_error",webPixelMetaData:i}),xe(a,g);return}if(h){p.sheetClicked({instrument:this.name,result:"rejected",reason:"custom_validation_error",webPixelMetaData:i}),Le(a,h.message);return}if(m){p.sheetClicked({instrument:this.name,result:"success",reason:"deceleration",webPixelMetaData:i}),U({checkoutUrl:(e=u==null?void 0:u.checkoutUrl)!=null?e:"",instrumentName:this.name,reason:m});return}if(!this.accessToken)throw new Jt("[Fetch Pay Config] could not fetch pay configs since required accessToken is missing.");s={...await wo({configOptionsEndpoint:Kh.OPTIMUS_CONFIG_REST_API_URL,checkoutUrl:(t=u==null?void 0:u.checkoutUrl)!=null?t:"",sourceId:(n=Gr(u))!=null?n:"",accessToken:this.accessToken,instrument:this.name})}}s.placement=this.getPlacement();const l=this.extractSKUs(s);i&&l&&(i.skus=l),delete s.checkoutSupportsSplitCart,delete s.appId;const c=s;this.pciEnabled&&(c.onSendCheckoutAction=this.handleOnSendCheckoutAction),window.amazon.buywithprime.initCheckout({amazonPayOptions:c}),p.sheetClicked({instrument:this.name,result:"success",webPixelMetaData:i})}catch(s){i&&(i.skus=i.skus||[]),Kh.EXPECTED_ERRORS.some(u=>s instanceof u)?p.sheetClicked({instrument:this.name,result:"rejected",reason:"expected_error",webPixelMetaData:i}):(p.sheetClicked({instrument:this.name,result:"failed",reason:"unhandled_error",webPixelMetaData:i}),p.log({body:"Unhandled error detected in Buy with Prime sheet clicked",attributes:{error:String(s),location:"handleClick"}}),b.notify(s));const{name:l}=s!=null?s:{name:"unknown"},{translate:c}=a;vt(c("error_dialogs.wallet.title",{wallet:c("brand.buy_with_prime")}),this.getModalContent(l,c))}finally{this.applyEnabledStyles(this.button)}}getModalContent(e,t){return e==="EmptyLineItemsWalletsPlatformConfigError"?t("error_dialogs.wallet.eligibility_error",{wallet:t("brand.buy_with_prime")}):t("error_dialogs.wallet.generic_error",{wallet:t("brand.buy_with_prime")})}extractSKUs(e){var t;return(t=e.createCheckoutSessionConfig)!=null&&t.payloadJSON?JSON.parse(e.createCheckoutSessionConfig.payloadJSON).cartDetails.lineItems.map(n=>n&&n.sku).filter(n=>n):[]}getPlacement(){return this.pageType&&Au[this.pageType]||"Other"}async render(){var e;const t=this.getOrCreateShadowRoot();this.button||(this.button=await this.createButton(),this.button.onclick=()=>this.handleClick(),this.button.classList.add("buy-with-prime-button"),this.getPlacement().includes("Checkout")||this.button.classList.add(Oe.BUTTON),await this.initializeShadowStyles(t,_u),t.appendChild(this.button),(e=this.onRendered)==null||e.call(this))}buildBwpEventData(e){const t={};return e.createCheckoutSessionConfig&&(t.skus=this.extractSKUs(e),t.apiClientId=this.apiClientId),t}async handleOnSendCheckoutAction(e){const{eventName:t,redirect:n,redirectUrl:a,requestPayload:o}=e;if(n&&a){this.dispatchWalletEvent({eventName:"wallet-redirect",detail:{redirectUrl:a,requestPayload:o}});return}switch(t){case"initCheckout":{const i=this.walletParams;this.dispatchWalletEvent({eventName:"wallet-clicked",detail:{bwpEventData:this.buildBwpEventData(i)}});break}case"initChange":this.dispatchWalletEvent({eventName:"wallet-clicked"});break;case"cancelCheckout":this.dispatchWalletEvent({eventName:"wallet-cancel"});break}}};d($e,"OPTIMUS_CONFIG_REST_API_URL","".concat(window.location.origin,"/wallets/config/optimus")),d($e,"EXPECTED_ERRORS",[sn,Jt,ln]);let Rr=$e;async function _o({fn:r,maxRetries:e=3,delay:t=1e3,retryPolicyFn:n=()=>!0,onFinishedFn:a=()=>{}}){const o=()=>new Promise(l=>{setTimeout(l,t)});let i=0;const s=async()=>{try{return await r()}catch(l){if(i++,i<e&&n(l))return await o(),s();throw l}};try{return await s()}finally{a(i)}}async function Eu(r){return new Promise((e,t)=>{if(document.querySelector('script[src="'.concat(r,'"]'))&&window.amazon){e();return}const n=document.createElement("script");n.src=r,n.onload=()=>{window.amazon?e():t(new Error("Amazon SDK not present after loading"))},n.onerror=a=>{const o=a instanceof Event?a.type:String(a);t(new Z("Error loading Amazon SDK: ".concat(o)))},document.head.append(n)})}async function Ao({sdkUrl:r=Fr,maxRetries:e=3}){return _o({fn:()=>Eu(r),maxRetries:e,delay:200,retryPolicyFn:()=>!0,onFinishedFn:t=>{p.amazonPaySDKLoadRetries({retries:t})}})}const ze=class Qh extends Ce{static walletName(){return"buy_with_prime"}constructor(e){super(e)}getWebComponentName(){return"shopify-buy-with-prime-button"}getInstrumentName(){return y.BuyWithPrime}getWebComponentClass(){return Rr}async loadWalletSDK(){await Ao({sdkUrl:Qh.SDK_URL,maxRetries:Qh.MAX_RETRIES}),await this.loadLogos()}async loadLogos(){await Promise.all([this.loadPrimeLogo(),this.loadPrimeLogoDark()])}async loadPrimeLogo(){await Ze({svg:"prime-logo.svg",instrumentName:y.BuyWithPrime})}async loadPrimeLogoDark(){await Ze({svg:"prime-logo-dark.svg",instrumentName:y.BuyWithPrime,logoType:"DARK"})}};d(ze,"MAX_RETRIES",3),d(ze,"SDK_URL",Fr);let Dr=ze;const Cu="shopify-amazon-pay-button div[role=button][slot=amazon-pay-slot][data-testid=amazon-pay-button]{border-radius:0!important;width:100%!important}",Su=':host([page-type="cart_page"]) .accelerated-checkout-button{overflow:hidden;display:flex;justify-content:center}',jn="amazon-pay-slot";var At,Et,We,Y,le,Te;const He=class Jh extends Ee{constructor(){super(...arguments),d(this,"name",y.AmazonPay),d(this,"resizeObserver",null),V(this,At,0),V(this,Et,0),V(this,We,!1),V(this,Y,null),V(this,le,null),V(this,Te,null),d(this,"sdkButton",null)}connectedCallback(){this.resizeObserver=ke("ResizeObserver",()=>this.onResize()),this.cleanupOnFailure(this.render.bind(this),this.name)}async disconnectedCallback(){var e;this.innerHTML="",this.clearShadowRoot(),this.teardownAmazonButtonContainer(),(e=this.resizeObserver)==null||e.disconnect()}async handleClick(e){var t,n;const[a,o]=await Promise.all([this.i18n,this.dataSource]);try{const{cart:i,decelerationReason:s,customValidationError:l,unrecoverableError:c}=await Ae({element:this,instrumentName:this.name,dataSource:o});if(c){p.sheetClicked({instrument:this.name,result:"rejected",reason:"unrecoverable_error"}),xe(a,c);return}if(l){p.sheetClicked({instrument:this.name,result:"rejected",reason:"custom_validation_error"}),Le(a,l.message);return}if(s){p.sheetClicked({instrument:this.name,result:"success",reason:"deceleration"}),U({checkoutUrl:(t=i==null?void 0:i.checkoutUrl)!=null?t:"",instrumentName:this.name,reason:s});return}const{totalAmount:{amount:u},checkoutUrl:m}=i;let h=this.walletParams;if(!h.createCheckoutSessionConfig){if(!this.accessToken)throw new Jt("[Fetch Pay Config] could not fetch pay configs since required accessToken is missing.");h={...await wo({configOptionsEndpoint:Jh.CV2_CONFIG_REST_API_URL,checkoutUrl:m,sourceId:(n=Gr(i))!=null?n:"",accessToken:this.accessToken,instrument:this.name}),placement:this.pageType===R.ProductPage?"Product":"Cart"}}delete h.appId,e.initCheckout({...h,...Number(u)!==0&&{estimatedOrderAmount:{amount:u,currencyCode:this.buyerCurrency}}}),p.sheetClicked({instrument:this.name,result:"success"})}catch(i){Jh.EXPECTED_ERRORS.some(l=>i instanceof l)?p.sheetClicked({instrument:this.name,result:"rejected",reason:"expected_error"}):(p.sheetClicked({instrument:this.name,result:"failed",reason:"unhandled_error"}),p.log({body:"Unhandled error detected in Amazon Pay sheet clicked",attributes:{error:String(i),location:"handleClick"}}),b.notify(i));const s=a.translate("brand.amazon_pay");ie(s,a)}}createContainer({containerID:e,height:t}){const n=document.createElement("div");return n.id=e,n.style.display="flex",n.style.minWidth="140px",t!=null&&(n.style.height="".concat(t,"px")),n.slot=jn,n.setAttribute("data-testid","amazon-pay-button"),n}async onResize(){const e=Wt(P(this,Y))||0,t=Yt(P(this,Y))||0,n=P(this,At)!==e||P(this,Et)!==t;!P(this,We)&&n&&(this.teardownAmazonButtonContainer(),await this.cleanupOnFailure(()=>this.renderFromAmazonSDK(),this.name))}async render(){var e;const t=this.getOrCreateShadowRoot();try{const n=document.createElement("slot");n.name=jn;const a=document.createElement("style");a.textContent=Cu,this.appendChild(a),await this.initializeShadowStyles(t,Su);const o=await this.containerInstanceNumber;F(this,le,"AcceleratedCheckoutAmazonPayButtonContainer".concat(this.pageType).concat(o)),F(this,Y,document.createElement("div")),P(this,Y).classList.add(Oe.BUTTON),P(this,Y).appendChild(n),t.appendChild(P(this,Y)),(e=this.resizeObserver)==null||e.observe(P(this,Y)),await this.renderFromAmazonSDK()}catch(n){b.notify(n)}}async renderFromAmazonSDK(){var e;F(this,We,!0);const t=Yt(P(this,Y))||0;F(this,Te,this.createContainer({containerID:P(this,le),height:t})),this.appendChild(P(this,Te));const n=Wt(P(this,Y))||0,a={buttonBorderRadius:"".concat(n,"px")};let o=!1;try{if(this.sdkButton=window.amazon.Pay.renderButton("#".concat(P(this,le)),{...this.walletParams,style:a,placement:this.pageType===R.ProductPage?"Product":"Cart"}),this.sdkButton){const i=this.sdkButton;this.sdkButton.onClick(()=>this.handleClick(i))}else p.log({body:"Amazon Pay Button rendered null SDK button",attributes:{pageType:this.pageType,containerID:P(this,le)}});F(this,Et,t),F(this,At,n),p.renderSucceeded(this.name),o=!0}catch(i){p.renderFailed(this.name);const s="Amazon Pay Button not able to render into container #".concat(P(this,le),".");console.error(s),p.log({body:s,attributes:{pageType:this.pageType,containerID:P(this,le),error:i==null?void 0:i.toString()}})}finally{F(this,We,!1)}o&&((e=this.onRendered)==null||e.call(this))}teardownAmazonButtonContainer(){var e;(e=P(this,Te))==null||e.remove(),F(this,Te,null)}};At=new WeakMap,Et=new WeakMap,We=new WeakMap,Y=new WeakMap,le=new WeakMap,Te=new WeakMap,d(He,"CV2_CONFIG_REST_API_URL","".concat(window.location.origin,"/wallets/config/amazon_pay")),d(He,"EXPECTED_ERRORS",[sn,Jt,ln]);let kr=He;const Ge=class Xh extends Ce{static walletName(){return"amazon_pay"}constructor(e){super(e)}getWebComponentName(){return"shopify-amazon-pay-button"}getInstrumentName(){return y.AmazonPay}getWebComponentClass(){return kr}async loadWalletSDK(){await Ao({sdkUrl:Xh.SDK_URL,maxRetries:Xh.MAX_RETRIES})}getLoadEligibility(e){return e.getRootNode()instanceof ShadowRoot?{eligible:!1,reason:"Cannot load Amazon Pay within Shadow DOM"}:{eligible:!0}}};d(Ge,"MAX_RETRIES",3),d(Ge,"SDK_URL",Fr);let Or=Ge;var br={Purple:{D50:"#4524DB",P40:"#5433EB"},Grayscale:{L0:"#FFFFFF"}},Pu={16:16},qn="gravity-font-faces",Iu="\n@font-face {\n  font-family: 'GTStandard-M';\n  src: url('https://cdn.shopify.com/shop-assets/static_uploads/shoplift/GTStandard-MRegular.woff2')\n    format('woff2');\n  font-style: normal;\n  font-weight: 450;\n  font-display: fallback;\n}\n\n@font-face {\n  font-family: 'GTStandard-M';\n  src: url('https://cdn.shopify.com/shop-assets/static_uploads/shoplift/GTStandard-MMedium.woff2')\n    format('woff2');\n  font-style: normal;\n  font-weight: 500;\n  font-display: fallback;\n}\n\n@font-face {\n  font-family: 'GTStandard-M';\n  src: url('https://cdn.shopify.com/shop-assets/static_uploads/shoplift/GTStandard-MSemibold.woff2')\n    format('woff2');\n  font-style: normal;\n  font-weight: 600;\n  font-display: fallback;\n}",vu=class extends HTMLElement{static get observedAttributes(){return["disabled"]}connectedCallback(){this._loadFonts(),this._updateButton()}attributeChangedCallback(){this._updateButton()}_loadFonts(){if(document.querySelector('style[data-description="'.concat(qn,'"], style[data-description="shop-js-font-faces"]')))return;let r=document.createElement("style");r.dataset.description=qn,r.appendChild(document.createTextNode(Iu)),document.head.appendChild(r)}_updateButton(){var r;let e=this._getOrCreateShadowRoot();e.innerHTML=Nu,this.hasAttribute("disabled")&&((r=e.querySelector("button"))==null||r.setAttribute("disabled",""))}_getOrCreateShadowRoot(){return this.shadowRoot||this.attachShadow({mode:"open"}),this.shadowRoot}};function Tu(){window.customElements&&(customElements.get("gravity-button")||customElements.define("gravity-button",vu))}var Nu="\n<style>\n  * {\n    box-sizing: border-box;\n    border-width: 0;\n    border-style: solid;\n    border-color: currentColor;\n    --focused-box-shadow: 0 0 0 3px #DBD1FF, 0 0 #0000;\n  }\n\n  button {\n    text-transform: none;\n    -webkit-appearance: button;\n    background-color: transparent;\n    background-image: none;\n    font-family: GTStandard-M;\n    font-feature-settings: inherit;\n    font-variation-settings: inherit;\n    font-size: 100%;\n    font-weight: inherit;\n    line-height: inherit;\n    letter-spacing: inherit;\n    color: inherit;\n    margin: 0;\n    padding: 0;\n    cursor: pointer;\n  }\n\n  button:disabled {\n    cursor: default;\n    opacity: 0.5;\n  }\n\n  .gravity-button {\n    position: relative;\n    display: flex;\n    min-height: var(--gravity-button-min-height);\n    height: var(--gravity-button-height);\n    width: var(--gravity-button-width, 260px);\n    justify-content: center;\n    color: ".concat(br.Grayscale.L0,";\n    align-items: center;\n    overflow: visible;\n    padding: var(--gravity-button-padding, ").concat(Pu[16],"px 10px);\n    border-radius: var(--gravity-button-border-radius);\n    border: none;\n    background-color: ").concat(br.Purple.P40,";\n    transition: all;\n  }\n\n  .gravity-button:not([disabled]):focus-visible {\n    box-shadow: var(--focused-base-box-shadow, var(--focused-box-shadow));\n    outline: var(--focused-base-outline, 2px solid transparent);\n    outline-offset: var(--focused-base-outline-offset, 2px);\n  }\n\n  .gravity-button:not([disabled]):hover {\n    background-color: ").concat(br.Purple.D50,';\n  }\n</style>\n\n<button class="gravity-button">\n  <slot id="button-content"></slot>\n</button>\n');const Ru=".button-content{display:flex;align-items:center;justify-content:center;width:100%;height:100%;gap:3px;white-space:nowrap;container-type:inline-size;container-name:bc}.button-content>span{font-size:16px}.ShopPromise>.separator{margin:0 8px}@container bc (width <= 300px){.ShopPromise{display:none!important}}gravity-button{display:block}shop-pay-iframe-content{height:100%}.credit-card-iframe-container{position:relative;height:100%;left:0;width:0px;transition:width .35s cubic-bezier(.33,0,0,1) .2s;visibility:hidden;opacity:0}shop-pay-iframe-content,.credit-card-iframe-container>iframe.credit-card-iframe{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.credit-card-iframe-visible{width:72px;opacity:1;visibility:visible}.credit-card-iframe{position:absolute;top:0;left:0;object-position:left top;object-fit:none;height:100%;width:80px}",Du='.accelerated-checkout-button{height:clamp(25px,var(--shopify-accelerated-checkout-button-block-size, 44px),55px);min-height:clamp(25px,var(--shopify-accelerated-checkout-button-block-size, 44px),55px);border-radius:var(--shopify-accelerated-checkout-button-border-radius, 0px);box-shadow:var(--shopify-accelerated-checkout-button-box-shadow)}:host([page-type="cart_page"]) .accelerated-checkout-button{height:100%;width:100%;border-radius:var(--shopify-accelerated-checkout-button-border-radius, 4px);box-shadow:var(--shopify-accelerated-checkout-button-box-shadow)}:host([page-type="product"]) .accelerated-checkout-button{min-width:150px}@media (forced-colors: active){.accelerated-checkout-button{border:1px solid transparent!important}:host([page-type="cart_page"]) .accelerated-checkout-button{border:1px solid transparent!important}}.accelerated-checkout-button{--gravity-button-height: clamp(25px, var(--shopify-accelerated-checkout-button-block-size, 44px), 55px);--gravity-button-min-height: clamp(25px, var(--shopify-accelerated-checkout-button-block-size, 44px), 55px);--gravity-button-border-radius: var(--shopify-accelerated-checkout-button-border-radius, 0px);--gravity-button-padding: 0px 10px;--gravity-button-width: 100%}:host([page-type="cart_page"]) .accelerated-checkout-button{--gravity-button-height: 100%;--gravity-button-min-height: 100%;--gravity-button-border-radius: var(--shopify-accelerated-checkout-button-border-radius, 4px);--gravity-button-width: 100%}';class Eo extends Error{constructor(){const e="DeliveryEstimatesResponseIsNullError";super("deliveryEstimates is null or undefined"),this.name=e}}class wr extends Error{constructor(){const e="DeliveryPromiseAPIClientError";super("window.Shopify.ShopPromise.deliveryPromiseAPIClient is undefined"),this.name=e}}const ku=15,Ou=200;class Lu{constructor(e){d(this,"storefrontAPIToken"),this.storefrontAPIToken=e}async fetchDeliveryPromise({variant:e,postalCode:t,defaultPostalCode:n,sellingPlanId:a}){const o=await _o({fn:async()=>this.fetchDeliveryOptions(e,t,n,a),maxRetries:ku,delay:Ou,retryPolicyFn:i=>i instanceof wr}).catch(i=>{if(i instanceof wr)throw i;return null});if(!o)throw new Eo;return o}async fetchDeliveryOptions(e,t,n,a){var o,i;const s={variantId:e,sellingPlanId:a,postalCode:t||n,isPostalCodeOverride:!!t},l=(i=(o=window==null?void 0:window.Shopify)==null?void 0:o.ShopPromise)==null?void 0:i.deliveryPromiseAPIClient;if(!l)throw new wr;return l(s,this.storefrontAPIToken)}}function xu(r,e){switch(r){case 0:return(e==null?void 0:e.translate("shop_promise_delivery.same_day"))||null;case 1:return(e==null?void 0:e.translate("shop_promise_delivery.next_day"))||null;case 2:return(e==null?void 0:e.translate("shop_promise_delivery.two_day"))||null;default:return null}}const Mu="delivery_promise_default_address",Uu="delivery_promise_postal_code";class Bu extends Tt{constructor(){super(...arguments),d(this,"lastFetchedProductVariantId"),d(this,"lastFetchSellingPlan"),d(this,"fetching",!1),d(this,"i18n",null),d(this,"daysToDelivery"),d(this,"formObserver",null)}async connectedCallback(){this.formObserver=new tn(this,({variantId:e,sellingPlanId:t})=>{this.fetchDeliveryPromise(e,t)}),this.formObserver.setupMutationObservers()}setTranslations(e){this.i18n=e,this.render()}get postalCode(){try{return JSON.parse(yt(Uu)||"null")||null}catch(e){return null}}get defaultDeliveryAddress(){try{return JSON.parse(yt(Mu)||"null")}catch(e){return null}}async fetchDeliveryPromise(e,t){var n,a,o,i;if(!(!e||!this.accessToken)&&!(e===this.lastFetchedProductVariantId&&t===this.lastFetchSellingPlan))try{this.lastFetchedProductVariantId=e,this.lastFetchSellingPlan=t;const s=((n=this.defaultDeliveryAddress)==null?void 0:n.zip)||"",l=await new Lu(this.accessToken).fetchDeliveryPromise({variant:e,postalCode:this.postalCode||"",defaultPostalCode:s,sellingPlanId:t||""}),c=Ba(this),u=(o=(a=l==null?void 0:l.selectedShippingOption)==null?void 0:a.brandedPromise)==null?void 0:o.handle;if((c==null?void 0:c.sellingPlanId)!==t||(c==null?void 0:c.variantId)!==e||u!=="shop_promise")return;this.daysToDelivery=(i=l==null?void 0:l.selectedShippingOption)==null?void 0:i.maxCalendarDaysToDelivery,this.render()}catch(s){s instanceof Eo&&(this.daysToDelivery=null)}}render(){const e=xu(this.daysToDelivery,this.i18n);this.classList.add("ShopPromise"),this.innerHTML=e?'<span class="separator">|</span><span>'.concat(e,"</span>"):""}}function Fu({flow:r="default"}){const e=new URLSearchParams({target_origin:window.location.origin,flow:r});return"".concat(window.location.origin,"/services/login_with_shop/authorize?").concat(e.toString())}function $u(r,e,t){const n=t!=null?t:window.location.origin;if(r.origin!==n||!e)return!1;try{return r.source===e.contentWindow}catch(a){return!1}}class zu extends Tt{constructor(){super(...arguments),d(this,"_userRecognized"),d(this,"iframe",null),d(this,"iframeContainer",null),d(this,"iframeCreationStart",null),d(this,"iframeOrigin",null),d(this,"shopLogo",null),d(this,"iframeState","hidden"),d(this,"impressionTracked",!1),d(this,"pendingAnimation",!1),d(this,"handleMessage",e=>{var t;if($u(e,this.iframe,e.origin)&&((t=e.data)==null?void 0:t.type)==="loaded"&&(this.iframeOrigin!==e.origin&&(this.iframeOrigin=e.origin),e.data.type==="loaded")){const n=e.data.recognized===!0;if(this._userRecognized=n,this.iframeCreationStart){const a=oe()-this.iframeCreationStart,o={instrument:y.ShopPay,pageType:Hr()};I.histogram({name:N.ShopPayPersonalizedIframeLoadTime,value:a,attributes:o,unit:"ms"}),I.histogram({name:N.ShopPayPersonalizedIframeLoadTimeFromPageLoad,value:window.performance.now(),attributes:o,unit:"ms"})}if(n){this.handleRecognizedUser();return}this.handleUnrecognizedUser()}})}get userRecognized(){return this._userRecognized}async createIframe(){if(this.iframeContainer)return this.iframeContainer;const e=oe();return this.iframeCreationStart=e,this.iframeContainer=document.createElement("div"),this.iframeContainer.classList.add("credit-card-iframe-container"),this.iframeContainer.setAttribute("data-test-id","shop-pay-iframe-container"),this.iframe=document.createElement("iframe"),this.iframe.src=Fu({flow:"shop_pay_button"}),this.iframe.setAttribute("scrolling","no"),this.iframe.setAttribute("frameborder","no"),this.iframe.setAttribute("loading","lazy"),this.iframe.setAttribute("allowtransparency","true"),this.iframe.setAttribute("allowfullscreen","false"),this.iframe.classList.add("credit-card-iframe"),this.iframeContainer.appendChild(this.iframe),this.iframeContainer}async connectedCallback(){if(this.querySelector(".credit-card-iframe-container")){b.notify(new Error("[ShopPayPersonalizedIframe] Multiple iframe containers found"));return}const e=await this.createIframe();this.appendChild(e),this.setupMessageListener()}disconnectedCallback(){this.cleanup()}setShopLogo(e){this.shopLogo=e}setDisabled(e){this.disabled=e,e&&this.iframeState!=="personalized"&&this.hideIframe()}hasPersonalizationOccurred(){return this.iframeState==="personalized"}triggerAnimation(e){const t=this.style.display!=="none";if(!(this.disabled||this.iframeState==="personalized"||!t)){if(this.iframeState==="loaded"){this.trackButtonImpression();return}if(this.iframeState==="ready"){this.showIframe(e);return}this.pendingAnimation=!0}}stopPendingAnimation(){this.pendingAnimation=!1}resetToOriginalState(){var e;this.iframeState="hidden",this.pendingAnimation=!1,(e=this.iframeContainer)==null||e.classList.remove("credit-card-iframe-visible")}trackButtonImpression(){this.impressionTracked||(H({event:B.ShopPayButtonInView,instrumentId:y.ShopPay,eventSubtype:this.userRecognized?"personalized":"not_personalized"}),this.impressionTracked=!0)}setupMessageListener(){window.addEventListener("message",this.handleMessage)}handleRecognizedUser(){const e=this.iframeState==="hidden";e&&(this.iframeState="ready"),this.style.display!=="none"&&e&&!this.disabled&&this.pendingAnimation&&(this.pendingAnimation=!1,this.showIframe())}handleUnrecognizedUser(){this.iframeState="loaded",this.pendingAnimation&&this.trackButtonImpression(),this.cleanup()}animateIn(){this.disabled||!this.iframeContainer||this.iframeState!=="ready"||!this.shopLogo||(this.iframeContainer.classList.add("credit-card-iframe-visible"),this.sendMessageToIframe(),this.iframeState="personalized")}showIframe(e){if(this.trackButtonImpression(),!e){this.animateIn();return}const t=setTimeout(()=>{this.animateIn()},500);return()=>clearTimeout(t)}hideIframe(){var e;this.iframeState!=="hidden"&&this.iframeState!=="personalized"&&(this.iframeState="hidden",(e=this.iframeContainer)==null||e.classList.remove("credit-card-iframe-visible"))}cleanup(){var e;window.removeEventListener("message",this.handleMessage),(e=this.iframeContainer)==null||e.remove(),this.iframeContainer=null,this.iframe=null,this.iframeOrigin=null,this.shopLogo=null}sendMessageToIframe(){var e;if(!((e=this.iframe)!=null&&e.contentWindow)||!this.iframeOrigin)return;const t={timestamp:oe(),type:"animate-in"};this.iframe.contentWindow.postMessage(t,this.iframeOrigin)}}function Hu(r){const e=r.querySelector(".button-content span");if(!e)return 0;const t=window.getComputedStyle(e);return parseFloat(t.fontSize)}function Wn(){const r=window.TPOConfigs,e=window.optionizeSettings;return!!(r||e)}const Ot=220;class Gu{constructor({element:e,isCTA:t,onFormStateChange:n,personalized:a,shopPromiseEligible:o,shopPromiseProductPageContent:i}){d(this,"cachedFontSize",null),d(this,"cachedWidth",0),d(this,"element"),d(this,"formObserver",null),d(this,"formState",{disabled:!1,variantId:void 0}),d(this,"initialWidth",null),d(this,"isCTA"),d(this,"lockedNonPersonalized",!1),d(this,"onFormStateChange"),d(this,"pendingFormStateUpdate",null),d(this,"personalized"),d(this,"resizeObserver",null),d(this,"shopPromiseEligible"),d(this,"shopPromiseProductPageContent");var s;this.element=e,this.isCTA=t,this.onFormStateChange=n,this.personalized=a,this.shopPromiseEligible=o,this.shopPromiseProductPageContent=i,this.personalized&&(Wn()||(this.formObserver=new tn(this.element,({disabled:l,variantId:c})=>{this.formState={disabled:l,variantId:c},this.scheduleFormStateChange()}),this.formObserver.setupMutationObservers(),this.resizeObserver=ke("ResizeObserver",l=>this.handleResize(l)),(s=this.resizeObserver)==null||s.observe(this.element)))}cleanup(){var e,t,n;(t=(e=this.formObserver)==null?void 0:e.addToCartMutationObserver)==null||t.disconnect(),(n=this.resizeObserver)==null||n.disconnect(),this.pendingFormStateUpdate!==null&&(cancelAnimationFrame(this.pendingFormStateUpdate),this.pendingFormStateUpdate=null)}shouldRender(){if(!this.personalized||Wn())return!1;const e=this.cachedWidth;if(this.lockedNonPersonalized)return!1;const t=this.shopPromiseEligible&&this.shopPromiseProductPageContent,n=this.formState.disabled&&this.formState.variantId!==void 0;if(t||n||e<Ot)return!1;if(this.isCTA){const a=this.getFontSizeCached();if(a<10||a>18)return!1}return!0}getFontSizeCached(){return this.cachedFontSize!==null?this.cachedFontSize:(this.cachedFontSize=Hu(this.element),this.cachedFontSize)}scheduleFormStateChange(){this.pendingFormStateUpdate===null&&(this.pendingFormStateUpdate=requestAnimationFrame(()=>{var e;this.pendingFormStateUpdate=null,(e=this.onFormStateChange)==null||e.call(this)}))}get locked(){return this.lockedNonPersonalized}get soldOut(){return this.formState.disabled&&this.formState.variantId!==void 0}handleResize(e){var t,n;const a=(n=(t=e[0])==null?void 0:t.contentRect.width)!=null?n:0;if(this.cachedWidth=a,this.initialWidth===null&&a>0){this.initialWidth=a,this.initialWidth<Ot&&(this.lockedNonPersonalized=!0),this.scheduleFormStateChange();return}if(this.initialWidth!==null&&this.initialWidth>=Ot&&a>0&&a<Ot&&!this.lockedNonPersonalized){this.lockedNonPersonalized=!0,this.scheduleFormStateChange();return}this.scheduleFormStateChange()}}function Co(r){return r==="pay_with"||r==="control"}function Vu(r){return r==="pay_with"?"pay_with_button_content":"buy_with_button_content"}class ju extends Ee{constructor(){super(...arguments),d(this,"name",y.ShopPay),d(this,"button",null),d(this,"shopPromiseProductPageContent",null),d(this,"shopPromiseEligible",!1),d(this,"shopLogo",null),d(this,"buttonContentDiv",null),d(this,"iframeContent",null),d(this,"iframeRenderEligibility",null),d(this,"intersectionObserver",null),d(this,"inView",!1),d(this,"impressionTracked",!1)}static get observedAttributes(){return["disabled"]}connectedCallback(){this.shopPromiseEligible=Ra(),this.setupIntersectionObserver(),this.cleanupOnFailure(async()=>{Tu(),await this.render()},this.name)}disconnectedCallback(){var e,t;(e=this.intersectionObserver)==null||e.disconnect(),this.intersectionObserver=null,(t=this.iframeRenderEligibility)==null||t.cleanup(),this.iframeRenderEligibility=null}attributeChangedCallback(e,t,n){super.attributeChangedCallback(e,t,n,this.button),e==="disabled"&&this.onDisabledChanged(n)}setupIntersectionObserver(){var e,t;if("IntersectionObserver"in window){const n=((t=(e=this.button)==null?void 0:e.offsetHeight)!=null?t:46)*-1;this.intersectionObserver=new IntersectionObserver(a=>{a.forEach(o=>{var i;o.isIntersecting&&!this.inView&&(this.inView=!0,this.onButtonInView(!0),(i=this.intersectionObserver)==null||i.unobserve(this))})},{threshold:.1,rootMargin:"".concat(n,"px")}),this.intersectionObserver.observe(this)}else this.inView=!0,this.onButtonInView()}onButtonInView(e){var t;const n=(t=this.iframeRenderEligibility)==null?void 0:t.shouldRender();if(n&&this.iframeContent){this.iframeContent.triggerAnimation(e);return}if(n){this.createAndAttachIframe();return}this.impressionTracked||(H({event:B.ShopPayButtonInView,instrumentId:y.ShopPay,eventSubtype:"not_personalized"}),this.impressionTracked=!0)}onDisabledChanged(e){var t;(t=this.iframeContent)==null||t.setDisabled(e!==null)}async addButtonContent(){if(!this.button)return;let e;const t=await this.i18n,n=wt({instrumentName:y.ShopPay}),a=new DOMParser().parseFromString(n,"image/svg+xml").documentElement;if(this.shopLogo=a,this.isCTA){const s=this.getAttribute("button-text-variant"),l=Co(s)?s:null,c=Vu(l);l&&H({event:B.ShopPayButtonTextExperiment,instrumentId:y.ShopPay,eventSubtype:l}),e=nn({translate:t.translate,logoElement:a,setAriaHidden:!1,translationKey:c})}else e=document.createElement("div"),e.appendChild(a);e.classList.add("button-content"),this.shopPromiseEligible&&!this.shopPromiseProductPageContent&&(this.shopPromiseProductPageContent=document.createElement("shop-promise-product-page-content"),this.shopPromiseProductPageContent.setTranslations(t),this.shopPromiseProductPageContent.setAttribute("access-token",this.accessToken||""),e.appendChild(this.shopPromiseProductPageContent));const o=this.getAttribute("personalized")==="true",i=()=>{const s=this.iframeContent,l=this.iframeRenderEligibility,c=(l==null?void 0:l.shouldRender())||!1;if(!s){c&&this.createAndAttachIframe();return}if(!c){if(s.hasPersonalizationOccurred()&&l!=null&&l.soldOut&&!(l!=null&&l.locked)){s.style.display="";return}s.style.display="none",l!=null&&l.locked?s.resetToOriginalState():s.stopPendingAnimation();return}s.style.display="",this.inView&&s.triggerAnimation()};this.iframeRenderEligibility=new Gu({element:this.button,isCTA:this.isCTA,onFormStateChange:i,personalized:o,shopPromiseEligible:this.shopPromiseEligible,shopPromiseProductPageContent:this.shopPromiseProductPageContent}),this.buttonContentDiv=e,this.button.appendChild(e)}createAndAttachIframe(){!this.buttonContentDiv||this.iframeContent||(this.iframeContent=document.createElement("shop-pay-iframe-content"),this.iframeContent.setShopLogo(this.shopLogo),this.iframeContent.setDisabled(this.disabled),this.shopLogo.insertAdjacentElement("afterend",this.iframeContent),this.inView&&this.iframeContent.triggerAnimation())}handleIframeRenderLogic(){if(!this.iframeRenderEligibility)return;const e=this.iframeRenderEligibility.shouldRender();if(!this.iframeContent&&e){this.createAndAttachIframe();return}this.iframeContent&&(this.iframeContent.style.display=e?"":"none",e&&this.inView?this.iframeContent.triggerAnimation():e||this.iframeContent.stopPendingAnimation())}getShopPayBehavior(){return this.pageType===R.ProductPage?"force_shop_pay_product":this.pageType===R.CartPage?"force_shop_pay_cart":"force_shop_pay"}async handleClick(e){var t,n;if(e.preventDefault(),this.disabled||!this.button||this.button.getAttribute("disabled"))return;this.disabled=!0;const[a,o]=await Promise.all([this.i18n,this.dataSource]);try{const{decelerationReason:i,cart:s,customValidationError:l,unrecoverableError:c}=await Ae({element:this,instrumentName:y.ShopPay,dataSource:o});if(c){p.sheetClicked({instrument:this.name,result:"rejected",reason:"unrecoverable_error"}),p.log({body:"Unrecoverable error detected in Shop Pay Button click",attributes:{pageType:this.pageType,error:c}}),xe(a,c);return}if(l){p.log({body:"Custom validation error detected in Shop Pay Button click",attributes:{pageType:this.pageType,errorCode:l.code,errorMessage:l.message}}),p.sheetClicked({instrument:this.name,result:"rejected",reason:"custom_validation_error"}),Le(a,l.message);return}if(i){p.sheetClicked({instrument:this.name,result:"success",reason:"deceleration"}),U({checkoutUrl:(t=s==null?void 0:s.checkoutUrl)!=null?t:"",instrumentName:this.name,reason:i});return}p.sheetClicked({instrument:this.name,result:"success"}),we((n=s==null?void 0:s.checkoutUrl)!=null?n:"",this.getShopPayBehavior())}catch(i){b.notify(new qu("An error occurred when attempting to create a cart using the Shop Pay Button. Details: ".concat(i),{cause:i})),p.sheetClicked({instrument:this.name,result:"failed",reason:"unhandled_error"}),p.log({body:"Unhandled error detected in Shop Pay sheet clicked",attributes:{error:String(i),location:"handleClick"}}),Je(a)}}async render(){const e=this.getOrCreateShadowRoot();if(e.innerHTML)return;this.button||(this.button=document.createElement("gravity-button"));const t=document.createElement("style");t.innerHTML=[Du,Ru].join("\n"),e.appendChild(t),await this.addButtonContent(),this.disabled&&this.button.setAttribute("disabled",""),this.button.classList.add(Oe.BUTTON),this.button.onclick=n=>this.handleClick(n),e.appendChild(this.button),this.ensureLightDOMIsNotEmpty(),this.handleIframeRenderLogic(),this.onRendered()}}ce("shop-promise-product-page-content",Bu),ce("shop-pay-iframe-content",zu);class qu extends Error{constructor(){super(...arguments),d(this,"name","ShopPayButtonError")}}var Wu=Object.defineProperty,Yu=Object.getOwnPropertyDescriptor,Ku=(r,e,t,n)=>{for(var a=Yu(e,t),o=r.length-1,i;o>=0;o--)(i=r[o])&&(a=i(e,t,a)||a);return a&&Wu(e,t,a),a};class So extends Ce{static walletName(){return"shop_pay"}constructor(e){super(e)}getWebComponentName(){return"shop-pay-wallet-button"}getWebComponentClass(){return ju}getInstrumentName(){return y.ShopPay}async createWebComponent(e){var t,n;const a=await super.createWebComponent(e);(t=this.walletParams)!=null&&t.personalized&&a.setAttribute("personalized","true");const o=(n=this.walletParams)==null?void 0:n.buttonTextVariant;return Co(o)&&a.setAttribute("button-text-variant",o),a}async loadWalletSDK(){await this.loadLogo()}getLoadEligibility(){return{eligible:!0}}async loadLogo(){await Ze({svg:"shop-logo.svg",instrumentName:y.ShopPay})}}Ku([an("Shop Pay")],So.prototype,"getLoadEligibility");const Qu=".button{display:flex;justify-content:center;align-items:center;width:100%;border:none}.button:hover:not(:disabled){filter:brightness(92%);cursor:pointer}.button:disabled{opacity:.5;cursor:not-allowed}.button:focus-visible{box-shadow:inset 0 0 0 2px #1773b0,inset 0 0 0 3px #f8f8f8!important;outline:none}.logo-only>svg{width:50px}.dark{background:#000;color:#fff}.light{background:#fff;color:#000;outline:1px solid #3c4043}@media (forced-colors: active){.light{outline:none}}@media (prefers-contrast: high),(forced-colors: active){.button:focus-visible{outline:.2rem solid;outline-offset:.1rem}}.content{display:flex;justify-content:center;align-items:center;white-space:pre}";function _r({cart:r,i18n:e}){var t,n,a,o;const i=to(r),s={label:e.translate("order_summary.subtotal"),type:"SUBTOTAL",price:ye(i.amount)},l=Za({deliveryGroups:r.deliveryGroups,i18n:e}).map(f=>Ju({lineItem:f,type:"LINE_ITEM"})),c=Xu(r,e),u=Da(r.lineItems,(f,v)=>({label:f,type:"LINE_ITEM",price:v})),m=[...j.enabled(xa)?u:[],s,...l,...c];if(r.totalDutyAmount){const f={label:e.translate("order_summary.duties"),type:"LINE_ITEM",price:ye(r.totalDutyAmount.amount)};m.push(f)}if(r.totalTaxAmount){const f={label:e.translate("order_summary.taxes"),type:"TAX",price:ye(r.totalTaxAmount.amount)};m.push(f)}let h;try{const f=(o=(a=(n=(t=window.ShopifyAnalytics)==null?void 0:t.lib)==null?void 0:n.trekkie)==null?void 0:a.defaultAttributes)==null?void 0:o.microSessionId;h=f?"pw-".concat(f):void 0}catch(f){}const g={totalPrice:r.totalAmount.amount,currencyCode:r.totalAmount.currencyCode,totalPriceStatus:"ESTIMATED",totalPriceLabel:e.translate("order_summary.total"),displayItems:m};return h&&(g.transactionId=h),g}function Ju({lineItem:r,type:e,status:t="FINAL"}){return{label:r.label,type:e,price:r.amount,status:t}}function Xu(r,e){return[...r.lineItems.flatMap(t=>t.discountAllocations),...r.discountAllocations].flatMap(t=>{var n;const a=(n=t.title)!=null?n:t.code;return{label:a!=null?a:e.translate("order_summary.discount"),type:"LINE_ITEM",price:"-".concat(ye(Number(t.discountedAmount.amount)))}})}const Po=["PAYMENT_AUTHORIZATION"],Zu=Po.concat(["SHIPPING_ADDRESS","SHIPPING_OPTION"]),eh=["PAN_ONLY"];function th({walletParams:r,isShippingRequired:e,hasSellingPlan:t,i18n:n,buyerCurrency:a,authJwt:o}){var i,s,l,c;let u;try{const g=(c=(l=(s=(i=window.ShopifyAnalytics)==null?void 0:i.lib)==null?void 0:s.trekkie)==null?void 0:l.defaultAttributes)==null?void 0:c.microSessionId;u=g?"pw-".concat(g):void 0}catch(g){}const m={totalPrice:"0.01",currencyCode:a,totalPriceStatus:"ESTIMATED",totalPriceLabel:n.translate("order_summary.total"),displayItems:[{label:n.translate("order_summary.subtotal"),type:"SUBTOTAL",price:"0.01"}]};u&&(m.transactionId=u);const h={...r.paymentData,shippingAddressRequired:e,shippingOptionRequired:e,transactionInfo:m};return h.merchantInfo.authJwt=o,e||delete h.shippingAddressParameters,h.callbackIntents=e?Zu:Po,t&&rh(h),h}function rh(r){r.allowedPaymentMethods.forEach(e=>{e.parameters.allowedAuthMethods=e.parameters.allowedAuthMethods.filter(t=>eh.includes(t))})}class nh extends eo{constructor(e){super(),d(this,"brandName"),d(this,"completionResult"),this.i18n=e,this.brandName=this.i18n.translate("brand.google_pay"),this.completionResult=void 0}mapMutationResultToPaymentSheetAction({result:e,checkoutUrl:t,requestType:n}){const a=this.mapCustomValidationFunctionErrorToAction(e.errors);if(a)return a;const o=this.getErrorActions({checkoutUrl:t,requestType:n}),i=e.errors,s=this.getUnhandledErrors(i,o);s.forEach(c=>{b.notify(new Kt("[".concat(y.GooglePay,"] mutation result error not handled: ").concat(ge(c)),{groupingHash:"UnhandledActionError:".concat(y.GooglePay,":").concat(ge(c))}))});const{firstPaymentSheetAction:l}=this.getMergedPaymentSheetAction({result:e,errorActions:o});return l||(s.length>0?{action:"abort"}:{action:"update",errors:[]})}mapCompletionResultToPaymentSheetAction({result:e,checkoutUrl:t,requestType:n}){if(!e.data)throw new Sa(y.GooglePay);switch(this.completionResult=e,e.data.__typename){case"SubmitSuccess":return{action:"complete",redirectUrl:e.data.redirectUrl};case"SubmitAlreadyAccepted":case"SubmitThrottled":case"SubmitFailed":{const a=this.mapCustomValidationFunctionErrorToAction(e.errors);if(a)return a;const o=this.getErrorActions({checkoutUrl:t,requestType:n}),i=e.errors;this.getUnhandledErrors(i,o).forEach(l=>{b.notify(new Kt("[".concat(y.GooglePay,"] completion result error not handled: ").concat(ge(l)),{groupingHash:"UnhandledActionError:".concat(y.GooglePay,":").concat(ge(l))}))});const{prioritizedPaymentSheetAction:s}=this.getMergedPaymentSheetAction({result:e,errorActions:o});return s||(ie(this.brandName,this.i18n),{action:"abort"})}default:throw new Error("[".concat(y.GooglePay,"] unknown completion result type: ").concat(e.data.__typename))}}getErrorActions({checkoutUrl:e,requestType:t}){return[{matchers:[Bt],generateAction:()=>this.decelerateOrAbort({reason:"captcha_required",instrumentName:y.GooglePay,errorOrWarning:Bt.code,checkoutUrl:e,requestType:t})},{matchers:[$t],generateAction:()=>this.decelerateOrAbort({reason:"invalid_language",instrumentName:y.GooglePay,errorOrWarning:$t.code,checkoutUrl:e,requestType:t})},{matchers:[zt],generateAction:()=>this.decelerateOrAbort({reason:"invalid_country",instrumentName:y.GooglePay,errorOrWarning:zt.code,checkoutUrl:e,requestType:t})},{matchers:[Ht],generateAction:()=>this.decelerateOrAbort({reason:"missing_cart_id",instrumentName:y.GooglePay,errorOrWarning:Ht.code,checkoutUrl:e,requestType:t})},{matchers:[Vt],generateAction:()=>this.decelerateOrAbort({reason:"redirect_to_checkout_required",instrumentName:y.GooglePay,errorOrWarning:Vt.code,checkoutUrl:e,requestType:t})},{matchers:Kr,generateAction:()=>this.decelerateOrAbort({reason:"dynamic_tax",instrumentName:y.GooglePay,errorOrWarning:"TAX_NEW_TAX_MUST_BE_ACCEPTED",checkoutUrl:e,requestType:t})},{matchers:[Gt],generateAction:()=>this.decelerateOrAbort({reason:"unsupported_google_pay_payment_method",instrumentName:y.GooglePay,errorOrWarning:Gt.code,checkoutUrl:e,requestType:t})},{matchers:Yr,generateAction:()=>this.decelerateOrAbort({reason:"invalid_payment_amount",instrumentName:y.GooglePay,errorOrWarning:"INVALID_PAYMENT",checkoutUrl:e,requestType:t})},{matchers:Ql,generateAction:()=>({action:"abort",effects:[()=>ie(this.brandName,this.i18n)]})},{matchers:Qr,generateAction:()=>({action:"abort",effects:[()=>be(this.i18n)]})},{matchers:Va,generateAction:()=>this.decelerateOrAbort({reason:"not_enough_stock",instrumentName:y.GooglePay,errorOrWarning:"MERCHANDISE_NOT_ENOUGH_STOCK",checkoutUrl:e,requestType:t})},{matchers:Ga,generateAction:()=>({action:"show_error",errors:[{reason:"SHIPPING_ADDRESS_UNSERVICEABLE",intent:"SHIPPING_ADDRESS",message:this.i18n.translate("errors.invalid.shipping_address")}]})},{matchers:w.invalid.postalCode,generateAction:()=>({action:"show_error",errors:[{reason:"SHIPPING_ADDRESS_INVALID",intent:"SHIPPING_ADDRESS",message:this.i18n.translate("errors.invalid.postal_code")}]})},{matchers:[sc],generateAction:()=>({action:"show_error",errors:[{reason:"SHIPPING_OPTION_INVALID",intent:"SHIPPING_OPTION",message:this.i18n.translate("errors.missing.shipping_option")}]})},{matchers:ft.invalid,generateAction:()=>({action:"show_error",errors:[{reason:"OTHER_ERROR",intent:"SHIPPING_ADDRESS",message:this.i18n.translate("errors.invalid.email")}]})},{matchers:ft.required,generateAction:()=>({action:"show_error",errors:[{reason:"SHIPPING_ADDRESS_INVALID",intent:"SHIPPING_ADDRESS",message:this.i18n.translate("errors.missing.email")}]})},{matchers:w.required.address2,generateAction:()=>({action:"show_error",errors:[{reason:"SHIPPING_ADDRESS_INVALID",intent:"SHIPPING_ADDRESS",message:this.i18n.translate("errors.missing.address2")}]})},{matchers:w.invalid.address2,generateAction:()=>({action:"show_error",errors:[{reason:"SHIPPING_ADDRESS_INVALID",intent:"SHIPPING_ADDRESS",message:this.i18n.translate("errors.invalid.address2")}]})},{matchers:w.required.city,generateAction:()=>({action:"show_error",errors:[{reason:"SHIPPING_ADDRESS_INVALID",intent:"SHIPPING_ADDRESS",message:this.i18n.translate("errors.missing.city")}]})},{matchers:w.invalid.city,generateAction:()=>({action:"show_error",errors:[{reason:"SHIPPING_ADDRESS_INVALID",intent:"SHIPPING_ADDRESS",message:this.i18n.translate("errors.invalid.city")}]})},{matchers:w.required.province,generateAction:()=>({action:"show_error",errors:[{reason:"SHIPPING_ADDRESS_INVALID",intent:"SHIPPING_ADDRESS",message:this.i18n.translate("errors.missing.zone")}]})},{matchers:w.invalid.province,generateAction:()=>({action:"show_error",errors:[{reason:"SHIPPING_ADDRESS_INVALID",intent:"SHIPPING_ADDRESS",message:this.i18n.translate("errors.invalid.zone")}]})},{matchers:w.required.postalCode,generateAction:()=>({action:"show_error",errors:[{reason:"SHIPPING_ADDRESS_INVALID",intent:"SHIPPING_ADDRESS",message:this.i18n.translate("errors.missing.postal_code")}]})},{matchers:w.invalid.postalCode,generateAction:()=>({action:"show_error",errors:[{reason:"SHIPPING_ADDRESS_INVALID",intent:"SHIPPING_ADDRESS",message:this.i18n.translate("errors.invalid.postal_code")}]})},{matchers:w.required.phoneNumber,generateAction:()=>({action:"show_error",errors:[{reason:"OTHER_ERROR",intent:"SHIPPING_ADDRESS",message:this.i18n.translate("errors.missing.phone_number")}]})},{matchers:w.invalid.phoneNumber,generateAction:()=>({action:"show_error",errors:[{reason:"OTHER_ERROR",intent:"SHIPPING_ADDRESS",message:this.i18n.translate("errors.invalid.phone_number")}]})},{matchers:w.invalid.country,generateAction:()=>({action:"show_error",errors:[{reason:"SHIPPING_ADDRESS_INVALID",intent:"SHIPPING_ADDRESS",message:this.i18n.translate("errors.invalid.country")}]})},{matchers:w.required.firstName,generateAction:()=>({action:"show_error",errors:[{reason:"SHIPPING_ADDRESS_INVALID",intent:"SHIPPING_ADDRESS",message:this.i18n.translate("errors.missing.first_name")}]})},{matchers:w.invalid.firstName,generateAction:()=>({action:"show_error",errors:[{reason:"SHIPPING_ADDRESS_INVALID",intent:"SHIPPING_ADDRESS",message:this.i18n.translate("errors.invalid.first_name")}]})},{matchers:w.required.lastName,generateAction:()=>({action:"show_error",errors:[{reason:"SHIPPING_ADDRESS_INVALID",intent:"SHIPPING_ADDRESS",message:this.i18n.translate("errors.missing.last_name")}]})},{matchers:w.invalid.lastName,generateAction:()=>({action:"show_error",errors:[{reason:"SHIPPING_ADDRESS_INVALID",intent:"SHIPPING_ADDRESS",message:this.i18n.translate("errors.invalid.last_name")}]})},{matchers:w.required.address1,generateAction:()=>({action:"show_error",errors:[{reason:"SHIPPING_ADDRESS_INVALID",intent:"SHIPPING_ADDRESS",message:this.i18n.translate("errors.missing.address1")}]})},{matchers:w.invalid.address1,generateAction:()=>({action:"show_error",errors:[{reason:"SHIPPING_ADDRESS_INVALID",intent:"SHIPPING_ADDRESS",message:this.i18n.translate("errors.invalid.address1")}]})},{matchers:w.emojis.lastName,generateAction:()=>({action:"show_error",errors:[{reason:"SHIPPING_ADDRESS_INVALID",intent:"SHIPPING_ADDRESS",message:this.i18n.translate("errors.emojis.last_name")}]})},{matchers:w.emojis.city,generateAction:()=>({action:"show_error",errors:[{reason:"SHIPPING_ADDRESS_INVALID",intent:"SHIPPING_ADDRESS",message:this.i18n.translate("errors.emojis.city")}]})},{matchers:w.emojis.address1,generateAction:()=>({action:"show_error",errors:[{reason:"SHIPPING_ADDRESS_INVALID",intent:"SHIPPING_ADDRESS",message:this.i18n.translate("errors.emojis.address1")}]})},{matchers:w.emojis.address2,generateAction:()=>({action:"show_error",errors:[{reason:"SHIPPING_ADDRESS_INVALID",intent:"SHIPPING_ADDRESS",message:this.i18n.translate("errors.emojis.address2")}]})},{matchers:w.emojis.postalCode,generateAction:()=>({action:"show_error",errors:[{reason:"SHIPPING_ADDRESS_INVALID",intent:"SHIPPING_ADDRESS",message:this.i18n.translate("errors.emojis.postal_code")}]})},{matchers:w.tooLong.address1,generateAction:()=>({action:"show_error",errors:[{reason:"SHIPPING_ADDRESS_INVALID",intent:"SHIPPING_ADDRESS",message:this.i18n.translate("errors.too_long.address1")}]})},{matchers:w.tooLong.address2,generateAction:()=>({action:"show_error",errors:[{reason:"SHIPPING_ADDRESS_INVALID",intent:"SHIPPING_ADDRESS",message:this.i18n.translate("errors.too_long.address2")}]})},{matchers:w.tooLong.firstName,generateAction:()=>({action:"show_error",errors:[{reason:"SHIPPING_ADDRESS_INVALID",intent:"SHIPPING_ADDRESS",message:this.i18n.translate("errors.too_long.first_name")}]})},{matchers:w.tooLong.lastName,generateAction:()=>({action:"show_error",errors:[{reason:"SHIPPING_ADDRESS_INVALID",intent:"SHIPPING_ADDRESS",message:this.i18n.translate("errors.too_long.last_name")}]})},{matchers:w.tooLong.city,generateAction:()=>({action:"show_error",errors:[{reason:"SHIPPING_ADDRESS_INVALID",intent:"SHIPPING_ADDRESS",message:this.i18n.translate("errors.too_long.city")}]})},{matchers:w.containsUrl.firstName,generateAction:()=>({action:"show_error",errors:[{reason:"SHIPPING_ADDRESS_INVALID",intent:"SHIPPING_ADDRESS",message:this.i18n.translate("errors.url.first_name")}]})},{matchers:w.containsUrl.lastName,generateAction:()=>({action:"show_error",errors:[{reason:"SHIPPING_ADDRESS_INVALID",intent:"SHIPPING_ADDRESS",message:this.i18n.translate("errors.url.last_name")}]})},{matchers:w.htmlTags.address1,generateAction:()=>({action:"show_error",errors:[{reason:"SHIPPING_ADDRESS_INVALID",intent:"SHIPPING_ADDRESS",message:this.i18n.translate("errors.html_tags.address1")}]})},{matchers:w.htmlTags.address2,generateAction:()=>({action:"show_error",errors:[{reason:"SHIPPING_ADDRESS_INVALID",intent:"SHIPPING_ADDRESS",message:this.i18n.translate("errors.html_tags.address2")}]})},{matchers:w.htmlTags.city,generateAction:()=>({action:"show_error",errors:[{reason:"SHIPPING_ADDRESS_INVALID",intent:"SHIPPING_ADDRESS",message:this.i18n.translate("errors.html_tags.city")}]})},{matchers:w.htmlTags.firstName,generateAction:()=>({action:"show_error",errors:[{reason:"SHIPPING_ADDRESS_INVALID",intent:"SHIPPING_ADDRESS",message:this.i18n.translate("errors.html_tags.first_name")}]})},{matchers:w.htmlTags.lastName,generateAction:()=>({action:"show_error",errors:[{reason:"SHIPPING_ADDRESS_INVALID",intent:"SHIPPING_ADDRESS",message:this.i18n.translate("errors.html_tags.last_name")}]})},{matchers:C.invalid.generic,generateAction:()=>({action:"show_error",errors:[{reason:"PAYMENT_DATA_INVALID",intent:"PAYMENT_METHOD",message:this.i18n.translate("errors.invalid.billing_address")}]})},{matchers:[Ft],generateAction:()=>this.decelerateOrAbort({reason:"localization_extension_field_error",instrumentName:y.GooglePay,errorOrWarning:Ft.code,checkoutUrl:e,requestType:t})},{matchers:C.required.firstName,generateAction:()=>({action:"show_error",errors:[{reason:"PAYMENT_DATA_INVALID",intent:"PAYMENT_METHOD",message:this.i18n.translate("errors.missing.first_name")}]})},{matchers:C.required.lastName,generateAction:()=>({action:"show_error",errors:[{reason:"PAYMENT_DATA_INVALID",intent:"PAYMENT_METHOD",message:this.i18n.translate("errors.missing.last_name")}]})},{matchers:C.required.address1,generateAction:()=>({action:"show_error",errors:[{reason:"PAYMENT_DATA_INVALID",intent:"PAYMENT_METHOD",message:this.i18n.translate("errors.missing.address1")}]})},{matchers:C.required.address2,generateAction:()=>({action:"show_error",errors:[{reason:"PAYMENT_DATA_INVALID",intent:"PAYMENT_METHOD",message:this.i18n.translate("errors.missing.address2")}]})},{matchers:C.required.city,generateAction:()=>({action:"show_error",errors:[{reason:"PAYMENT_DATA_INVALID",intent:"PAYMENT_METHOD",message:this.i18n.translate("errors.missing.city")}]})},{matchers:C.required.phoneNumber,generateAction:()=>({action:"show_error",errors:[{reason:"PAYMENT_DATA_INVALID",intent:"PAYMENT_METHOD",message:this.i18n.translate("errors.missing.phone")}]})},{matchers:C.required.postalCode,generateAction:()=>({action:"show_error",errors:[{reason:"PAYMENT_DATA_INVALID",intent:"PAYMENT_METHOD",message:this.i18n.translate("errors.missing.postal_code")}]})},{matchers:C.invalid.postalCode,generateAction:()=>({action:"show_error",errors:[{reason:"PAYMENT_DATA_INVALID",intent:"PAYMENT_METHOD",message:this.i18n.translate("errors.invalid.postal_code")}]})},{matchers:C.required.province,generateAction:()=>({action:"show_error",errors:[{reason:"PAYMENT_DATA_INVALID",intent:"PAYMENT_METHOD",message:this.i18n.translate("errors.missing.zone")}]})},{matchers:C.emojis.firstName,generateAction:()=>({action:"show_error",errors:[{reason:"PAYMENT_DATA_INVALID",intent:"PAYMENT_METHOD",message:this.i18n.translate("errors.emojis.first_name")}]})},{matchers:C.htmlTags.firstName,generateAction:()=>({action:"show_error",errors:[{reason:"PAYMENT_DATA_INVALID",intent:"PAYMENT_METHOD",message:this.i18n.translate("errors.html_tags.first_name")}]})},{matchers:C.invalid.firstName,generateAction:()=>({action:"show_error",errors:[{reason:"PAYMENT_DATA_INVALID",intent:"PAYMENT_METHOD",message:this.i18n.translate("errors.invalid.first_name")}]})},{matchers:C.emojis.lastName,generateAction:()=>({action:"show_error",errors:[{reason:"PAYMENT_DATA_INVALID",intent:"PAYMENT_METHOD",message:this.i18n.translate("errors.emojis.last_name")}]})},{matchers:C.htmlTags.lastName,generateAction:()=>({action:"show_error",errors:[{reason:"PAYMENT_DATA_INVALID",intent:"PAYMENT_METHOD",message:this.i18n.translate("errors.html_tags.last_name")}]})},{matchers:C.invalid.lastName,generateAction:()=>({action:"show_error",errors:[{reason:"PAYMENT_DATA_INVALID",intent:"PAYMENT_METHOD",message:this.i18n.translate("errors.invalid.last_name")}]})},{matchers:C.emojis.address1,generateAction:()=>({action:"show_error",errors:[{reason:"PAYMENT_DATA_INVALID",intent:"PAYMENT_METHOD",message:this.i18n.translate("errors.emojis.address1")}]})},{matchers:C.htmlTags.address1,generateAction:()=>({action:"show_error",errors:[{reason:"PAYMENT_DATA_INVALID",intent:"PAYMENT_METHOD",message:this.i18n.translate("errors.html_tags.address1")}]})},{matchers:C.invalid.address1,generateAction:()=>({action:"show_error",errors:[{reason:"PAYMENT_DATA_INVALID",intent:"PAYMENT_METHOD",message:this.i18n.translate("errors.invalid.address1")}]})},{matchers:C.emojis.address2,generateAction:()=>({action:"show_error",errors:[{reason:"PAYMENT_DATA_INVALID",intent:"PAYMENT_METHOD",message:this.i18n.translate("errors.emojis.address2")}]})},{matchers:C.htmlTags.address2,generateAction:()=>({action:"show_error",errors:[{reason:"PAYMENT_DATA_INVALID",intent:"PAYMENT_METHOD",message:this.i18n.translate("errors.html_tags.address2")}]})},{matchers:C.invalid.address2,generateAction:()=>({action:"show_error",errors:[{reason:"PAYMENT_DATA_INVALID",intent:"PAYMENT_METHOD",message:this.i18n.translate("errors.invalid.address2")}]})},{matchers:C.emojis.city,generateAction:()=>({action:"show_error",errors:[{reason:"PAYMENT_DATA_INVALID",intent:"PAYMENT_METHOD",message:this.i18n.translate("errors.emojis.city")}]})},{matchers:C.htmlTags.city,generateAction:()=>({action:"show_error",errors:[{reason:"PAYMENT_DATA_INVALID",intent:"PAYMENT_METHOD",message:this.i18n.translate("errors.html_tags.city")}]})},{matchers:C.invalid.city,generateAction:()=>({action:"show_error",errors:[{reason:"PAYMENT_DATA_INVALID",intent:"PAYMENT_METHOD",message:this.i18n.translate("errors.invalid.city")}]})},{matchers:C.emojis.phoneNumber,generateAction:()=>({action:"show_error",errors:[{reason:"PAYMENT_DATA_INVALID",intent:"PAYMENT_METHOD",message:this.i18n.translate("errors.emojis.phone")}]})},{matchers:C.invalid.phoneNumber,generateAction:()=>({action:"show_error",errors:[{reason:"PAYMENT_DATA_INVALID",intent:"PAYMENT_METHOD",message:this.i18n.translate("errors.invalid.phone")}]})},{matchers:C.emojis.postalCode,generateAction:()=>({action:"show_error",errors:[{reason:"PAYMENT_DATA_INVALID",intent:"PAYMENT_METHOD",message:this.i18n.translate("errors.emojis.postal_code")}]})},{matchers:C.invalid.postalCode,generateAction:()=>({action:"show_error",errors:[{reason:"PAYMENT_DATA_INVALID",intent:"PAYMENT_METHOD",message:this.i18n.translate("errors.invalid.postal_code")}]})}]}mapCustomValidationFunctionErrorToAction(e){const t=Vr(e);return t?(b.notify(new Error("[".concat(y.GooglePay,"] custom validation function error: ").concat(JSON.stringify(e)))),jr(this.i18n.translate("error_dialogs.wallet.title",{wallet:this.brandName}),t.message),{action:"abort"}):null}}function ah({deliveryGroups:r,i18n:e}){var t;const n=ed(Ja({deliveryGroups:r}),e),a=n.map(({handle:i,title:s,description:l})=>({id:i,label:s!=null?s:"",description:l})),o=(t=n.find(i=>{var s;return i.handle.includes(((s=r[0].selectedDeliveryOption)==null?void 0:s.handle)||"")}))==null?void 0:t.handle;return{shippingOptions:a,defaultSelectedOptionId:o}}function Ar(r,e=!1,{addressType:t="unknown"}={}){let n,a=r.locality;e&&r.iso3166AdministrativeArea?(n=r.iso3166AdministrativeArea,r.countryCode==="AE"&&(a=r.administrativeArea)):(e&&(p.googlePayIso3166AdministrativeAreaFallback(),p.log({body:"Google Pay address missing iso3166AdministrativeArea",attributes:{addressType:t,countryCode:r.countryCode,administrativeArea:r.administrativeArea,userAgent:navigator==null?void 0:navigator.userAgent}})),n=r.administrativeArea,r.countryCode==="AE"&&(a=r.administrativeArea,r.administrativeArea in Yn&&(n=Yn[r.administrativeArea])),r.countryCode==="MX"&&n&&(n=oh(n)));let o,i;if(r.name){const[s,...l]=(r.name||"").split(" ");l.length===0?i=s:i=l.join(" "),o=s}return{firstName:o,lastName:i,address1:r.address1,address2:r.address2,city:a,province:n,country:r.countryCode,phone:r.phoneNumber,zip:r.postalCode}}const Yn={"\u0623\u0628\u0648 \u0638\u0628\u064A":"AZ","\u0625\u0645\u0627\u0631\u0629 \u0627\u0644\u0634\u0627\u0631\u0642\u0629\u0651":"SH",\u0627\u0644\u0641\u062C\u064A\u0631\u0629:"FU",\u0639\u062C\u0645\u0627\u0646:"AJ","\u0631\u0623\u0633 \u0627\u0644\u062E\u064A\u0645\u0629":"RK","\u0625\u0645\u0627\u0631\u0629 \u0631\u0623\u0633 \u0627\u0644\u062E\u064A\u0645\u0629":"RK","\u0623\u0645 \u0627\u0644\u0642\u064A\u0648\u064A\u0646":"UQ","\u0627\u0645 \u0627\u0644\u0642\u064A\u0648\u064A\u0646":"UQ",\u062F\u0628\u064A:"DU","\u0625\u0645\u0627\u0631\u0629 \u062F\u0628\u064A\u0651":"DU"};function oh(r){return r==="M\xE9x."?"MEX":r==="Q.R."?"Q ROO":r.replace(/\./g,"").toUpperCase()}class Kn extends Error{constructor(){super(...arguments),d(this,"name","GooglePayError")}}function Io(r){const e=r.auth;if(!(Array.isArray(e)&&e.length>0))return{result:"error",reason:"invalidAuthParams"};const t=oe();for(const n of e)if(t<n.expiresAt*1e3)return{result:"success",jwt:n.jwt};return{result:"error",reason:"authJwtExpired"}}const ih=27e3,Qn="Google Pay Timeout";var Ct,ae,Ye;class sh{constructor({walletParams:e,isShippingRequired:t,hasSellingPlan:n,dataSource:a,button:o,i18n:i,cartClient:s,buyerCurrency:l,abortController:c}){d(this,"name",y.GooglePay),d(this,"walletParams"),d(this,"cart",null),d(this,"isShippingRequired"),d(this,"hasSellingPlan"),d(this,"dataSource"),d(this,"button"),d(this,"paymentsClient"),d(this,"i18n"),d(this,"actionGenerator"),d(this,"cartClient"),d(this,"initialBuyerCurrency"),d(this,"useISO3166Format"),d(this,"terminalCartCreationError"),V(this,Ct),V(this,ae),V(this,Ye),d(this,"onPaymentDataChanged",async h=>{var g,f;const{callbackTrigger:v,shippingAddress:_,shippingOptionData:A}=h,{translate:k}=this.i18n;switch(b.leaveBreadcrumb("Google Pay onPaymentDataChanged",{callbackTrigger:v},"log"),v){case"INITIALIZE":{if(!this.cart)try{const{cart:rt,customValidationError:$,decelerationReason:z,unrecoverableError:S}=await Ae({element:this.button,instrumentName:y.GooglePay,dataSource:this.dataSource});if($||S)return p.sheetClicked({instrument:this.name,result:"rejected",reason:$?"custom_validation_error":"unrecoverable_error"}),this.terminalCartCreationError=$?$.message:lh(this.i18n,S),this.showPaymentDataRequestError({error:{reason:"OTHER_ERROR",message:this.terminalCartCreationError,intent:"SHIPPING_ADDRESS"}});if(z)return p.sheetClicked({instrument:this.name,result:"success",reason:"deceleration"}),U({checkoutUrl:(g=rt==null?void 0:rt.checkoutUrl)!=null?g:"",instrumentName:this.name,reason:z}),this.showPaymentDataRequestError({error:{intent:"SHIPPING_ADDRESS",reason:"OTHER_ERROR",message:""}});this.cart=rt,p.sheetClicked({instrument:this.name,result:"success"})}catch(rt){return p.sheetClicked({instrument:this.name,result:"failed",reason:"unhandled_error"}),p.log({body:"Unhandled error detected in Google Pay sheet clicked",attributes:{error:String(rt),location:"onPaymentDataChanged_INITIALIZE"}}),this.showPaymentDataRequestError({intent:"SHIPPING_ADDRESS"})}let E=!1;if(_)try{return await this.handleShippingAddressChange(this.cart.id,_)}catch(rt){E=!0}return{newTransactionInfo:_r({cart:this.cart,i18n:this.i18n}),...E?this.showPaymentDataRequestError():{}}}case"SHIPPING_ADDRESS":return this.terminalCartCreationError?this.showPaymentDataRequestError({error:{reason:"OTHER_ERROR",message:this.terminalCartCreationError,intent:"SHIPPING_ADDRESS"}}):this.cart?_?this.handleShippingAddressChange(this.cart.id,_):{newTransactionInfo:_r({cart:this.cart,i18n:this.i18n})}:this.showPaymentDataRequestError({intent:v});case"SHIPPING_OPTION":{if(!this.cart)return this.showPaymentDataRequestError({intent:v});if(!A||!A.id)return{error:{reason:"SHIPPING_OPTION_INVALID",message:k("shipping_methods.choose_delivery_strategy"),intent:"SHIPPING_OPTION"}};const E=await this.handleDeliveryOptionChange(A.id.split(","));return E.data?(this.cart=E.data,E.abortReason==="out_of_stock"?this.showPaymentDataRequestError({error:{intent:"SHIPPING_OPTION",reason:"OTHER_ERROR",message:this.i18n.translate("error_dialogs.product.out_of_stock")}}):E.decelerationReason?(U({checkoutUrl:(f=this.cart.checkoutUrl)!=null?f:"",instrumentName:this.name,reason:E.decelerationReason}),this.showPaymentDataRequestError({error:{intent:"SHIPPING_OPTION",reason:"OTHER_ERROR",message:""}})):this.handlePaymentDataRequestUpdate({result:E,intent:v,checkoutUrl:this.cart.checkoutUrl,requestType:"onPaymentDataChanged::updateCartDeliveryOptions"})):this.showPaymentDataRequestError({intent:v})}default:return this.logException("Payment data changed callback returned unexpected intent: ".concat(v),{severity:"warning"}),this.showPaymentDataRequestError({intent:"SHIPPING_ADDRESS"})}}),d(this,"onPaymentAuthorized",async h=>{var g,f,v;if(p.authorizationAttempt(this.name),et(M.AuthorizationLatency,this.name),!this.cart)return p.googlePayNullCartOnAuthorize(),this.handlePaymentAuthorizationError();const _=(g=h.paymentMethodData.info)==null?void 0:g.billingAddress,A=h.shippingAddress,{signature:k,signedMessage:E,protocolVersion:rt}=JSON.parse(h.paymentMethodData.tokenizationData.token);if(!_)return this.handlePaymentAuthorizationError({error:{reason:"PAYMENT_DATA_INVALID",intent:"PAYMENT_AUTHORIZATION",message:this.i18n.translate("errors.invalid.billing_address")}});if(this.isShippingRequired&&!A)return this.handlePaymentAuthorizationError({error:{reason:"SHIPPING_ADDRESS_INVALID",intent:"PAYMENT_AUTHORIZATION",message:this.i18n.translate("errors.invalid.shipping_address")}});const $=async()=>{var G,se;const Me=(G=P(this,Ct))!=null?G:h.email,pa=this.isShippingRequired?{validateAddress:!0,streetAddress:Ar(A,this.useISO3166Format,{addressType:"shipping"})}:{};return await je({cartClient:this.cartClient,cartId:this.cart.id,instrumentName:this.name,emailAddress:Me,abortSignal:(se=P(this,ae))==null?void 0:se.signal,...pa})},z=async()=>{var G;const se=Ar(_,this.useISO3166Format,{addressType:"billing"});return await rn({cartId:this.cart.id,totalAmount:this.cart.totalAmount,paymentMethod:{walletPaymentMethod:{googlePayWalletContent:{billingAddress:se,signature:k,signedMessage:E,protocolVersion:rt}}},canUsePaymentMethodForFreeOrder:!1,billingAddress:se,cartClient:this.cartClient,instrumentName:this.name,hasSellingPlan:this.hasSellingPlan,abortSignal:(G=P(this,ae))==null?void 0:G.signal})},S=setTimeout(()=>{var G;(G=P(this,ae))==null||G.abort(Qn)},ih);try{const G=await $(),se=jt({currentCart:G.data,previousCart:this.cart}),Me=j.enabled(Re);Me&&G.data&&(this.cart=G.data);const pa=this.handleIntermediatePaymentAuthorizationResult({result:G,checkoutUrl:this.cart.checkoutUrl,requestType:"onPaymentAuthorized::updateBuyerIdentity"});if(pa)return clearTimeout(S),pa;const qh=await z();Me&&se==="inc"&&(qh.decelerationReason||(qh.decelerationReason="price_increased"));const ko=this.handleIntermediatePaymentAuthorizationResult({result:qh,checkoutUrl:this.cart.checkoutUrl,requestType:"onPaymentAuthorized::updateCartPayment"});if(ko)return clearTimeout(S),ko;if(clearTimeout(S),(v=(f=P(this,ae))==null?void 0:f.signal)!=null&&v.aborted)return this.handlePaymentAuthorizationError();const jh=await yo({cartId:this.cart.id,token:k,cartClient:this.cartClient,instrumentName:this.name});mt({result:jh,instrument:this.name});const np=this.actionGenerator.mapCompletionResultToPaymentSheetAction({result:jh,checkoutUrl:jh.data&&"checkoutUrl"in jh.data&&jh.data.checkoutUrl?jh.data.checkoutUrl:this.cart.checkoutUrl,requestType:"completion"});return this.handlePaymentAuthorizationResult(np)}catch(G){clearTimeout(S);const{message:se}=G;return se!=null&&se.includes(Qn)?(p.log({body:"Google Pay onPaymentAuthorized timed out",attributes:{instrument:this.name,requestType:"onPaymentAuthorized"}}),this.handlePaymentAuthorizationError({status:"timeout"})):(G instanceof Ve||this.logException(se),this.handlePaymentAuthorizationError())}}),d(this,"handlePaymentAuthorizationResult",async h=>{var g,f;switch((g=h.effects)==null||g.forEach(v=>v()),h.action){case"complete":return this.emitAuthorizationCompleteMetric("success"),we(h.redirectUrl),{transactionState:"SUCCESS"};case"show_error":return this.handlePaymentAuthorizationError({error:(f=h.errors)==null?void 0:f[0]});case"decelerate":return U({checkoutUrl:h.redirectUrl,instrumentName:this.name,reason:h.reason}),this.emitAuthorizationCompleteMetric("failed"),{transactionState:"SUCCESS"};case"abort":default:return this.emitAuthorizationCompleteMetric("failed"),{transactionState:"SUCCESS"}}}),this.walletParams=e,this.isShippingRequired=t,this.hasSellingPlan=n,this.dataSource=a,this.button=o,this.i18n=i,this.cartClient=s,this.initialBuyerCurrency=l,F(this,Ct,e.customerAccountEmail),F(this,ae,c),this.useISO3166Format=j.enabled(Js);const u=Io(this.walletParams);if(u.result==="error")throw b.leaveBreadcrumb("Google Pay Invalid AuthJwt detected on click",{reason:u.reason,walletParams:this.walletParams},"error"),new Kn(u.reason);F(this,Ye,u.jwt);const m={environment:this.walletParams.environment,merchantInfo:{...this.walletParams.paymentData.merchantInfo,authJwt:P(this,Ye)},paymentDataCallbacks:{onPaymentDataChanged:this.isShippingRequired?this.onPaymentDataChanged:void 0,onPaymentAuthorized:this.onPaymentAuthorized}};this.paymentsClient=new window.google.payments.api.PaymentsClient(m),this.actionGenerator=new nh(this.i18n)}async handleClick(){if(!this.isShippingRequired)throw new Z("Google Pay checkout started for digital cart");const e=th({walletParams:this.walletParams,isShippingRequired:this.isShippingRequired,hasSellingPlan:this.hasSellingPlan,i18n:this.i18n,buyerCurrency:this.initialBuyerCurrency,authJwt:P(this,Ye)});b.leaveBreadcrumb("Google Pay handleClick",{paymentDataRequest:e},"log"),await this.paymentsClient.loadPaymentData(e)}showPaymentDataRequestError({error:e,intent:t="SHIPPING_ADDRESS"}={}){return e?{error:e}:{error:{intent:t,reason:"OTHER_ERROR",message:this.i18n.translate("error_dialogs.wallet.generic_error",{wallet:this.i18n.translate("brand.google_pay")})}}}handlePaymentAuthorizationError({error:e,status:t="failed"}={}){return this.emitAuthorizationCompleteMetric(t),{transactionState:"ERROR",...this.showPaymentDataRequestError({error:e,intent:"PAYMENT_AUTHORIZATION"})}}handlePaymentDataRequestUpdate({result:e,intent:t,checkoutUrl:n,requestType:a}){var o,i,s;const l=this.actionGenerator.mapMutationResultToPaymentSheetAction({result:e,checkoutUrl:n,requestType:a});switch((o=l.effects)==null||o.forEach(c=>c()),l.action){case"update":{const c=l,{data:u,decelerationReason:m}=e;return u?m?(U({checkoutUrl:u.checkoutUrl,instrumentName:this.name,reason:m}),this.showPaymentDataRequestError({error:{reason:"OTHER_ERROR",message:"",intent:"OFFER"}})):this.isShippingRequired&&u.deliveryGroups.length===0?this.showPaymentDataRequestError({error:{reason:"SHIPPING_ADDRESS_INVALID",message:this.i18n.translate("errors.address_unserviceable",{shopName:this.walletParams.paymentData.merchantInfo.merchantName}),intent:"SHIPPING_ADDRESS"}}):{newTransactionInfo:_r({cart:u,i18n:this.i18n}),newShippingOptionParameters:this.isShippingRequired?ah({deliveryGroups:u.deliveryGroups,i18n:this.i18n}):void 0,error:(i=c.errors)==null?void 0:i[0]}:this.showPaymentDataRequestError({intent:t})}case"show_error":return{error:(s=l.errors)==null?void 0:s[0]};case"decelerate":return U({checkoutUrl:l.redirectUrl,instrumentName:this.name,reason:l.reason}),this.showPaymentDataRequestError({error:{reason:"OTHER_ERROR",message:"",intent:"OFFER"}});case"abort":return this.showPaymentDataRequestError({intent:t});default:return this.logException("Payment sheet update returned unexpected action (see request tab for details)",{metadata:{request:{action:l.action,intent:t}}}),this.showPaymentDataRequestError({intent:t})}}handleIntermediatePaymentAuthorizationResult({result:e,checkoutUrl:t,requestType:n}){var a,o,i,s,l;if(mt({result:e,instrument:this.name}),e.abortReason==="out_of_stock")return be(this.i18n),{transactionState:"SUCCESS"};if(e.decelerationReason)return U({checkoutUrl:(o=(a=e.data)==null?void 0:a.checkoutUrl)!=null?o:"",instrumentName:this.name,reason:e.decelerationReason}),{transactionState:"SUCCESS"};const c=this.actionGenerator.mapMutationResultToPaymentSheetAction({result:e,checkoutUrl:t,requestType:n});switch((i=c.effects)==null||i.forEach(u=>u()),c.action){case"show_error":return this.handlePaymentAuthorizationError({error:(s=c.errors)==null?void 0:s[0]});case"abort":return this.handlePaymentAuthorizationError({error:(l=c.errors)==null?void 0:l.at(0)});case"decelerate":return this.emitAuthorizationCompleteMetric("success"),U({checkoutUrl:c.redirectUrl,instrumentName:this.name,reason:c.reason}),{transactionState:"SUCCESS"};default:return}}handleCurrencyChange(e,t){Jr({currentCartTotal:t,initialBuyerCurrency:this.initialBuyerCurrency})&&U({checkoutUrl:e,instrumentName:this.name,reason:"currency_changed"})}async handleShippingAddressChange(e,t){var n,a;let o=await je({cartClient:this.cartClient,cartId:e,streetAddress:t?Ar(t,this.useISO3166Format,{addressType:"shipping"}):{},instrumentName:y.GooglePay,abortSignal:(n=P(this,ae))==null?void 0:n.signal});if(!o.data)return this.showPaymentDataRequestError({intent:"SHIPPING_ADDRESS"});if(this.cart=o.data,o.abortReason==="out_of_stock")return this.showPaymentDataRequestError({error:{intent:"SHIPPING_ADDRESS",reason:"OTHER_ERROR",message:this.i18n.translate("error_dialogs.product.out_of_stock")}});if(o.decelerationReason)return U({checkoutUrl:(a=this.cart.checkoutUrl)!=null?a:"",instrumentName:this.name,reason:o.decelerationReason}),this.showPaymentDataRequestError({error:{intent:"SHIPPING_ADDRESS",reason:"OTHER_ERROR",message:""}});const i=this.cart.deliveryGroups.map(({selectedDeliveryOption:s,deliveryOptions:l})=>{var c;return s!=null&&s.handle&&s.deliveryMethodType!=="LOCAL"?s.handle:(c=l.filter(({deliveryMethodType:u})=>u==="SHIPPING")[0])==null?void 0:c.handle}).filter(Boolean);if(i.length>0){if(o=await this.handleDeliveryOptionChange(i),!o.data)return this.showPaymentDataRequestError({intent:"SHIPPING_ADDRESS"});this.cart=o.data}return this.handleCurrencyChange(this.cart.checkoutUrl,this.cart.totalAmount),this.handlePaymentDataRequestUpdate({result:o,intent:"SHIPPING_ADDRESS",checkoutUrl:this.cart.checkoutUrl,requestType:"onPaymentDataChanged::updateBuyerIdentity"})}async handleDeliveryOptionChange(e){var t;const n=fo({deliveryGroups:this.cart.deliveryGroups,instrumentName:y.GooglePay,selectedDeliveryOptionHandles:e});return await go({cartClient:this.cartClient,cartId:this.cart.id,instrumentName:y.GooglePay,selectedDeliveryOptions:n,abortSignal:(t=P(this,ae))==null?void 0:t.signal})}logException(e,{severity:t,metadata:n}={}){b.notify(new Kn(e),{severity:t!=null?t:"error",metadata:n})}emitAuthorizationCompleteMetric(e){p.authorizationComplete({instrument:this.name,measurement:Q(M.AuthorizationLatency,this.name),result:e})}}Ct=new WeakMap,ae=new WeakMap,Ye=new WeakMap;function lh(r,e){switch(e){case L.VariantRequiresSellingPlan:case L.SellingPlanNotApplicable:case L.InvalidQuantity:case L.MerchandiseIdInvalid:case L.IgnoredResponseError:case L.NoResponse:return r.translate("error_dialogs.checkout.generic_error");default:return r.translate("error_dialogs.checkout.generic_error")}}const ch={LIGHT:"light",DARK:"dark"};class dh extends Ee{constructor(){super(...arguments),d(this,"name",y.GooglePay),d(this,"paymentsClient",null),d(this,"button",null),d(this,"handleClick",async()=>{if(this.disabled)return;this.disabled=!0;const e=ke("AbortController");let t=!1;try{await this.createPaymentsClient(e),t=!0,await this.paymentsClient.handleClick()}catch(n){if(this.disabled=!1,n.statusCode==="CANCELED"){e==null||e.abort("[Google Pay] Payment sheet cancelled"),p.sheetCancelled(y.GooglePay);return}e==null||e.abort("[Google Pay] Payment sheet failure"),this.expectedError(n)?p.sheetClicked({instrument:this.name,result:"failed",reason:"expected_error"}):b.notify(n),t||(p.sheetClicked({instrument:this.name,result:"failed",reason:"unhandled_error"}),p.log({body:"Unhandled error detected in Google Pay client creation",attributes:{error:String(n),location:"handleClick"}}));const a=await this.i18n,o=a.translate("brand.google_pay");ie(o,a)}})}static get observedAttributes(){return["disabled"]}attributeChangedCallback(e,t,n){super.attributeChangedCallback(e,t,n,this.button)}async connectedCallback(){this.cleanupOnFailure(this.render.bind(this),this.name)}async createPaymentsClient(e){this.paymentsClient=new sh({walletParams:this.walletParams,isShippingRequired:this.isShippingRequired,hasSellingPlan:this.hasSellingPlan,dataSource:await this.dataSource,button:this,cartClient:await this.apiClient,i18n:await this.i18n,buyerCurrency:this.buyerCurrency,abortController:e})}async render(){const e=this.getOrCreateShadowRoot();if(this.button)return;await this.initializeShadowStyles(e,Qu);const{translate:t}=await this.i18n,n=this.isCTA?t("buy_with_button_content",{wallet:t("brand.google_pay")}):t("brand.google_pay"),a=ar({label:n});this.disabled&&a.setAttribute("disabled",""),a.classList.add("button",Oe.BUTTON,ch[this.buttonTheme]),a.onclick=this.handleClick,await this.renderButtonContent(a,t),this.button=a,e.appendChild(a),this.ensureLightDOMIsNotEmpty(),this.onRendered()}async renderButtonContent(e,t){const n=wt({instrumentName:y.GooglePay,logoType:this.buttonTheme}),a=new DOMParser().parseFromString(n,"image/svg+xml").documentElement;if(e.style.font=window.getComputedStyle(this).font,this.isCTA){const o=nn({translate:t,logoElement:a,setAriaHidden:!0});o.classList.add("content"),e.appendChild(o)}else e.classList.add("logo-only"),e.appendChild(a)}expectedError(e){return e==="failed to open window"}}const ve=class Wh extends Ce{static walletName(){return"google_pay"}constructor(e){super(e)}getWebComponentName(){return"shopify-google-pay-button"}getInstrumentName(){return y.GooglePay}getWebComponentClass(){return dh}async loadWalletSDK(){if(Wh.googlePaySDKPromise)return Wh.googlePaySDKPromise;const e=document.createElement("script");e.setAttribute("src",this.walletParams.sdkUrl);const t=new Promise((n,a)=>{e.onload=()=>n(),e.onerror=o=>{e.remove(),a(o)},document.body.appendChild(e)});return Wh.googlePaySDKPromise=Promise.all([t,this.loadLogos()]),Wh.googlePaySDKPromise}getLoadEligibility(){const e=Io(this.walletParams);switch(e.result){case"success":return{eligible:!0};case"error":return{eligible:!1,reason:e.reason}}}getPartnerSDKEligibility(){return{eligible:!0}}async loadLogos(){return Promise.all([this.loadGooglePayLogo(),this.loadGooglePayLogoDark()])}async loadGooglePayLogo(){await Ze({svg:"google-pay-logo.svg",instrumentName:y.GooglePay})}async loadGooglePayLogoDark(){await Ze({svg:"google-pay-logo-dark.svg",instrumentName:y.GooglePay,logoType:"DARK"})}};d(ve,"googlePaySDKPromise");let Lr=ve;const uh=[Dc,vr,on,Lr,Dr,Or,So],hh=new Map(uh.map(r=>[r.walletName(),e=>new r(e)]));function gt(r){if(!r)return null;const e=hh.get(r.name);return e?e(r):(console.debug("Can't build wallet with name ".concat(r.name)),null)}function ph(r){return r.map(e=>gt(e)).filter(e=>e!=null)}const vo="*{box-sizing:border-box}.wallet-button-fade-in{animation:animation-fade-in .3s cubic-bezier(.1,.79,1,1)}@keyframes animation-fade-in{0%{opacity:0}to{opacity:1}}button[aria-disabled=true]{opacity:.5;cursor:not-allowed}";function mh({styleId:r,styles:e,cssFileName:t}){var n,a;(a=(n=window.Shopify)==null?void 0:n.PaymentButton)!=null&&a.isStorefrontPortableWallets&&(gh({styleId:r})||yh({styleId:r,styles:e}))}function gh({styleId:r}){const e=document.querySelector("style#".concat(r)),t=document.querySelector("link#".concat(r));return!!(e||t)}function yh({styleId:r,styles:e}){const t=document.createElement("style");t.id=r,t.innerHTML=e,document.head.insertBefore(t,document.head.firstChild)}const X={buttonBlockSize:"--shopify-accelerated-checkout-button-block-size",buttonBorderRadius:"--shopify-accelerated-checkout-button-border-radius",buttonBoxShadow:"--shopify-accelerated-checkout-button-box-shadow",inlineAlignment:"--shopify-accelerated-checkout-inline-alignment"};function Jn(r){let e=0,t=0,n=0;const a=r.split(/\s+/);for(let o=0;o<a.length;o++){const i=a[o];i!==">"&&(i.includes("#")&&(e+=(i.match(/#/g)||[]).length),i.includes(".")&&(t+=(i.match(/\./g)||[]).length),i.includes("[")&&(t+=(i.match(/\[/g)||[]).length),i.includes(":")&&(t+=(i.match(/:[^:]/g)||[]).length),/^[A-Za-z]/.test(i)&&(n+=1))}return[e,t,n]}function fh(r,e){for(let t=0;t<3;t++)if(r[t]!==e[t])return e[t]-r[t];return 0}function Xn(r){return[...r].sort((e,t)=>{const n=Jn(e.selector),a=Jn(t.selector);return fh(n,a)})}const bh=/\.cart__dynamic-checkout-buttons|\.dynamic-checkout-buttons\s*(>\s*)?li(?![a-zA-Z0-9_.:#-])/,wh=/\.cart__dynamic-checkout-buttons|\.dynamic-checkout-buttons\s*\[role="?button"?\](?![:\w-])/,_h=/\.additional-checkout-buttons\s*(?:div\s*)?\[role="?button"?\](?![:\w-])/,To=/\[data-shopify-buttoncontainer\](?![:\w-])/,No=/.dynamic-checkout-buttons .shopify-payment-button__button/,Ah=/(?!.*\.shopify-cleanslate)\.shopify-payment-button__button(?:--branded)?(?![\w-:.#>])/,Eh=/\.(shopify-payment-button|shopify-payment-button__button|shopify-payment-button__button--branded)\s*\[role="?button"?\](?![:\w-])/,Ch=/(?:only\s+)?(?:screen\s+and\s+)?\((?:min|max)-(?:width|height):\s*\d+px\)/,Sh=[wh,To,bh,_h,No],Ph=[Ah,Eh,No],Ih=.001;function Zn(r){return r.split(",").map(e=>e.trim())}function Ro(r){const e=r.pageType,t=e===R.ProductPage?Ph:Sh,n=[...document.styleSheets].filter(vh),a=new Set;function o($){for(const z of t){const S=$.match(z);if(S)return a.add(S[0]),!0}return!1}const i=[],s=[];n.forEach($=>{try{for(const z of $.cssRules)if(z instanceof CSSMediaRule){const S=z;if(!Ch.test(S.conditionText))continue;for(const G of S.cssRules){if(!(G instanceof CSSStyleRule))continue;const se=Zn(G.selectorText);for(const Me of se)o(Me)&&s.push({selector:Me,conditionText:S.conditionText,...aa(G)})}}else if(z instanceof CSSStyleRule){const S=z,G=Zn(S.selectorText);for(const se of G)o(se)&&i.push({selector:se,...aa(S)})}}catch(z){xt()("shopify-support-debug")&&(console.debug("[shopify-support-debug] stylesheet origin: ".concat($.href)),console.debug(z))}});const l=xt()("shopify-support-debug");l&&console.table(Array.from(a));const c=i.reverse(),u=s.reverse(),m=Xn(c),h=Xn(u),g={},f=ea(e)?document.querySelector(".cart__blocks .button"):document.querySelector(".product-form__buttons .button");f&&(g.boxShadow=getComputedStyle(f,":before").boxShadow);for(const $ of m){const z=["height","minHeight","borderRadius","marginTop"];ea(e)&&$.selector.match(To)&&z.push("justifyContent");for(const S of z)g[S]=Dh({rule:$,property:S,currentPropertyValue:g[S]})}const{height:v,borderRadius:_,minHeight:A,marginTop:k,justifyContent:E,boxShadow:rt}=g;return l&&console.table([{property:"height",value:v},{property:"borderRadius",value:_},{property:"minHeight",value:A},{property:"marginTop",value:k},{property:"justifyContent",value:E},{property:"boxShadow",value:rt}]),e===R.ProductPage?na({styles:{height:v,minHeight:A,borderRadius:_,marginTop:k,boxShadow:rt},mediaRules:h,element:r}):na({styles:{borderRadius:_,boxShadow:rt,justifyContent:E},mediaRules:h,element:r})}function Do({element:r,styles:e,debug:t=!1}){if(!e)return;Oh(e,r,t);const n="global-".concat(r.tagName.toLowerCase(),"-styles");if(document.head.querySelector("style#".concat(n))==null){const a=document.createElement("style");a.id=n,a.innerHTML=e,document.head.appendChild(a)}}function vh(r){const e=r.ownerNode instanceof HTMLLinkElement&&(r.ownerNode.getAttribute("crossorigin")==="anonymous"||r.ownerNode.getAttribute("crossorigin")==="");return r.href==null||r.href.startsWith(window.location.origin)||e}function ea(r){return r===R.CartPage||r===R.CartAjax}function ta({height:r,minHeight:e}){let t=r,n=e;return(t!=null&&t.includes("var(".concat(X.buttonBlockSize))||t==="auto")&&(t=null),(n!=null&&n.includes("var(".concat(X.buttonBlockSize))||n==="auto")&&(n=null),t===n?t:n&&t?"max(".concat(t,",").concat(n,")"):t||n}function ra({existingProperties:r,mediaCondition:e,selector:t,styles:n}){const a={...n};r.forEach(o=>{delete a[o]});for(const[o,i]of Object.entries(a))i!=null&&i.startsWith("var(".concat(o))&&delete a[o];for(const[o,i]of Object.entries(a))(i==null||i==="")&&delete a[o];return Object.keys(a).length===0?"":Th({mediaCondition:e,selector:t,styles:a})}function Th({mediaCondition:r,selector:e,styles:t}){let n="".concat(r?"@media ".concat(r," { "):"").concat(e," {");for(const[a,o]of Object.entries(t))o&&(n+="\n  ".concat(a,": ").concat(o,";"));return n+="\n}",r&&(n+="}"),n+="\n",n}function na({styles:r,element:e,mediaRules:t}){const{height:n,minHeight:a,borderRadius:o,marginTop:i,justifyContent:s,boxShadow:l}=r,c=e.tagName.toLowerCase(),u=getComputedStyle(e),m=new Set;for(const g of Object.values(X))u.getPropertyValue(g)&&m.add(g);let h=ra({existingProperties:m,selector:c,styles:{[X.buttonBlockSize]:ta({height:n,minHeight:a}),[X.buttonBorderRadius]:o,[X.buttonBoxShadow]:l,[X.inlineAlignment]:s,"margin-top":i,display:i?"block":void 0}});return t.forEach(g=>{(g.height||g.minHeight||g.borderRadius||g.boxShadow||g.justifyContent||g.marginTop)&&(h+=ra({existingProperties:m,mediaCondition:g.conditionText,selector:c,styles:{[X.buttonBlockSize]:ta({height:g.height,minHeight:g.minHeight}),[X.buttonBorderRadius]:g.borderRadius,[X.buttonBoxShadow]:g.boxShadow,[X.inlineAlignment]:g.justifyContent,"margin-top":g.marginTop,display:g.marginTop?"block":void 0}}))}),h.trim()}const Nh=[["height"],["minHeight","min-height"],["borderRadius","border-radius"],["marginTop","margin-top"],["justifyContent","justify-content"]];function aa(r){return Nh.reduce((e,[t,n])=>(e[t]=Rh({rule:r,property:n!=null?n:t}),e),{})}function Rh({rule:r,property:e}){const t=r.style.getPropertyValue(e);return t!==""&&r.style.getPropertyPriority(e)?"".concat(t," !important"):t||null}function Dh({rule:r,property:e,currentPropertyValue:t}){const n=r[e];return!(t!=null&&t.includes("!important"))&&n!=null&&n.includes("!important")?n:t!=null?t:n}function kh(r){const e=/(--[\w-]+)\s*:/g;let t;const n={};for(;(t=e.exec(r))!==null;){const l=t[1];n[l]=(n[l]||0)+1}const a=/@media\s+([^{]+)/g,o=(r.match(a)||[]).length,i=/margin-top\s*:/g,s=(r.match(i)||[]).length;return{properties:n,mediaQueryCount:o,marginTopCount:s}}function Oh(r,e,t){var n,a,o;const i=(o=(a=(n=window.ShopifyAnalytics)==null?void 0:n.lib)==null?void 0:a.trekkie)==null?void 0:o.defaultAttributes,s=i==null?void 0:i.themeId;if(s&&(t&&p.log({body:"Style backwards compatibility used",attributes:{themeId:"".concat(s)}}),Math.random()<Ih)){const l=kh(r);for(const[c,u]of Object.entries(l.properties))p.styleBackwardsCompatibilityRules({rule:c,count:u,pageType:e.pageType});l.mediaQueryCount>0&&p.styleBackwardsCompatibilityRules({rule:"@media",count:l.mediaQueryCount,pageType:e.pageType}),l.marginTopCount>0&&p.styleBackwardsCompatibilityRules({rule:"margin-top",count:l.marginTopCount,pageType:e.pageType}),p.log({body:"Style backwards compatibility details",attributes:{themeId:"".concat(s),pageType:e.pageType,stylesString:r.length>2e3?r.substring(0,2e3):r}})}}const oa=2e3;class ia extends Error{constructor(){super(...arguments),d(this,"name","AcceleratedCheckoutError")}}var Ke;const Xt=class ep extends Zr{constructor(){super(...arguments),d(this,"instanceNumber",++ep.instanceCount),d(this,"pageType",R.ProductPage),d(this,"formObserver"),d(this,"dataSource"),d(this,"wrapper"),d(this,"shopPromiseEligible",!1),d(this,"didInitiateRender",!1),V(this,Ke)}static get observedAttributes(){return["access-token","disabled","has-selling-plan","requires-shipping"]}async connectedCallback(){var e,t;super.connectedCallback();try{if((t=(e=this.wrapper)==null?void 0:e.children)!=null&&t.length||this.didInitiateRender)return;if(!this.validateRenderingSurface()){this.clearUI();return}this.instanceNumber===1&&(en(this),p.initStarted(),mh({styleId:"shopify-accelerated-checkout-styles",styles:_c,cssFileName:"AcceleratedCheckout.css"}),this.extractStyles()),this.shopPromiseEligible=Ra();const n=Xe(M.ButtonDisplay,"dc:".concat(this.instanceNumber));this.i18n=nr(),this.setupFormObserver(),this.didInitiateRender=!0;const a=await this.loadWallet(),o=a.getInstrumentName();this.apiClient=new sr({accessToken:this.accessToken,country:this.buyerCountry,locale:this.i18n.locale,withCarrierRates:!0}),this.dataSource=new Gl(this,this.apiClient,o);const i=await this.getWebComponentInstance({wallet:a,instrumentName:o,dataSource:this.dataSource,i18n:this.i18n,apiClient:this.apiClient,buttonDisplayBenchmark:n});this.render(i,o),p.initCompleted(),this.instanceNumber===1&&this.triggerLoadedEvent()}catch(n){if(this.clearUI(),p.initCompleted(n),n.name===St)throw n;b.notify(new ia("An error occurred while attempting to render AcceleratedCheckout: ".concat(n),{cause:n}))}}async attributeChangedCallback(e,t,n){t!==n&&(Xr(this,e,n),e==="has-selling-plan"&&n===""?this.showBuyerConsent(this.apiClient,this.i18n):e==="has-selling-plan"&&n===null&&this.hideBuyerConsent())}async getWebComponentInstance({wallet:e,instrumentName:t,dataSource:n,i18n:a,apiClient:o,buttonDisplayBenchmark:i}){const s=await e.createWebComponent({walletContainer:this,dataSource:n,i18n:a,apiClient:o,classNames:Lh(t),callToAction:"true",pageType:this.pageType,containerInstanceNumber:this.instanceNumber,supportsSubscriptions:e.supportsSubscriptions,supportsDeferredPurchaseOptions:e.supportsDeferredPurchaseOptions,onRendered:()=>p.instrumentLoaded({instrumentOrComponentName:t,result:"success",measurement:i()})});if(!s)throw new ia("No web component instance found for instrument ".concat(t));return s}async render(e,t){this.clearUI();const n=this.getOrCreateShadowRoot(),a=document.createElement("style");a.innerHTML=vo,n.appendChild(a),this.wrapper=document.createElement("div"),this.wrapper.className="wallet-button-fade-in wallet-button-wrapper";const o=document.createElement("slot");o.name="button",this.wrapper.appendChild(o);const i=document.createElement("slot");i.name="promise",this.wrapper.appendChild(i);const s=document.createElement("slot");s.name="more-options",this.wrapper.appendChild(s),n==null||n.appendChild(this.wrapper),this.hasSellingPlan?this.showBuyerConsent(this.apiClient,this.i18n):this.hideBuyerConsent(),this.setupManagedMarketsHandlers(this.i18n);const l=new DocumentFragment;e&&l.appendChild(e);const c=this.getShopPromiseSlot();c&&l.appendChild(c);const u=this.getMorePaymentOptionsLink(t);u&&l.appendChild(u),this.appendChild(l)}getMorePaymentOptionsLink(e){var t,n;if(e===y.BuyItNow)return null;const a=document.createElement("more-payment-options-link");return It(a,{"buyer-country":(t=this.buyerCountry)!=null?t:"","access-token":(n=this.accessToken)!=null?n:"",slot:"more-options"}),a.disabled=this.disabled,a.setDataSource(this.dataSource),a.setI18n(this.i18n),a.setClassNames(Er.MORE_PAYMENT_OPTION_BUTTON),a}getShopPromiseSlot(){if(!this.shopPromiseEligible)return null;const e=document.createElement("div");return e.setAttribute("data-shopify","shop-promise-payment-button-slot"),e.style.height="100%",e.slot="promise",e}validateRenderingSurface(){return Nt({page:"product",element:this})!=null}async loadWallet(){const e=this.recommendedWallet,t=wc(e,this.fallbackWallet,"AcceleratedCheckout");return await Mh(this,{...t,instanceNumber:this.instanceNumber})}setupFormObserver(){this.formObserver||(this.formObserver=new tn(this,({disabled:e,hasSellingPlan:t})=>{this.disabled=e,this.hasSellingPlan=t,this.isShippingRequired=xh(this,this.variantParams)}),this.formObserver.setupMutationObservers())}getOrCreateShadowRoot(){return P(this,Ke)||F(this,Ke,this.attachShadow({mode:"closed"})),P(this,Ke)}extractStyles(){if(this.styleExtractorDisabled){xt()("shopify-support-debug")&&console.debug("[shopify-support-debug] styling backward compatibility disabled"),p.styleBackwardsCompatibility({usedBackwardsCompatibility:!1});return}const e=Xe(M.StyleExtract,"dc:".concat(this.instanceNumber)),t=Ro(this);t&&Do({element:this,styles:t,debug:this.debug});const n=e();n&&p.styleBackwardsCompatibilityExecutionTime({measurement:n,pageType:this.pageType,stylesWritten:!!t}),p.styleBackwardsCompatibility({usedBackwardsCompatibility:!!t})}};Ke=new WeakMap,d(Xt,"instanceCount",0);let xr=Xt;function Lh(r){return r===y.BuyItNow?Er.UNBRANDED_BUTTON:Er.BRANDED_BUTTON}function xh(r,e){var t;const n=Ba(r);return!!((t=e.find(a=>a.id===Number(n==null?void 0:n.variantId)))!=null&&t.requiresShipping)}async function Mh(r,{recommendedWallet:e,fallbackWallet:t,instanceNumber:n}){const a=e?gt(e):null,o=gt(t),i=async s=>{const l=qa({walletInstrument:s,instanceNumber:n}),c="timeout",u=await Promise.race([l,new Promise(m=>setTimeout(()=>m(c),oa))]);if(u===c)p.instrumentSDKLoaded({instrument:s.getInstrumentName(),measurement:oa,result:"timeout"});else if(u instanceof Ce)return u;return null};if(qt(r,a)){const s=await i(a);if(s)return s}if(qt(r,o)){const s=await i(o);if(s)return s}return gt(_a)}ce("shopify-accelerated-checkout",xr),ce("more-payment-options-link",gc,{isChildCustomElement:!0});const Uh=r=>{var e;if(typeof PerformanceObserver>"u"||!((e=PerformanceObserver.supportedEntryTypes)!=null&&e.includes("resource")))return null;const t=new PerformanceObserver(n=>{n.getEntriesByType("resource").some(a=>a.name.includes(lt.CartUpdate)||a.name.includes(lt.CartChange)||a.name.includes(lt.CartAdd)||a.name.includes(lt.CartClear))&&r()});return t.observe({entryTypes:["resource"]}),t},Bh=".wallet-cart-button__skeleton{animation:acceleratedCheckoutLoadingSkeleton var(--shopify-accelerated-checkout-skeleton-animation-duration, 4s) var(--shopify-accelerated-checkout-skeleton-animation-timing-function, ease) infinite;animation-delay:-.168s;background-color:var(--shopify-accelerated-checkout-skeleton-background-color, #dedede)}.wallet-button-wrapper{container-type:inline-size;container-name:wrapper;width:100%}.wallet-cart-grid{margin:0 -5px -5px;padding:0;display:flex;flex-direction:row;justify-content:var(--shopify-accelerated-checkout-inline-alignment, start)}.wallet-cart-button-container{position:relative;margin:0 5px 5px}.wallet-cart-button-container,.wallet-cart-button{width:auto;flex:1 1 0px;min-width:100px;height:clamp(25px,var(--shopify-accelerated-checkout-button-inline-size, 42px),55px);border-radius:var(--shopify-accelerated-checkout-button-border-radius, 4px);list-style-type:none!important;text-align:center}.wallet-cart-grid.wallet-cart-grid--vertical,.additional-checkout-buttons--vertical .wallet-cart-grid{justify-content:flex-start;flex-direction:column;margin:0}.wallet-cart-grid.wallet-cart-grid--vertical .wallet-cart-button-container,.additional-checkout-buttons--vertical .wallet-cart-grid .wallet-cart-button-container{width:100%;height:clamp(25px,var(--shopify-accelerated-checkout-button-block-size, 54px),55px);margin:var(--shopify-accelerated-checkout-row-gap, 8px) 0 0 0}.wallet-cart-grid.wallet-cart-grid--vertical .wallet-cart-button-container:first-child,.additional-checkout-buttons--vertical .wallet-cart-grid .wallet-cart-button-container:first-child{margin:0}.wallet-cart-grid.wallet-cart-grid--vertical .wallet-cart-button,.additional-checkout-buttons--vertical .wallet-cart-grid .wallet-cart-button{width:100%;height:clamp(25px,var(--shopify-accelerated-checkout-button-block-size, 54px),55px)}.wallet-cart-grid.wallet-cart-grid--horizontal,.additional-checkout-buttons--horizontal .wallet-cart-grid{justify-content:stretch}.wallet-cart-grid.wallet-cart-grid--horizontal .wallet-cart-button-container,.additional-checkout-buttons--horizontal .wallet-cart-grid .wallet-cart-button-container,.wallet-cart-grid.wallet-cart-grid--horizontal .wallet-cart-button,.additional-checkout-buttons--horizontal .wallet-cart-grid .wallet-cart-button{min-width:0}@container wrapper (width >= 100px) and (width <= 500px){.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(1)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(2))){justify-content:flex-start;flex-direction:column;margin:0}.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(1)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(2))) .wallet-cart-button-container{width:100%;height:clamp(25px,var(--shopify-accelerated-checkout-button-block-size, 54px),55px);margin:var(--shopify-accelerated-checkout-row-gap, 8px) 0 0 0}.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(1)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(2))) .wallet-cart-button-container:first-child{margin:0}.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(1)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(2))) .wallet-cart-button{width:100%;height:clamp(25px,var(--shopify-accelerated-checkout-button-block-size, 54px),55px)}}@container wrapper (width <= 210px){.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(2)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(3))){justify-content:flex-start;flex-direction:column;margin:0}.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(2)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(3))) .wallet-cart-button-container{width:100%;height:clamp(25px,var(--shopify-accelerated-checkout-button-block-size, 54px),55px);margin:var(--shopify-accelerated-checkout-row-gap, 8px) 0 0 0}.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(2)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(3))) .wallet-cart-button-container:first-child{margin:0}.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(2)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(3))) .wallet-cart-button{width:100%;height:clamp(25px,var(--shopify-accelerated-checkout-button-block-size, 54px),55px)}}@container wrapper (width <= 320px){.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(3)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(4))){justify-content:flex-start;flex-direction:column;margin:0}.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(3)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(4))) .wallet-cart-button-container{width:100%;height:clamp(25px,var(--shopify-accelerated-checkout-button-block-size, 54px),55px);margin:var(--shopify-accelerated-checkout-row-gap, 8px) 0 0 0}.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(3)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(4))) .wallet-cart-button-container:first-child{margin:0}.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(3)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(4))) .wallet-cart-button{width:100%;height:clamp(25px,var(--shopify-accelerated-checkout-button-block-size, 54px),55px)}}@container wrapper (width <= 430px){.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(4)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(5))){justify-content:flex-start;flex-direction:column;margin:0}.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(4)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(5))) .wallet-cart-button-container{width:100%;height:clamp(25px,var(--shopify-accelerated-checkout-button-block-size, 54px),55px);margin:var(--shopify-accelerated-checkout-row-gap, 8px) 0 0 0}.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(4)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(5))) .wallet-cart-button-container:first-child{margin:0}.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(4)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(5))) .wallet-cart-button{width:100%;height:clamp(25px,var(--shopify-accelerated-checkout-button-block-size, 54px),55px)}}@container wrapper (width <= 540px){.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(5)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(6))){justify-content:flex-start;flex-direction:column;margin:0}.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(5)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(6))) .wallet-cart-button-container{width:100%;height:clamp(25px,var(--shopify-accelerated-checkout-button-block-size, 54px),55px);margin:var(--shopify-accelerated-checkout-row-gap, 8px) 0 0 0}.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(5)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(6))) .wallet-cart-button-container:first-child{margin:0}.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(5)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(6))) .wallet-cart-button{width:100%;height:clamp(25px,var(--shopify-accelerated-checkout-button-block-size, 54px),55px)}}.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(6)){justify-content:flex-start;flex-direction:column;margin:0}.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(6)) .wallet-cart-button-container{width:100%;height:clamp(25px,var(--shopify-accelerated-checkout-button-block-size, 54px),55px);margin:var(--shopify-accelerated-checkout-row-gap, 8px) 0 0 0}.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(6)) .wallet-cart-button-container:first-child{margin:0}.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(6)) .wallet-cart-button{width:100%;height:clamp(25px,var(--shopify-accelerated-checkout-button-block-size, 54px),55px)}@media screen and (max-width: 750px){.wallet-cart-grid{justify-content:stretch}.wallet-cart-button-container,.wallet-cart-button{min-width:0}}@supports (not (container-type: inline-size)) or (not (selector(:has(*)))){.wallet-cart-grid{justify-content:flex-start;flex-direction:column;margin:0}.wallet-cart-button-container{width:100%;height:clamp(25px,var(--shopify-accelerated-checkout-button-block-size, 54px),55px);margin:var(--shopify-accelerated-checkout-row-gap, 8px) 0 0 0}.wallet-cart-button-container:first-child{margin:0}.wallet-cart-button{width:100%;height:clamp(25px,var(--shopify-accelerated-checkout-button-block-size, 54px),55px)}}.screen-reader-text{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}",Fh=".wallet-cart-button__skeleton{animation:acceleratedCheckoutLoadingSkeleton var(--shopify-accelerated-checkout-skeleton-animation-duration, 4s) var(--shopify-accelerated-checkout-skeleton-animation-timing-function, ease) infinite;animation-delay:-.168s;background-color:var(--shopify-accelerated-checkout-skeleton-background-color, #dedede)}.wallet-button-wrapper{container-type:inline-size;container-name:wrapper;width:100%}.wallet-cart-grid{margin:0 -5px -5px;padding:0;display:flex;flex-direction:row;justify-content:var(--shopify-accelerated-checkout-inline-alignment, start)}.wallet-cart-button-container{position:relative;margin:0 5px 5px}.wallet-cart-button-container,.wallet-cart-button{width:auto;flex:1 1 0px;min-width:100px;height:clamp(25px,var(--shopify-accelerated-checkout-button-inline-size, 42px),55px);border-radius:var(--shopify-accelerated-checkout-button-border-radius, 4px);list-style-type:none!important;text-align:center}.wallet-cart-grid.wallet-cart-grid--vertical,.additional-checkout-buttons--vertical .wallet-cart-grid{justify-content:flex-start;flex-direction:column;margin:0}.wallet-cart-grid.wallet-cart-grid--vertical .wallet-cart-button-container,.additional-checkout-buttons--vertical .wallet-cart-grid .wallet-cart-button-container{width:100%;height:clamp(25px,var(--shopify-accelerated-checkout-button-block-size, 54px),55px);margin:var(--shopify-accelerated-checkout-row-gap, 8px) 0 0 0}.wallet-cart-grid.wallet-cart-grid--vertical .wallet-cart-button-container:first-child,.additional-checkout-buttons--vertical .wallet-cart-grid .wallet-cart-button-container:first-child{margin:8px 0 0}.wallet-cart-grid.wallet-cart-grid--vertical .wallet-cart-button,.additional-checkout-buttons--vertical .wallet-cart-grid .wallet-cart-button{width:100%;height:clamp(25px,var(--shopify-accelerated-checkout-button-block-size, 54px),55px)}.wallet-cart-grid.wallet-cart-grid--horizontal,.additional-checkout-buttons--horizontal .wallet-cart-grid{justify-content:stretch}.wallet-cart-grid.wallet-cart-grid--horizontal .wallet-cart-button-container,.additional-checkout-buttons--horizontal .wallet-cart-grid .wallet-cart-button-container,.wallet-cart-grid.wallet-cart-grid--horizontal .wallet-cart-button,.additional-checkout-buttons--horizontal .wallet-cart-grid .wallet-cart-button{min-width:0}@container wrapper (width >= 100px) and (width <= 500px){.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(1)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(2))){justify-content:flex-start;flex-direction:column;margin:0}.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(1)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(2))) .wallet-cart-button-container{width:100%;height:clamp(25px,var(--shopify-accelerated-checkout-button-block-size, 54px),55px);margin:var(--shopify-accelerated-checkout-row-gap, 8px) 0 0 0}.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(1)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(2))) .wallet-cart-button-container:first-child{margin:8px 0 0}.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(1)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(2))) .wallet-cart-button{width:100%;height:clamp(25px,var(--shopify-accelerated-checkout-button-block-size, 54px),55px)}}@container wrapper (width <= 210px){.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(2)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(3))){justify-content:flex-start;flex-direction:column;margin:0}.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(2)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(3))) .wallet-cart-button-container{width:100%;height:clamp(25px,var(--shopify-accelerated-checkout-button-block-size, 54px),55px);margin:var(--shopify-accelerated-checkout-row-gap, 8px) 0 0 0}.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(2)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(3))) .wallet-cart-button-container:first-child{margin:8px 0 0}.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(2)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(3))) .wallet-cart-button{width:100%;height:clamp(25px,var(--shopify-accelerated-checkout-button-block-size, 54px),55px)}}@container wrapper (width <= 320px){.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(3)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(4))){justify-content:flex-start;flex-direction:column;margin:0}.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(3)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(4))) .wallet-cart-button-container{width:100%;height:clamp(25px,var(--shopify-accelerated-checkout-button-block-size, 54px),55px);margin:var(--shopify-accelerated-checkout-row-gap, 8px) 0 0 0}.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(3)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(4))) .wallet-cart-button-container:first-child{margin:8px 0 0}.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(3)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(4))) .wallet-cart-button{width:100%;height:clamp(25px,var(--shopify-accelerated-checkout-button-block-size, 54px),55px)}}@container wrapper (width <= 430px){.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(4)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(5))){justify-content:flex-start;flex-direction:column;margin:0}.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(4)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(5))) .wallet-cart-button-container{width:100%;height:clamp(25px,var(--shopify-accelerated-checkout-button-block-size, 54px),55px);margin:var(--shopify-accelerated-checkout-row-gap, 8px) 0 0 0}.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(4)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(5))) .wallet-cart-button-container:first-child{margin:8px 0 0}.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(4)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(5))) .wallet-cart-button{width:100%;height:clamp(25px,var(--shopify-accelerated-checkout-button-block-size, 54px),55px)}}@container wrapper (width <= 540px){.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(5)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(6))){justify-content:flex-start;flex-direction:column;margin:0}.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(5)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(6))) .wallet-cart-button-container{width:100%;height:clamp(25px,var(--shopify-accelerated-checkout-button-block-size, 54px),55px);margin:var(--shopify-accelerated-checkout-row-gap, 8px) 0 0 0}.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(5)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(6))) .wallet-cart-button-container:first-child{margin:8px 0 0}.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(5)).wallet-cart-grid:not(:has(>.wallet-cart-button-container:nth-of-type(6))) .wallet-cart-button{width:100%;height:clamp(25px,var(--shopify-accelerated-checkout-button-block-size, 54px),55px)}}.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(6)){justify-content:flex-start;flex-direction:column;margin:0}.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(6)) .wallet-cart-button-container{width:100%;height:clamp(25px,var(--shopify-accelerated-checkout-button-block-size, 54px),55px);margin:var(--shopify-accelerated-checkout-row-gap, 8px) 0 0 0}.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(6)) .wallet-cart-button-container:first-child{margin:8px 0 0}.wallet-cart-grid:not(.wallet-cart-grid--horizontal):has(>.wallet-cart-button-container:nth-of-type(6)) .wallet-cart-button{width:100%;height:clamp(25px,var(--shopify-accelerated-checkout-button-block-size, 54px),55px)}@media screen and (max-width: 750px){.wallet-cart-grid{justify-content:stretch}.wallet-cart-button-container,.wallet-cart-button{min-width:0}}@supports (not (container-type: inline-size)) or (not (selector(:has(*)))){.wallet-cart-grid{justify-content:flex-start;flex-direction:column;margin:0}.wallet-cart-button-container{width:100%;height:clamp(25px,var(--shopify-accelerated-checkout-button-block-size, 54px),55px);margin:var(--shopify-accelerated-checkout-row-gap, 8px) 0 0 0}.wallet-cart-button-container:first-child{margin:8px 0 0}.wallet-cart-button{width:100%;height:clamp(25px,var(--shopify-accelerated-checkout-button-block-size, 54px),55px)}}.screen-reader-text{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}";function $h(r){const e=Nt({page:"cart",element:r});return Ua({type:"attributes",form:e})}class zh{constructor(e,t,n){this.element=e,this.cartToken=t,this.apiClient=n}async getInitialCart(e){try{const t="gid://shopify/Cart/".concat(this.cartToken),n=$h(this.element);let a,o=[];if(n.length){const i=await this.apiClient.updateCartAttributes({cartId:t,attributes:n,instrumentName:e,startingCheckout:!0});a=i.data,o=i.errors}else a=await this.apiClient.fetchCart({id:t,instrumentName:e,startingCheckout:!0});return{cart:a,errors:o}}catch(t){if(t instanceof ue)return{cart:null,errors:[{code:"NO_RESPONSE"}]};throw t}}}var Qe;const Zt=class tp extends Zr{constructor(){super(),d(this,"instanceNumber",++tp.instanceCount),d(this,"pageType",R.CartPage),d(this,"cartObserver",null),d(this,"dataSource",null),d(this,"wrapper"),d(this,"didInitiateRender",!1),V(this,Qe)}static get observedAttributes(){return["access-token","has-selling-plan","requires-shipping"]}createDataSource(){if(!this.cartToken){p.cartTokenMissing({reason:"createDataSource"});return}this.apiClient=new sr({accessToken:this.accessToken,country:this.buyerCountry,locale:this.i18n.locale,withCarrierRates:!0}),this.dataSource=new zh(this,this.cartToken,this.apiClient)}async createWebComponents({shouldRefetchCartAttributes:e}){if(!this.walletConfigs)throw new te({code:"invalid-wallet-configs",message:"[AcceleratedCheckoutCart] walletConfigs does not exist"});const t=yc(this.walletConfigs,"AcceleratedCheckoutCart");if(!(t instanceof Array))throw new te({code:"invalid-wallet-configs",message:"[AcceleratedCheckoutCart] invalid walletConfigs found"});const n=M.ButtonDisplay,a=i=>"".concat(i,":").concat(this.instanceNumber),o=await Hh(this,{walletConfigs:t,startButtonDisplayBenchmark:i=>et(n,a(i))});return this.createDataSource(),this.dataSource?(e&&await this.updateAttributes(),await Promise.all(o.map(async i=>{const s=i.getInstrumentName();return await i.createWebComponent({walletContainer:this,dataSource:this.dataSource,i18n:this.i18n,apiClient:this.apiClient,pageType:this.pageType,containerInstanceNumber:this.instanceNumber,slot:"button-".concat(i.getInstrumentName()),supportsSubscriptions:i.supportsSubscriptions,supportsDeferredPurchaseOptions:i.supportsDeferredPurchaseOptions,onRendered:(()=>{let l=!1;return()=>{l||(l=!0,p.instrumentLoaded({instrumentOrComponentName:s,result:"success",measurement:Q(n,a(s))}))}})()})}))):[]}async cartChangedCallback(){try{if(!this.dataSource&&this.cartToken){await this.render({shouldRefetchCartAttributes:!0}),p.initCompleted();return}else if(!this.cartToken){p.cartTokenMissing({reason:"cartChangedCallback"});return}await this.updateAttributes()}catch(e){this.clearUI(),b.notify(e)}}async updateAttributes(){var e,t;if(!this.cartToken||!this.apiClient)return;const n=await this.apiClient.fetchLimitedCart({id:"gid://shopify/Cart/".concat(this.cartToken),instrumentName:y.Unknown});this.hasSellingPlan=(e=n.sellingPlan)!=null?e:!1,this.isShippingRequired=(t=n.shippingRequired)!=null?t:!1}async connectedCallback(){super.connectedCallback();try{if(this.didInitiateRender)return;if(this.instanceNumber===1&&en(this),p.initStarted(),this.cartObserver=Uh(()=>this.cartChangedCallback()),!this.cartObserver){p.log({body:"Cart observer unavailable - PerformanceObserver not supported",attributes:{userAgent:navigator.userAgent}}),this.clearUI();return}if(!this.cartToken){p.cartTokenMissing({reason:"connectedCallback"});return}await this.render({shouldRefetchCartAttributes:!1}),p.initCompleted()}catch(e){this.clearUI(),p.initCompleted(e),b.notify(e)}}disconnectedCallback(){var e;(e=this.cartObserver)==null||e.disconnect()}async attributeChangedCallback(e,t,n){t!==n&&(Xr(this,e,n),e==="has-selling-plan"&&n===""?this.showBuyerConsent(this.apiClient,this.i18n):e==="has-selling-plan"&&n===null&&this.hideBuyerConsent())}get cartToken(){return yt("cart")}async render({shouldRefetchCartAttributes:e}){if(this.i18n=nr(),this.hasLegacyCartCookie()){p.legacyCartCookie(),this.clearUI();return}this.didInitiateRender=!0;const t=Xe(M.ButtonDisplay,"cart:".concat(this.instanceNumber)),n=await this.createWebComponents({shouldRefetchCartAttributes:e});if(this.clearUI(),this.hasSellingPlan?this.showBuyerConsent(this.apiClient,this.i18n):this.hideBuyerConsent(),this.setupManagedMarketsHandlers(this.i18n),n.length===0)return;const a=new DocumentFragment,o=this.getOrCreateShadowRoot(),i=document.createElement("style");i.innerHTML=[vo,Bh].join("\n"),o.appendChild(i),this.extractStyles(),this.wrapper=document.createElement("div"),this.wrapper.className="wallet-button-fade-in wallet-button-wrapper";const s=document.createElement("h2");s.className="screen-reader-text",s.textContent=this.i18n.translate("express_checkout"),this.wrapper.appendChild(s);const l=document.createElement("div");l.className="wallet-cart-grid ".concat(Oe.CONTAINER),Object.entries(Gh).forEach(([c,u])=>{document.querySelector(c)&&l.classList.add(u)}),n.forEach(c=>{const u=document.createElement("div"),m=document.createElement("div"),h=document.createElement("slot");h.name="button-".concat(c.name),u.className="wallet-cart-button-container",m.className="wallet-cart-button",u.setAttribute("data-testid","grid-cell"),u.appendChild(m),m.appendChild(h),l.appendChild(u),a.appendChild(c)}),this.wrapper.appendChild(l),o.appendChild(this.wrapper),this.appendChild(a),p.instrumentLoaded({instrumentOrComponentName:"AcceleratedCheckoutCart",result:"success",measurement:t()})}getOrCreateShadowRoot(){return P(this,Qe)||F(this,Qe,this.attachShadow({mode:"closed"})),P(this,Qe)}hasLegacyCartCookie(){var e;return this.cartToken?(e=this.cartToken)==null?void 0:e.match(/^[a-z0-9]+$/):!1}extractStyles(){if(this.styleExtractorDisabled){xt()("shopify-support-debug")&&console.debug("[shopify-support-debug] styling backward compatibility disabled"),p.styleBackwardsCompatibility({usedBackwardsCompatibility:!1});return}const e=Xe(M.StyleExtract,"cart:".concat(this.instanceNumber)),t=Ro(this);if(t){Do({element:this,styles:t,debug:this.debug});const a=this.getOrCreateShadowRoot(),o=document.createElement("style");o.innerHTML=Fh,a.appendChild(o)}const n=e();n&&p.styleBackwardsCompatibilityExecutionTime({measurement:n,pageType:this.pageType,stylesWritten:!!t}),p.styleBackwardsCompatibility({usedBackwardsCompatibility:!!t})}};Qe=new WeakMap,d(Zt,"instanceCount",0);let Mr=Zt;async function Hh(r,{walletConfigs:e,startButtonDisplayBenchmark:t=()=>{}}){const n=bc(r,ph(e));return(await Promise.all(n.map(a=>(t(a.getInstrumentName()),qa({walletInstrument:a,instanceNumber:r.instanceNumber}))))).filter(a=>a!=null)}const Gh={".additional-checkout-buttons--vertical shopify-accelerated-checkout-cart":"wallet-cart-grid--vertical",".additional-checkout-buttons--horizontal shopify-accelerated-checkout-cart":"wallet-cart-grid--horizontal"};ce("shopify-accelerated-checkout-cart",Mr);class Vh{getInitialCart(){throw new Error('[NoOpDataSource] Unexpected call to "getCart"')}}const er=class rp extends Zr{constructor(){super(...arguments),d(this,"instanceNumber",++rp.instanceCount),d(this,"pageType",R.Checkout)}get walletConfig(){return this.getAttribute("wallet-config")}async connectedCallback(){var e;super.connectedCallback();try{if(this.i18n=nr(),this.children.length)return;this.instanceNumber===1&&(en(this),p.initStarted());const t=Xe(M.ButtonDisplay,"dc:".concat(this.instanceNumber)),n=fc(this.walletConfig,"WalletButton");if(!n)throw new ti("[WalletButton] No config provided.");const a=gt(n);if(!a)return;if(!await this.eligibleToShow(a)){this.pciEnabled&&this.dispatchEvent(new CustomEvent("wallet-rendered",{detail:{status:"failure",message:"ineligible"}}));return}if(this.onlySdk){p.initCompleted(),this.pciEnabled&&this.dispatchEvent(new CustomEvent("wallet-rendered",{detail:{status:"success"}}));return}const o=a.getInstrumentName();this.apiClient=new sr({accessToken:this.accessToken,country:this.buyerCountry,locale:this.i18n.locale});const i=await this.createWebComponent(a,this.i18n,this.apiClient,o,t);this.innerHTML="",this.appendChild(i),p.initCompleted(),this.instanceNumber===1&&this.triggerLoadedEvent()}catch(t){this.innerHTML="",this.pciEnabled&&this.dispatchEvent(new CustomEvent("wallet-rendered",{detail:{status:"failure",message:(e=t.message)!=null?e:"Error loading wallet SDK"}})),p.initCompleted(t),b.notify(t)}}async createWebComponent(e,t,n,a,o){const i=await e.createWebComponent({walletContainer:this,dataSource:new Vh,i18n:t,apiClient:n,containerInstanceNumber:this.instanceNumber,pageType:this.pageType});return i.onRendered=()=>{this.pciEnabled&&this.dispatchEvent(new CustomEvent("wallet-rendered",{detail:{status:"success"}})),p.instrumentLoaded({instrumentOrComponentName:a,result:"success",measurement:o()})},i}async eligibleToShow(e){return!(!qt(this,e)||(await e.loadWalletSDK(),!e.getPartnerSDKEligibility().eligible))}};d(er,"instanceCount",0);let Ur=er;ce("shopify-wallet-button",Ur),Wo(b,{metadata:{custom:{"notify-origin":"window-onerror"}}}),Yo(b,{metadata:{custom:{"notify-origin":"unhandled-promise-rejection-handler"}}}),p.startExporter();
